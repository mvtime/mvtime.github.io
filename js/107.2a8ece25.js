"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[107],{9107:function(e,t,a){a.r(t),a.d(t,{default:function(){return B}});var s=a(6768),l=a(5130),i=a(4232);const n=e=>((0,s.Qi)("data-v-a16650b8"),e=e(),(0,s.jt)(),e),o={class:"logdebug"},c={class:"docs_wrapper"},h={key:0,class:"docs_nav admin_in"},d=["disabled"],r=["title"],u=["disabled"],g={class:"docs_nav__loaded"},_={key:0},p={key:1},m=["disabled"],v={key:1,class:"docs"},k=["onClick"],b=["title"],y={key:0,class:"doc_title"},f=["href","onClick"],C={class:"doc_title__email_user"},$={class:"doc_title__email_domain"},L={class:"doc_title__ref"},w={class:"doc_title__time"},x={key:1,class:"doc_details"},E={class:"doc_details_table"},D=n((()=>(0,s.Lk)("th",null,"Email:",-1))),X=["href","onClick"],M=n((()=>(0,s.Lk)("th",null,"User:",-1))),q=n((()=>(0,s.Lk)("th",null,"Date:",-1))),N=n((()=>(0,s.Lk)("th",null,"Ref:",-1))),z=["onClick"],G={key:2,class:"docs_placeholder docs_placeholder__empty"},P={key:3,class:"docs_placeholder docs_placeholder__loading"},Q=n((()=>(0,s.Lk)("i",null,"Loading logs",-1))),A=[Q];function F(e,t,a,n,Q,F){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",c,[Q.pages.length?((0,s.uX)(),(0,s.CE)("nav",h,[(0,s.Lk)("button",{class:"docs_nav_button prev",onClick:t[0]||(t[0]=(...e)=>F.prev&&F.prev(...e)),disabled:!(F.total.length||Q.pages.length)||!Q.page_index,title:"Previous Page"},null,8,d),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>Q.search=e),class:"docs_nav_search",placeholder:"Search Log Reference, User ID, or Email",enterkeyhint:"search",onKeydown:t[2]||(t[2]=(0,l.jR)(((...e)=>F.submit&&F.submit(...e)),["enter"]))},null,544),[[l.Jo,Q.search]]),F.manual&&Q.loaded&&Q.loaded==Q.search?((0,s.uX)(),(0,s.CE)("button",{key:0,class:(0,i.C4)(["docs_nav_button clear",{click_escape:null==Q.active}]),onClick:t[3]||(t[3]=(...e)=>F.clear&&F.clear(...e)),title:`Clear query '${this.loaded}'`},null,10,r)):Q.search?((0,s.uX)(),(0,s.CE)("button",{key:1,class:(0,i.C4)(["docs_nav_button search",{click_ctrlenter:null==Q.active&&!(Q.search.length<10&&!Q.search.includes("@")||Q.search.length>100)}]),disabled:Q.search.length<10&&!Q.search.includes("@")||Q.search.length>100,onClick:t[4]||(t[4]=(...e)=>F.submit&&F.submit(...e)),title:"Submit query (10+ characters or user email)"},null,10,u)):(0,s.Q3)("",!0),(0,s.Lk)("div",g,[F.manual?((0,s.uX)(),(0,s.CE)("span",_,(0,i.v_)(Q.manual_page.length)+" Result"+(0,i.v_)(1==Q.manual_page.length?"":"s"),1)):((0,s.uX)(),(0,s.CE)("span",p,(0,i.v_)(F.total.length+(F.more&&Q.pages.length&&Q.pages[Q.pages.length-1].length&&Q.pages[Q.pages.length-1].length==Q.page_size?"+":""))+" Result"+(0,i.v_)(1==F.total.length?"":"s"),1))]),F.manual&&Q.search?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:2,class:"docs_nav_button next",onClick:t[5]||(t[5]=(...e)=>F.next&&F.next(...e)),disabled:!(F.total.length||Q.pages.length)||!F.more,title:"Next Page"},null,8,m))])):(0,s.Q3)("",!0),Q.pages.length&&F.total.length?((0,s.uX)(),(0,s.CE)("div",v,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(F.page,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,i.C4)(["doc admin_in",{active:Q.active==e.id}]),key:e.id,style:(0,i.Tr)({animationDelay:.03*(t+2)+"s"})},[(0,s.Lk)("button",{class:(0,i.C4)(["doc_details__toggle",{click_escape:Q.active==e.id}]),onClick:t=>Q.active=Q.active==e.id?null:e.id,title:"Close details pane"},[(0,s.Lk)("div",{class:"doc_details__toggle__icon themed_icon",title:`${Q.active==e.id?"Collapse":"Expand"} log ${e.id}`},null,8,b)],10,k),Q.active!=e.id?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("a",{class:"doc_title__email",href:`./logs?search=${e.data().email}`,onClick:t=>{Q.search&&Q.loaded==Q.search||(Q.search=e.data().email,F.submit()),t.preventDefault()}},[(0,s.Lk)("span",C,(0,i.v_)(e.data().email.split("@")[0]),1),(0,s.Lk)("span",$,"@"+(0,i.v_)(e.data().email.split("@")[1]),1)],8,f),(0,s.Lk)("span",L,(0,i.v_)(e.id),1),(0,s.Lk)("span",w,(0,i.v_)(e.data().date.toDate().getTime()),1)])):((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("table",E,[(0,s.Lk)("tr",null,[D,(0,s.Lk)("td",null,[(0,s.Lk)("a",{class:"doc_title__email",href:`./logs?search=${e.data().email}`,onClick:t=>{Q.search&&Q.loaded==Q.search||(Q.search=e.data().email,F.submit()),t.preventDefault()}},(0,i.v_)(e.data().email),9,X)])]),(0,s.Lk)("tr",null,[M,(0,s.Lk)("td",null,(0,i.v_)(e.data().user),1)]),(0,s.Lk)("tr",null,[q,(0,s.Lk)("td",null,(0,i.v_)(e.data().date.toDate()),1)]),(0,s.Lk)("tr",null,[N,(0,s.Lk)("td",null,(0,i.v_)(e.id),1)])]),(0,s.Lk)("button",{class:"doc_save click_ctrlenter",onClick:t=>F.downloadLogData(e.data().stream.json,e.data().date.toDate(),`cloud-${e.data().email}-${e.data().user}`)},"Download",8,z)]))],6)))),128))])):!F.total.length&&Q.pages.length?((0,s.uX)(),(0,s.CE)("div",G,"No logs to display")):((0,s.uX)(),(0,s.CE)("div",P,A))])])}a(4114);var I=a(7617),J=a(6669),R=a(6301),U=a(4186),Y={data(){return{active:null,page_index:0,page_size:10,pages:[],search:"",loaded:"",manual_page:[]}},computed:{page(){return this.manual?this.manual_page:this.pages[this.page_index]},total(){return this.pages.flat(1)},more(){return!this.page||this.page.length===this.page_size&&(this.page_index==this.pages.length-1||this.pages[this.page_index+1]?.length)},shortcuts(){return[{key:"Enter",description:"Submit search"},{key:"Ctrl + Enter",description:"Download active log",top:!0},{key:"Escape",description:"Collapse active log, clear search",top:!0}]},manual(){return this.loaded&&this.manual_page.length}},async mounted(){this.$shortcuts.register_all(this.shortcuts,"Admin - Logs & Debugging"),this.$route.query.search&&(this.search=this.$route.query.search,this.submit()),await this.init()},beforeUnmount(){this.$shortcuts.remove_tag("Admin - Logs & Debugging")},methods:{async init(){const e=(0,I.P)((0,I.rJ)(J.db,"logs"),(0,I.My)("date_inversed"),(0,I.AB)(this.page_size)),t=await(0,I.GG)(e);this.pages=[[...t.docs]],this.$status.log(`üìú Loaded first ${this.page_size} documents`)},downloadLogData:R.Fi,prev(){this.page_index>0&&this.page_index--},async next(){if(this.page_index<this.pages.length-1&&this.pages[this.page_index+1].length)this.page_index++;else if(this.page.length&&this.page.length===this.page_size){const e=(0,I.P)((0,I.rJ)(J.db,"logs"),(0,I.My)("date_inversed"),(0,I.HM)(this.page[this.page.length-1]),(0,I.AB)(this.page_size)),t=await(0,I.GG)(e);this.pages[this.page_index+1]=[...t.docs],this.$status.log(`üìú Loaded next ${t.docs.length} of ${this.page_size} documents`),this.next()}else this.$status.log(`üìú No more documents to load (${this.total.length} loaded)`)},clear(){this.search="",this.loaded="",this.manual_page=[],this.$router.push({query:{...this.$route.query,search:void 0}})},async submit(){if(this.active=null,this.search.includes("@")){const e=await(0,I.GG)((0,I.P)((0,I.rJ)(J.db,"logs"),(0,I._M)("email","==",this.search),(0,I.My)("date_inversed")));e.docs.length?(this.manual_page=[...e.docs],new U.rQ(`Found ${e.docs.length} log${1==e.docs.length?"":"s"} with email ${this.search}`,3500)):(this.$status.warn(`üîç No logs found with email <${this.search}>`),new U.MY("No logs found with that email address",3500),this.clear())}else if(this.search.length>=10){const e=await(0,I.x7)((0,I.H9)(J.db,"logs",this.search));if(e.exists())this.manual_page=[e],new U.rQ(`Found log with reference ${this.search}`,3500);else{this.$status.warn(`üîç No logs found with reference <${this.search}>, searching for matching user`),new U.MY("No logs found with that reference, checking for matching users",3500);const e=await(0,I.GG)((0,I.P)((0,I.rJ)(J.db,"logs"),(0,I._M)("user","==",this.search),(0,I.My)("date_inversed")));e.docs.length?(this.manual_page=[...e.docs],new U.rQ(`Found ${e.docs.length} log${1==e.docs.length?"":"s"} with user ${this.search}`,3500)):(this.$status.warn(`üîç No logs found with user <${this.search}>`),new U.MY("No logs found with that user id or reference",3500),this.clear())}}else this.$status.warn("üîç Invalid search query for logs"),new U.MY("Invalid search query for logs, must be 10+ characters or email",3500);this.loaded=this.search,this.$router.push({query:{...this.$route.query,search:this.search}})}}},j=a(1241);const S=(0,j.A)(Y,[["render",F],["__scopeId","data-v-a16650b8"]]);var B=S}}]);
//# sourceMappingURL=107.2a8ece25.js.map