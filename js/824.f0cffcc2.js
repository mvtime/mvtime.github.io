"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[824],{4824:function(e,t,s){s.r(t),s.d(t,{default:function(){return Je}});var a=s(6768),l=s(4232),i=s(5130);const n=e=>((0,a.Qi)("data-v-74bd715e"),e=e(),(0,a.jt)(),e),d=["page"],_={key:0,class:"msg_choose"},m=["onClick","disabled"],o={key:1,class:"msg_page_wrapper"},c={key:0,class:"msg_page_info admin_in",style:{animationDelay:"0.1s"}},p=n((()=>(0,a.Lk)("div",{class:"msg_page__back__icon themed_icon"},null,-1))),r=[p],g={class:"msg_page_info__text"},u=n((()=>(0,a.Lk)("hr",{class:"msg_page_wrapper__separator admin_in",style:{animationDelay:3*.05+"s"}},null,-1))),h={class:"msg_page_container admin_in",style:{animationDelay:"0.2s"}},v={key:0,class:"msg_page msg__view"},k={class:"msg_page_list msg__view_list"},y={class:"msg_page_list_header msg__view_list_header"},w=n((()=>(0,a.Lk)("th",{style:{flex:"1 2 6em","min-width":"6em"}},"Recepient",-1))),f=n((()=>(0,a.Lk)("th",{class:"msg__nomobile",style:{flex:"1 1 6em"}},"Template",-1))),b=n((()=>(0,a.Lk)("th",{style:{flex:"2 1 6.5em"}},"Date",-1))),C=n((()=>(0,a.Lk)("th",{style:{flex:"0 0 5em"}},"Status",-1))),L={style:{flex:"1 2 6em","min-width":"6em"}},E=["title"],x=["title"],X=["title"],$={class:"msg__nomobile",style:{flex:"1 1 6em"}},j={style:{flex:"2 1 6.5em"}},Q={style:{flex:"0 0 5em"}},T={key:0,class:"msg_page_list_item_content msg_view_preview"},M={class:"msg_view_preview__json"},S=["onClick"],D=["title"],F={key:0,class:"msg_page_list_item__empty admin_in",style:{animationDelay:"0.26s"}},N=n((()=>(0,a.Lk)("span",null,"No sent messages exist yet",-1))),A=[N],J=n((()=>(0,a.Lk)("div",{class:"part_loading_animation msg_page_list_item_loading_button"},null,-1))),O=[J],K={key:1,class:"msg_page msg__send"},H={class:"msg__send_form"},I={class:"msg__send_form_item"},U={class:"msg__send_form_item msg__send_form_pair"},V=n((()=>(0,a.Lk)("label",{for:"msg__send_to"},"To:",-1))),q={class:"msg__send_form_item msg__send_form_pair"},B=n((()=>(0,a.Lk)("label",{for:"msg__send_cc"},"CC:",-1))),W={class:"msg__send_form_item msg__send_form_pair"},R=n((()=>(0,a.Lk)("label",{for:"msg__send_bcc"},"BCC:",-1))),Y={class:"msg__send_form_item"},z={class:"msg__send_form_item msg__send_form_pair"},G=n((()=>(0,a.Lk)("label",{for:"msg__send_template"},"Template:",-1))),P={value:"",disabled:"",selected:""},Z=n((()=>(0,a.Lk)("option",{value:"custom"},"[custom] - Create your own message",-1))),ee=["value"],te={key:0,class:"msg__send_template_options msg__send_form_item"},se={class:"msg__send_form_item"},ae={class:"msg_page_list_item_content msg__send_preview"},le={key:0,class:"msg_page_list_item_content__html msg__send_preview__html msg__send_template_preview__html"},ie={key:0},ne=["innerHTML"],de=["innerHTML"],_e={key:2,class:"msg_page_list_item_content__html msg__send_preview__html"},me=n((()=>(0,a.Lk)("span",null,"Select a template to preview it here",-1))),oe=[me],ce={key:2,class:"msg_page msg__templates"},pe={class:"msg_page_list msg__templates_list"},re={class:"msg_page_list_header msg__templates_list_header"},ge=n((()=>(0,a.Lk)("th",{style:{flex:"0 1 10em"}},"Template",-1))),ue=n((()=>(0,a.Lk)("th",{style:{flex:"1 4 20em"}},"Subject",-1))),he=n((()=>(0,a.Lk)("th",{class:"msg__nomobile",style:{flex:"4 10 20em"}},"Text",-1))),ve={style:{flex:"1 1 10em"}},ke={style:{flex:"2 4 20em"}},ye={class:"msg__nomobile",style:{flex:"8 10 20em"}},we={key:0,class:"msg_page_list_item_content msg_templates_preview"},fe=["innerHTML"],be={key:1,class:"msg_page_list_item_content msg_templates_preview"},Ce=["innerHTML"],Le=["onClick"],Ee=["title"],xe={key:0,class:"msg_page_list_item__empty admin_in",style:{animationDelay:"0.26s"}},Xe=n((()=>(0,a.Lk)("span",null,"No templates exist yet",-1))),$e=[Xe],je=n((()=>(0,a.Lk)("div",{class:"part_loading_animation msg_page_list_item_loading_button"},null,-1))),Qe=[je];function Te(e,t,s,n,p,N){return(0,a.uX)(),(0,a.CE)("div",{class:"messagesalerts",page:p.page},["choose"==p.page?((0,a.uX)(),(0,a.CE)("div",_,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.choices,((e,t,s)=>((0,a.uX)(),(0,a.CE)("div",{class:(0,l.C4)(`msg_choose_page msg_choose__${t} admin_in`),key:t,onClick:s=>{e.disabled||(p.page=t)},style:(0,l.Tr)({animationDelay:.05*(s+2)+"s"}),disabled:e.disabled},(0,l.v_)(e.name),15,m)))),128))])):((0,a.uX)(),(0,a.CE)("div",o,["choose"!=p.page?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("button",{class:"msg_page__back",onClick:t[0]||(t[0]=e=>p.page="choose")},r),(0,a.Lk)("div",g,(0,l.v_)(p.choices[p.page].active),1)])):(0,a.Q3)("",!0),u,(0,a.Lk)("div",h,["view"==p.page?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("table",k,[(0,a.Lk)("tr",y,[w,p.data.view.active?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[f,b,C],64))]),p.data.view.loading?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(N.placeholder(3),(e=>((0,a.uX)(),(0,a.CE)("tr",{class:"msg_page_list_item msg_page_list_item_loading msg__view_list_item part_loading_animation",key:e},O)))),128)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.data.view.list,((e,t,s)=>((0,a.uX)(),(0,a.CE)("tr",{class:(0,l.C4)(["msg_page_list_item msg__view_list_item admin_in",{active:p.data.view.active==t}]),key:t,style:(0,l.Tr)({animationDelay:.03*(s+2)+.2+"s"})},[(0,a.Lk)("td",L,[e.to?((0,a.uX)(),(0,a.CE)("span",{key:0,class:"msg__view_to",title:`TO: ${Array.isArray(e.to)?e.to.join(", ")||"empty":e.to}`},(0,l.v_)(Array.isArray(e.to)?e.to.length+" emails":e.to.split("@")[0])+" ",9,E)):(0,a.Q3)("",!0),e.cc?((0,a.uX)(),(0,a.CE)("span",{key:1,class:"msg__view_cc",title:`CC: ${Array.isArray(e.cc)?e.cc.join(", ")||"empty":e.cc}`},"[cc] ",8,x)):(0,a.Q3)("",!0),e.bcc?((0,a.uX)(),(0,a.CE)("span",{key:2,class:"msg__view_bcc",title:`BCC: ${Array.isArray(e.cc)?e.bcc.join(", ")||"empty":e.bcc}`},"[bcc]",8,X)):(0,a.Q3)("",!0)]),(0,a.Lk)("td",$,(0,l.v_)(e.template&&e.template.name),1),(0,a.Lk)("td",j,(0,l.v_)(N.date_of(e)),1),(0,a.Lk)("td",Q,(0,l.v_)(N.status_of(e)),1),p.data.view.active==t?((0,a.uX)(),(0,a.CE)("div",T,[(0,a.Lk)("div",M,[(0,a.Lk)("pre",null,(0,l.v_)(JSON.stringify(e,null,2)),1)])])):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:(0,l.C4)(["msg__view_list_item__toggle msg_list_item__toggle",{click_escape:p.data.view.active==t}]),onClick:e=>p.data.view.active=p.data.view.active==t?null:t,title:"Close email data"},[(0,a.Lk)("div",{class:"msg_list_item__toggle__icon themed_icon",title:`${p.data.view.active==t?"Collapse":"Expand"} preview of ${t}`},null,8,D)],10,S)],6)))),128)),Object.keys(p.data.view.list).length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("tr",F,A))],64))])])):"send"==p.page?((0,a.uX)(),(0,a.CE)("div",K,[(0,a.Lk)("form",{onSubmit:t[12]||(t[12]=(0,i.D$)(((...e)=>N.send_message&&N.send_message(...e)),["prevent"]))},[(0,a.Lk)("div",H,[(0,a.Lk)("div",I,[(0,a.Lk)("div",U,[V,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.data.send.to=e),type:"text",id:"msg__send_to",name:"to",placeholder:"Email address(es)"},null,512),[[i.Jo,p.data.send.to]])]),(0,a.Lk)("div",q,[B,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.data.send.cc=e),type:"text",id:"msg__send_cc",name:"cc",placeholder:"Email address(es)"},null,512),[[i.Jo,p.data.send.cc]])]),(0,a.Lk)("div",W,[R,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>p.data.send.bcc=e),type:"text",id:"msg__send_bcc",name:"bcc",placeholder:"Email address(es)"},null,512),[[i.Jo,p.data.send.bcc]])])]),(0,a.Lk)("div",Y,[(0,a.Lk)("div",z,[G,(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>p.data.send.template=e),id:"msg__send_template",name:"template",onClick:t[5]||(t[5]=e=>{p.data.templates.loading&&N.fetch_templates()})},[(0,a.Lk)("option",P,(0,l.v_)(p.data.templates.loading?p.data.templates.load_triggered?"Loading...":"Click to load options":"Select a template"),1),Z,((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.data.templates.list,((e,t)=>((0,a.uX)(),(0,a.CE)("option",{key:t,value:t},[(0,a.eW)(" ["),(0,a.Lk)("strong",null,(0,l.v_)(t),1),(0,a.eW)('] - "'+(0,l.v_)(e.subject)+'" ',1)],8,ee)))),128))],512),[[i.u1,p.data.send.template]])]),p.data.send.template?((0,a.uX)(),(0,a.CE)("div",te,["custom"==p.data.send.template?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>p.data.send.subject=e),type:"text",id:"msg__send_subject",placeholder:"Enter the subject of your message",title:"Enter the subject of your message"},null,512),[[i.Jo,p.data.send.subject]]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>p.data.send.content=e),id:"msg__send_contents",placeholder:"Enter the primary (HTML) content of your message - note that most email clients will strip out <style> tags and inline styles are recommended; css3 is not supported in most clients.",title:"Enter the html content of your message",rows:"5"},null,512),[[i.Jo,p.data.send.content]]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>p.data.send.text=e),id:"msg__send_text",placeholder:"Enter the alt (plaintext) content of your message (optional)",title:"Enter the text content of your message",rows:"5"},null,512),[[i.Jo,p.data.send.text]])],64)):(0,a.bo)(((0,a.uX)(),(0,a.CE)("textarea",{key:1,onInput:t[9]||(t[9]=(...e)=>N.format_template_data&&N.format_template_data(...e)),"onUpdate:modelValue":t[10]||(t[10]=e=>p.data.send.data=e),id:"msg__send_data",placeholder:"JSON data to be used when rendering the handlebars template",title:"Enter data to be used in the template",rows:"5"},null,544)),[[i.Jo,p.data.send.data]])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",se,[(0,a.Lk)("button",{type:"submit",class:(0,l.C4)({disabled:N.send_issues}),title:"Attempt to send this message"},"Send",2),(0,a.Lk)("button",{type:"button",title:"Clear message options",onClick:t[11]||(t[11]=e=>N.clear_send()),style:{flex:"0 0 auto"}},"Clear")])])],32),(0,a.Lk)("div",ae,["custom"==p.data.send.template?((0,a.uX)(),(0,a.CE)("div",le,[p.data.send.content?((0,a.uX)(),(0,a.CE)("div",{key:1,innerHTML:p.data.send.content},null,8,ne)):((0,a.uX)(),(0,a.CE)("span",ie,"Add some content to preview your messages"))])):p.data.send.template?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"msg_page_list_item_content__html msg__send_preview__html msg__send_custom_preview__html",innerHTML:p.data.templates.list[p.data.send.template]?.html},null,8,de)):((0,a.uX)(),(0,a.CE)("div",_e,oe))])])):"templates"==p.page?((0,a.uX)(),(0,a.CE)("div",ce,[(0,a.Lk)("table",pe,[(0,a.Lk)("tr",re,[ge,p.data.view.active?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[ue,he],64))]),p.data.templates.loading?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(N.placeholder(8),(e=>((0,a.uX)(),(0,a.CE)("tr",{class:"msg_page_list_item msg_page_list_item_loading msg__templates_list_item part_loading_animation",key:e},Qe)))),128)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.data.templates.list,((e,t,s)=>((0,a.uX)(),(0,a.CE)("tr",{class:(0,l.C4)(["msg_page_list_item msg__templates_list_item admin_in",{active:p.data.templates.active==t}]),key:t,style:(0,l.Tr)({animationDelay:.03*(s+2)+.2+"s"})},[(0,a.Lk)("td",ve,(0,l.v_)(t),1),(0,a.Lk)("td",ke,(0,l.v_)(e.subject),1),(0,a.Lk)("td",ye,(0,l.v_)(e.text),1),p.data.templates.active==t?((0,a.uX)(),(0,a.CE)("div",we,[(0,a.Lk)("div",{class:"msg_templates_preview__html msg_page_list_item_content__html",innerHTML:e.html},null,8,fe)])):(0,a.Q3)("",!0),p.data.templates.active==t?((0,a.uX)(),(0,a.CE)("div",be,[(0,a.Lk)("div",{class:"msg_templates_preview__text",innerHTML:e.text.replace(/\\n/g,"<br/>")},null,8,Ce)])):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:(0,l.C4)(["msg__templates_list_item__toggle msg_list_item__toggle",{click_escape:p.data.templates.active==t}]),onClick:e=>p.data.templates.active=p.data.templates.active==t?null:t,title:"Close email contents preview"},[(0,a.Lk)("div",{class:"msg_list_item__toggle__icon themed_icon",title:`${p.data.templates.active==t?"Collapse":"Expand"} preview of ${t}`},null,8,Ee)],10,Le)],6)))),128)),Object.keys(p.data.templates.list).length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("tr",xe,$e))],64))])])):(0,a.Q3)("",!0)])]))],8,d)}s(4114);var Me=s(6669),Se=s(9218),De=s(4186),Fe={name:"MessagesAlerts",data(){return{page:"choose",choices:{view:{name:"View Sent",active:"Sent Messages"},send:{name:"Send New",active:"Create Message"},templates:{name:"Templates",active:"Message Templates"}},data:{view:{list:{},loading:!0,active:null,placeholder:this.placeholder(3)},send:{sending:!1,to:"",cc:"",bcc:"",template:"",data:"",content:"",text:"",subject:""},templates:{list:{},loading:!0,load_triggered:!1,active:null,placeholder:this.placeholder(8)}}}},methods:{async fetch_templates(){if(this.data.templates.list={},this.data.templates.loading=!0,this.data.templates.load_triggered)return;this.data.templates.load_triggered=!0;const e=(0,Se.Qg)(Me.Cn,"getTemplates"),t=Date.now(),{data:s,error:a}=await e(),l=Date.now()-t;if(a)return this.$status.error(`📃 Failed to fetch templates after ${l}ms`,a),void new De.Qp("Something went wrong loading the templates",a,2500);{const e=Object.keys(s||{}).length;this.$status.log(`📃 Fetched ${e} template${1==e?"":"s"} in ${l}ms`),this.data.templates.list=s||{},this.data.templates.loading=!1,this.data.templates.load_triggered=!1}},async fetch_messages(){this.data.view.list={},this.data.view.loading=!0;const e=(0,Se.Qg)(Me.Cn,"getSentMessages"),t=Date.now(),{data:s,error:a}=await e(),l=Date.now()-t;if(a)return this.$status.error(`📃 Failed to fetch messages after ${l}ms`,a),void new De.Qp("Something went wrong loading sent messages",a,2500);{const e=Object.keys(s||{}).length;this.$status.log(`📃 Fetched ${e} messages${1==e?"":"s"} in ${l}ms`),this.data.view.list=s||{},this.data.view.loading=!1}},placeholder(e){return Array.from({length:e},((e,t)=>t))},date_of(e){const t=1e3*(e?.delivery?.startTime?._seconds+e?.delivery?.startTime?._nanoseconds/1e9),s=new Date(t);return isNaN(s.getTime())?"Unknown":s.toLocaleDateString()},status_of(e){return e?.delivery?.state||"N/A"},format_template_data(){try{return this.data.send.data=JSON.stringify(JSON.parse(this.data.send.data),null,2),!0}catch(e){return new De.MY("Failed to parse JSON data, your message will not send correctly: "+e,3500),!1}},clear_send(e=!0){this.data.send={sending:!1,to:"",cc:"",bcc:"",template:"",data:"",content:"",text:"",subject:""},e&&new De.rQ("Message options cleared",2e3)},async send_message(){if(this.send_issues)new De.Qp("Cannot send message",this.send_issues,Math.max(2500,Math.min(1e3*this.send_issues.split(",").length,8e3)));else{this.data.send.sending=!0;const e=(0,Se.Qg)(Me.Cn,"sendEmail"),t=Date.now(),{data:s}=await e({to:this.data.send.to,cc:this.data.send.cc,bcc:this.data.send.bcc,message:"custom"==this.data.send.template?{subject:this.data.send.subject,html:this.data.send.content,text:this.data.send.text}:{template:this.data.send.template,data:JSON.parse(this.data.send.data)}}),a=Date.now()-t;s?(this.$status.log(`📧 Queued message in ${a}ms as ${s.id}`,s),new De.rQ("Message queued successfully",2e3),this.clear_send(!1)):(this.$status.error(`📧 Failed to send message after ${a}ms`,s),new De.Qp("Failed to send message",s,2500))}}},computed:{send_issues(){let e=[];if(this.data.send.sending)return"Message already being queued...";if(this.data.send.to||this.data.send.cc||this.data.send.bcc)for(let t of["to","cc","bcc"]){if(!this.data.send[t])continue;let s=this.data.send[t].trim().split(/[\s,]+/);for(let a of s)a.match(/^[^@]+@[^@]+\.[^@]+$/)||e.push(`Invalid email address in '${t}': "${a}"`)}else e.push("No recipient email address provided");return this.data.send.template?"custom"==this.data.send.template?(this.data.send.subject||e.push("No subject provided"),this.data.send.content||e.push("No content provided")):this.data.send.data?this.format_template_data()||e.push("Cannot parse JSON template data"):e.push("No data provided for template"):e.push("No template selected"),e.join(", ")}},mounted(){this.$route?.query?.action&&(this.page=this.$route.query.action)},watch:{page(){this.$router.push({query:{...this.$route.query,action:"choose"==this.page?void 0:this.page}}),"templates"==this.page&&this.data.templates.loading?this.fetch_templates():"view"==this.page&&this.data.view.loading&&this.fetch_messages(),this.data.templates.active=null,this.data.view.active=null}}},Ne=s(1241);const Ae=(0,Ne.A)(Fe,[["render",Te],["__scopeId","data-v-74bd715e"]]);var Je=Ae}}]);
//# sourceMappingURL=824.f0cffcc2.js.map