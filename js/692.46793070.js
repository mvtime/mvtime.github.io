"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[692],{2692:function(t,e,s){s.r(e),s.d(e,{default:function(){return I}});s(4114);var i=s(6768),a=s(4232),n=s(5130);const l=t=>((0,i.Qi)("data-v-39b96a20"),t=t(),(0,i.jt)(),t),o={class:"edit_task"},r={class:"modal_header",ref:"title"},d={class:"header_style modal_header_title"},h={class:"overlay_contents",ref:"contents"},c={key:0},k={class:"overlay_contents_text change_text"},_=["href"],p={class:"inputs_row"},u=["placeholder","disabled"],y=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),m=["placeholder"],f=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),g={class:"styled_input styled_links_box"},w={class:"styled_links_display"},v={key:0,class:"placeholder"},x={key:1,class:"styled_line_links"},b=["onClick"],C=l((()=>(0,i.Lk)("hr",{class:"styled_links_separator"},null,-1))),$={class:"magic_wrapper styled_links_add__sized"},L=["disabled"],A=["disabled"],T={key:1,alt:"Loading Icon",class:"loading_icon"},E={key:1,class:"warning_text overlay_contents_text"},S={key:2,class:"overlay_contents_text repetition_warning bottom_actions"},X=l((()=>(0,i.Lk)("span",{class:"flex_spacer",style:{display:"none"}},null,-1))),O={class:"bottom_actions"},Q=l((()=>(0,i.Lk)("div",{class:"flex_spacer"},null,-1))),j=["disabled"],J=["disabled"];function M(t,e,s,l,M,N){const R=(0,i.g2)("Modal"),U=(0,i.g2)("OverlayWrapper");return(0,i.uX)(),(0,i.CE)("div",o,[M.showArchiveConfirm?((0,i.uX)(),(0,i.Wv)(U,{key:0,onClose:e[0]||(e[0]=t=>M.showArchiveConfirm=!1)},{default:(0,i.k6)((t=>[(0,i.bF)(R,{class:"confirm_modal router_center_view",can_continue:!0,title:"Archive Tasks",html:N.archiveConfirmHtml,continue_action:()=>N.confirmArchiveSeries(),skippable:!0,onSkip:t.close,skip_text:"Cancel",submit_text:"Archive"},null,8,["html","continue_action","onSkip"])])),_:1})):(0,i.Q3)("",!0),(0,i.Lk)("header",r,[(0,i.Lk)("h2",d,"Edit "+(0,a.v_)(M.task.type||"task")+" details",1)],512),(0,i.Lk)("div",h,[M.ready?((0,i.uX)(),(0,i.CE)("div",c,[(0,i.Lk)("div",k,[(0,i.eW)(" Change the details of your "+(0,a.v_)(M.task.type||"task")+(0,a.v_)(M.original.name?` "${M.original.name}"`:"")+" in ",1),(0,i.Lk)("a",{class:"class_name button_pointer_text",href:`/view/${M.task._class?.ref}`,onClick:e[1]||(e[1]=e=>{e.preventDefault(),t.$router.push({name:"viewclass",params:{ref:M.task._class?.ref},query:t.$route.query})}),style:(0,a.Tr)({"--color-class":N.class_obj?.color,"--color-class-alt":N.class_obj?.color+"2d"})},(0,a.v_)(t.$store.class_text(N.class_obj)),13,_)]),(0,i.Lk)("div",p,[N.is_note?(0,i.Q3)("",!0):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,"onUpdate:modelValue":e[2]||(e[2]=t=>M.task.name=t),class:"styled_input",type:"text",placeholder:N.type_full+" Name",disabled:N.is_note,enterkeyhint:"next",onKeydown:e[3]||(e[3]=(0,n.jR)((e=>t.$refs.date.focus()),["enter"]))},null,40,u)),[[n.Jo,M.task.name]]),(0,i.bo)((0,i.Lk)("input",{ref:"date",type:"date",class:"styled_input input_task__date","onUpdate:modelValue":e[4]||(e[4]=t=>M.task.date=t),style:(0,a.Tr)({maxWidth:N.is_note?"100%":null}),enterkeyhint:"next",onKeydown:e[5]||(e[5]=(0,n.jR)((e=>t.$refs.description.focus()),["enter"]))},null,36),[[n.Jo,M.task.date]]),y,(0,i.bo)((0,i.Lk)("textarea",{ref:"description","onUpdate:modelValue":e[6]||(e[6]=t=>M.task.description=t),class:"styled_input styled_textarea task_description",type:"text",placeholder:N.type_full+(N.is_note?" Contents":" Description (Optional)")},"\n          ",8,m),[[n.Jo,M.task.description]]),f,(0,i.Lk)("div",g,[(0,i.Lk)("div",w,[M.task.links&&M.task.links.length?((0,i.uX)(),(0,i.CE)("div",x,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(M.task.links,(t=>((0,i.uX)(),(0,i.CE)("a",{class:"styled_line_links__link styled_line_links__remove",target:"_blank",key:t.path,onClick:e=>N.remove_link(t)},(0,a.v_)(t.text),9,b)))),128))])):((0,i.uX)(),(0,i.CE)("span",v,(0,a.v_)(N.type_full)+" Links (Optional)",1))]),C,(0,i.Lk)("div",{class:"styled_links_add",onKeydown:e[12]||(e[12]=(0,n.jR)((t=>{t.preventDefault(),N.add_newlink()}),["enter"])),enterkeyhint:"done"},[(0,i.bo)((0,i.Lk)("input",{class:"styled_links_add__path",type:"url","onUpdate:modelValue":e[7]||(e[7]=t=>M.newlink.path=t),onBlur:e[8]||(e[8]=(...t)=>N.fix_newlink_path&&N.fix_newlink_path(...t)),placeholder:"Link URL (http://example.com)",enterkeyhint:"done"},null,544),[[n.Jo,M.newlink.path]]),(0,i.Lk)("div",$,[(0,i.bo)((0,i.Lk)("input",{class:"styled_links_add__text",type:"text","onUpdate:modelValue":e[9]||(e[9]=t=>M.newlink.text=t),placeholder:"Link Text (what students see)",enterkeyhint:"done"},null,512),[[n.Jo,M.newlink.text]]),(0,i.Lk)("div",{class:(0,a.C4)(["magic magic_in styled_magic alt_bg click-action",{magic_out:!N.path_ready,loading_bg:M.loading_text}]),disabled:!N.path_ready||M.loading_text,onClick:e[10]||(e[10]=(...t)=>N.magic_text&&N.magic_text(...t)),title:"Auto-generate link text"},null,10,L)]),(0,i.Lk)("button",{class:"styled_links_add__action",onClick:e[11]||(e[11]=(...t)=>N.add_newlink&&N.add_newlink(...t)),disabled:N.newlink_not_ready},"Add",8,A)],32)])])])):((0,i.uX)(),(0,i.CE)("img",T))],512),M.task.repetition_group_id?((0,i.uX)(),(0,i.CE)("div",E,"Save changes to this "+(0,a.v_)(M.task.type||"task")+" to",1)):(0,i.Q3)("",!0),M.task.repetition_group_id?((0,i.uX)(),(0,i.CE)("div",S,[X,(0,i.Lk)("button",{class:(0,a.C4)(["scope_button secondary_styled",{selected:"this"==M.edit_scope}]),onClick:e[13]||(e[13]=t=>M.edit_scope="this")},"This Task",2),(0,i.Lk)("button",{class:(0,a.C4)(["scope_button secondary_styled",{selected:"future"==M.edit_scope}]),onClick:e[14]||(e[14]=t=>M.edit_scope="future")},"This & Future",2),(0,i.Lk)("button",{class:(0,a.C4)(["scope_button secondary_styled",{selected:"all"==M.edit_scope}]),onClick:e[15]||(e[15]=t=>M.edit_scope="all")},"All Tasks",2)])):(0,i.Q3)("",!0),(0,i.Lk)("div",O,[(0,i.Lk)("button",{class:"close_action click_escape",onClick:e[16]||(e[16]=e=>t.$emit("close"))},"Cancel"),Q,(0,i.Lk)("button",{class:(0,a.C4)(["archive_action primary_styled",{loading_bg:M.loading}]),onClick:e[17]||(e[17]=(...t)=>N.archive_task&&N.archive_task(...t)),disabled:!M.ready||M.loading},"Archive"+(0,a.v_)(N.scope_text),11,j),(0,i.Lk)("button",{class:(0,a.C4)(["continue_action click_ctrlenter",{loading_bg:M.loading}]),onClick:e[18]||(e[18]=(...t)=>N.try_submit&&N.try_submit(...t)),disabled:N.not_submittable}," Save"+(0,a.v_)(N.scope_text)+" "+(0,a.v_)(M.task.type||"task")+(0,a.v_)(N.scope_text?"s":""),11,J)])])}s(3375),s(9225),s(3972),s(9209),s(5714),s(7561),s(6197),s(4603),s(7566),s(8721);var N=s(6301),R=s(4186),U=s(6471),q=s.n(U),D=s(4411),W=s(4618),Y={name:"EditTaskView",emits:["close"],mixins:[q()],components:{OverlayWrapper:D.A,Modal:W.A},data(){return{task:{},original:{},newlink:{text:"",path:""},ready:!1,loading:!0,loading_text:!1,loaded_text:!1,edit_scope:"this",showArchiveConfirm:!1}},mounted(){this.$smoothReflow({el:this.$refs.contents,childTransitions:!0}),this.$smoothReflow({el:this.$refs.title,hideOverflow:!0}),this.get_task()},computed:{not_submittable(){return!this.changed||!this.task.name&&!this.is_note||!this.task.date||this.is_note&&!this.task.description},type_full(){return this.$magic?.type_full(this.task.type)||"Task"},newlink_not_ready(){return!this.newlink.path||!this.newlink.text||!this.newlink.path.startsWith("http")},class_obj(){let t=this.$store?.classes;return t?t.find((t=>t.id===this.original.class_id))||{}:null},is_note(){return"note"===this.task.type},changed(){return JSON.stringify(this.task)!==JSON.stringify(this.original)},date(){let t=(0,N.kX)(this.task?.date);if(!isNaN(t.getTime()))return t=new Date(t.getTime()+60*t.getTimezoneOffset()*1e3),new Date(t).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})},path_ready(){return!this.loaded_text&&this.newlink.path&&this.newlink_not_ready&&this.newlink.path.startsWith("https://")},scope_text(){return this.task.repetition_group_id&&"this"!==this.edit_scope?"future"===this.edit_scope?" future":" all":""},archiveConfirmHtml(){const t="future"===this.edit_scope?"this and all future tasks in the series":"all tasks in this series";return`<div class="overlay_contents_text">Are you sure you want to archive ${t}?<br><br>This action cannot be undone.</div>`}},watch:{"newlink.path"(t,e){t!=e&&(this.loaded_text=!1)},"newlink.text"(t,e){t!=e&&(this.loaded_text=!1)}},methods:{try_submit(){this.not_submittable?this.changed?new R.MY("Please fill out all required fields",1e3):new R.MY("No changes to submit",1e3):this.update_task()},add_newlink(){this.task.links||(this.task.links=[]),this.newlink.path=new URL(this.newlink.path).href,this.task.links.push(this.newlink),this.task.links=[...new Set(this.task.links)],this.newlink={text:"",path:""}},async update_task(){if(!this.newlink_not_ready)return void new R.MY("Don't forget to to click the 'Add' button to add your link!",2e3);let t;this.loading=!0,t="this"===this.edit_scope?this.$store.update_task(this.task.ref,this.task):this.$store.update_repeating_task(this.task.repetition_group_id,this.task,this.edit_scope,this.task.ref,this.task.date),t.then((()=>{this.$router.push({name:"viewtask",params:{ref:this.$route.params.ref},query:this.$route.query})})).catch((t=>{this.loading=!1,this.$status.error(`ðŸ“ƒ Couldn't save changes to ${this.task.type||"task"}:`,t),new R.Qp(`Couldn't edit ${this.task.type||"task"}`,t,2e3)}))},archive_task(){"this"!==this.edit_scope&&this.task.repetition_group_id?this.showArchiveConfirm=!0:this.$router.push({name:"archive",params:{type:this.task.type,ref:this.$route.params.ref},query:{title:this.is_note?this.task.description:this.task.name,...this.$route.query}})},confirmArchiveSeries(){this.showArchiveConfirm=!1,this.loading=!0,this.$store.delete_repeating_task(this.task.repetition_group_id,this.edit_scope,this.task.ref,this.task.date).then((()=>{this.$emit("close")})).catch((t=>{this.loading=!1,new R.Qp("Couldn't archive series",t,2e3)}))},async get_task(){const t=this.$route.params.ref.split("~").join("/");t?t.split("/").length<3&&(new R.MY("Invalid task specified",1500),this.$emit("close")):(new R.MY("No task specified",1500),this.$emit("close")),this.$store.task_from_ref(t).then((t=>{t?(this.task=t,this.original=JSON.parse(JSON.stringify(t)),this.ready=!0,this.loading=!1):(new R.MY("Couldn't find that task",2e3),this.$status.warn("âš  Couldn't find task"),this.$emit("close"))})).catch((t=>{new R.Qp("Error getting task",t,1500),this.$status.error("âš  Error getting task",t),this.$emit("close")}))},remove_link(t){this.task.links=this.task.links.filter((e=>e.path!==t.path)),this.newlink=t},fix_newlink_path(){if(this.newlink.path&&this.newlink.path.includes("."))try{this.newlink.path=new URL(this.newlink.path).href}catch(t){this.newlink.path="https://"+this.newlink.path,this.fix_newlink_path()}},async magic_text(){this.path_ready&&!this.newlink.text&&(this.loading_text=!0,this.$magic.text(this.newlink.path).then((t=>{t?(new R.rQ(`Generated link text '${t}'`,1500),this.$status.log("ðŸ”— Generated link text:",t),this.newlink.text=t):(new R.MY("Couldn't reasonably infer link text",2e3),this.$status.warn("ðŸ“ƒ Couldn't generate link text")),this.loaded_text=!0,this.loading_text=!1})).catch((t=>{new R.Qp("Couldn't generate link text",t,3e3),this.$status.error("âš  Failed link text generation:",t),this.loaded_text=!1,this.loading_text=!1})))}}},V=s(1241);const F=(0,V.A)(Y,[["render",M],["__scopeId","data-v-39b96a20"]]);var I=F}}]);