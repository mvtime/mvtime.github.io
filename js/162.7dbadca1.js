"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[162],{1162:function(e,t,s){s.r(t),s.d(t,{default:function(){return Ve}});var a=s(6768),l=s(4232),i=s(5130);const n=e=>((0,a.Qi)("data-v-89881f48"),e=e(),(0,a.jt)(),e),d=["page"],_={key:0,class:"msg_choose"},m=["onClick","disabled"],o={key:1,class:"msg_page_wrapper"},c={key:0,class:"msg_page_info admin_in",style:{animationDelay:"0.1s"}},r=n((()=>(0,a.Lk)("div",{class:"msg_page__back__icon themed_icon"},null,-1))),p=[r],g={class:"msg_page_info__text"},u=n((()=>(0,a.Lk)("hr",{class:"msg_page_wrapper__separator admin_in",style:{animationDelay:3*.05+"s"}},null,-1))),h={class:"msg_page_container admin_in",style:{animationDelay:"0.2s"}},v={key:0,class:"msg_page msg__view"},k={class:"msg_page_list msg__view_list"},y={class:"msg_page_list_header msg__view_list_header"},f=n((()=>(0,a.Lk)("th",{style:{flex:"1 2 6em","min-width":"6em"}},"Recepient",-1))),w=n((()=>(0,a.Lk)("th",{class:"msg__nomobile",style:{flex:"1 1 6em"}},"Template",-1))),b=n((()=>(0,a.Lk)("th",{style:{flex:"2 1 6.5em"}},"Date",-1))),L=n((()=>(0,a.Lk)("th",{style:{flex:"0 0 5em"}},"Status",-1))),C={style:{flex:"1 2 6em","min-width":"6em"}},E=["title"],x=["title"],X=["title"],$={class:"msg__nomobile",style:{flex:"1 1 6em"}},T={style:{flex:"2 1 6.5em"}},N={style:{flex:"0 0 5em"}},j={key:0,class:"msg_page_list_item_content msg_view_preview"},A={class:"msg_view_preview__json"},Q=["onClick"],D=["title"],M={key:0,class:"msg_page_list_item__empty admin_in",style:{animationDelay:"0.26s"}},S=n((()=>(0,a.Lk)("span",null,"No sent messages exist yet",-1))),F=[S],J=n((()=>(0,a.Lk)("div",{class:"part_loading_animation msg_page_list_item_loading_button"},null,-1))),O=[J],U={key:1,class:"msg_page msg__send"},V={class:"msg__send_form"},K={class:"msg__send_form_item"},I={class:"msg__send_form_item msg__send_form_pair"},H=n((()=>(0,a.Lk)("label",{for:"msg__send_to"},"To:",-1))),q={class:"msg__send_form_item msg__send_form_pair"},P=n((()=>(0,a.Lk)("label",{for:"msg__send_cc"},"CC:",-1))),B={class:"msg__send_form_item msg__send_form_pair"},R=n((()=>(0,a.Lk)("label",{for:"msg__send_bcc"},"BCC:",-1))),G={class:"msg__send_form_item msg__send_form_pair"},W=n((()=>(0,a.Lk)("label",{for:"msg__send_from"},"From:",-1))),Y=["placeholder"],z={class:"msg__send_form_item"},Z={class:"msg__send_form_item msg__send_form_pair"},ee=n((()=>(0,a.Lk)("label",{for:"msg__send_template"},"Template:",-1))),te={value:"",disabled:"",selected:""},se=n((()=>(0,a.Lk)("option",{value:"custom"},"[custom] - Create your own message",-1))),ae=["value"],le={key:0,class:"msg__send_template_options msg__send_form_item"},ie={class:"msg__send_form_item"},ne={class:"msg_page_list_item_content msg__send_preview"},de={key:0,class:"msg_page_list_item_content__html msg__send_preview__html msg__send_template_preview__html"},_e={key:0},me=["innerHTML"],oe=["innerHTML"],ce={key:2,class:"msg_page_list_item_content__html msg__send_preview__html"},re=n((()=>(0,a.Lk)("span",null,"Select a template to preview it here",-1))),pe=[re],ge={key:2,class:"msg_page msg__templates"},ue={class:"msg_page_list msg__templates_list"},he={class:"msg_page_list_header msg__templates_list_header"},ve=n((()=>(0,a.Lk)("th",{style:{flex:"0 1 10em"}},"Template",-1))),ke=n((()=>(0,a.Lk)("th",{style:{flex:"1 4 20em"}},"Subject",-1))),ye=n((()=>(0,a.Lk)("th",{class:"msg__nomobile",style:{flex:"4 10 20em"}},"Text",-1))),fe={style:{flex:"1 1 10em"}},we={style:{flex:"2 4 20em"}},be={class:"msg__nomobile",style:{flex:"8 10 20em"}},Le={key:0,class:"msg_page_list_item_content msg_templates_preview"},Ce=["innerHTML"],Ee={key:1,class:"msg_page_list_item_content msg_templates_preview"},xe=["innerHTML"],Xe=["onClick"],$e=["title"],Te={key:0,class:"msg_page_list_item__empty admin_in",style:{animationDelay:"0.26s"}},Ne=n((()=>(0,a.Lk)("span",null,"No templates exist yet",-1))),je=[Ne],Ae=n((()=>(0,a.Lk)("div",{class:"part_loading_animation msg_page_list_item_loading_button"},null,-1))),Qe=[Ae];function De(e,t,s,n,r,S){return(0,a.uX)(),(0,a.CE)("div",{class:"messagesalerts",page:r.page},["choose"==r.page?((0,a.uX)(),(0,a.CE)("div",_,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.choices,((e,t,s)=>((0,a.uX)(),(0,a.CE)("div",{class:(0,l.C4)(`msg_choose_page msg_choose__${t} admin_in`),key:t,onClick:s=>{e.disabled||(r.page=t)},style:(0,l.Tr)({animationDelay:.05*(s+2)+"s"}),disabled:e.disabled},(0,l.v_)(e.name),15,m)))),128))])):((0,a.uX)(),(0,a.CE)("div",o,["choose"!=r.page?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("button",{class:"msg_page__back",onClick:t[0]||(t[0]=e=>r.page="choose")},p),(0,a.Lk)("div",g,(0,l.v_)(r.choices[r.page].active),1)])):(0,a.Q3)("",!0),u,(0,a.Lk)("div",h,["view"==r.page?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("table",k,[(0,a.Lk)("tr",y,[f,r.data.view.active?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[w,b,L],64))]),r.data.view.loading?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(S.placeholder(3),(e=>((0,a.uX)(),(0,a.CE)("tr",{class:"msg_page_list_item msg_page_list_item_loading msg__view_list_item part_loading_animation",key:e},O)))),128)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.data.view.list,((e,t,s)=>((0,a.uX)(),(0,a.CE)("tr",{class:(0,l.C4)(["msg_page_list_item msg__view_list_item admin_in",{active:r.data.view.active==t}]),key:t,style:(0,l.Tr)({animationDelay:.03*(s+2)+.2+"s"})},[(0,a.Lk)("td",C,[e.to?((0,a.uX)(),(0,a.CE)("span",{key:0,class:"msg__view_to",title:`TO: ${Array.isArray(e.to)?e.to.join(", ")||"empty":e.to}`},(0,l.v_)(Array.isArray(e.to)?e.to.length+" emails":e.to.split("@")[0])+"âŸ",9,E)):(0,a.Q3)("",!0),e.cc?((0,a.uX)(),(0,a.CE)("span",{key:1,class:"msg__view_cc",title:`CC: ${Array.isArray(e.cc)?e.cc.join(", ")||"empty":e.cc}`},"[cc]âŸ",8,x)):(0,a.Q3)("",!0),e.bcc?((0,a.uX)(),(0,a.CE)("span",{key:2,class:"msg__view_bcc",title:`BCC: ${Array.isArray(e.cc)?e.bcc.join(", ")||"empty":e.bcc}`},"[bcc]",8,X)):(0,a.Q3)("",!0)]),(0,a.Lk)("td",$,(0,l.v_)(e.template&&e.template.name),1),(0,a.Lk)("td",T,(0,l.v_)(S.date_of(e)),1),(0,a.Lk)("td",N,(0,l.v_)(S.status_of(e)),1),r.data.view.active==t?((0,a.uX)(),(0,a.CE)("div",j,[(0,a.Lk)("div",A,[(0,a.Lk)("pre",null,(0,l.v_)(JSON.stringify(e,null,2)),1)])])):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:(0,l.C4)(["msg__view_list_item__toggle msg_list_item__toggle",{click_escape:r.data.view.active==t}]),onClick:e=>r.data.view.active=r.data.view.active==t?null:t,title:"Close email data"},[(0,a.Lk)("div",{class:"msg_list_item__toggle__icon themed_icon",title:`${r.data.view.active==t?"Collapse":"Expand"} preview of ${t}`},null,8,D)],10,Q)],6)))),128)),Object.keys(r.data.view.list).length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("tr",M,F))],64))])])):"send"==r.page?((0,a.uX)(),(0,a.CE)("div",U,[(0,a.Lk)("form",{onSubmit:t[13]||(t[13]=(0,i.D$)(((...e)=>S.send_message&&S.send_message(...e)),["prevent"]))},[(0,a.Lk)("div",V,[(0,a.Lk)("div",K,[(0,a.Lk)("div",I,[H,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.data.send.to=e),type:"text",id:"msg__send_to",name:"to",placeholder:"Email address(es)"},null,512),[[i.Jo,r.data.send.to]])]),(0,a.Lk)("div",q,[P,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.data.send.cc=e),type:"text",id:"msg__send_cc",name:"cc",placeholder:"Email address(es)"},null,512),[[i.Jo,r.data.send.cc]])]),(0,a.Lk)("div",B,[R,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.data.send.bcc=e),type:"text",id:"msg__send_bcc",name:"bcc",placeholder:"Email address(es)"},null,512),[[i.Jo,r.data.send.bcc]])]),(0,a.Lk)("div",G,[W,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.data.send.from=e),type:"text",id:"msg__send_from",name:"from",placeholder:`The ${this.$env.VUE_APP_BRAND_NAME_LONG} Team`},null,8,Y),[[i.Jo,r.data.send.from]])])]),(0,a.Lk)("div",z,[(0,a.Lk)("div",Z,[ee,(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>r.data.send.template=e),id:"msg__send_template",name:"template",onClick:t[6]||(t[6]=e=>{r.data.templates.loading&&S.fetch_templates()})},[(0,a.Lk)("option",te,(0,l.v_)(r.data.templates.loading?r.data.templates.load_triggered?"Loading...":"Click to load options":"Select a template"),1),se,((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.data.templates.list,((e,t)=>((0,a.uX)(),(0,a.CE)("option",{key:t,value:t},[(0,a.eW)(" ["),(0,a.Lk)("strong",null,(0,l.v_)(t),1),(0,a.eW)('] - "'+(0,l.v_)(e.subject)+'" ',1)],8,ae)))),128))],512),[[i.u1,r.data.send.template]])]),r.data.send.template?((0,a.uX)(),(0,a.CE)("div",le,["custom"==r.data.send.template?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>r.data.send.subject=e),type:"text",id:"msg__send_subject",placeholder:"Enter the subject of your message",title:"Enter the subject of your message"},null,512),[[i.Jo,r.data.send.subject]]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>r.data.send.content=e),id:"msg__send_contents",placeholder:"Enter the primary (HTML) content of your message - note that most email clients will strip out <style> tags and inline styles are recommended; css3 is not supported in most clients.",title:"Enter the html content of your message",rows:"5"},null,512),[[i.Jo,r.data.send.content]]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>r.data.send.text=e),id:"msg__send_text",placeholder:"Enter the alt (plaintext) content of your message (optional)",title:"Enter the text content of your message",rows:"5"},null,512),[[i.Jo,r.data.send.text]])],64)):(0,a.bo)(((0,a.uX)(),(0,a.CE)("textarea",{key:1,onInput:t[10]||(t[10]=(...e)=>S.format_template_data&&S.format_template_data(...e)),"onUpdate:modelValue":t[11]||(t[11]=e=>r.data.send.data=e),id:"msg__send_data",placeholder:"JSON data to be used when rendering the handlebars template",title:"Enter data to be used in the template",rows:"5"},null,544)),[[i.Jo,r.data.send.data]])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ie,[(0,a.Lk)("button",{type:"submit",class:(0,l.C4)({disabled:S.send_issues}),title:"Attempt to send this message"},"Send",2),(0,a.Lk)("button",{type:"button",title:"Clear message options",onClick:t[12]||(t[12]=e=>S.clear_send()),style:{flex:"0 0 auto"}},"Clear")])])],32),(0,a.Lk)("div",ne,["custom"==r.data.send.template?((0,a.uX)(),(0,a.CE)("div",de,[r.data.send.content?((0,a.uX)(),(0,a.CE)("div",{key:1,innerHTML:r.data.send.content},null,8,me)):((0,a.uX)(),(0,a.CE)("span",_e,"Add some content to preview your messages"))])):r.data.send.template?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"msg_page_list_item_content__html msg__send_preview__html msg__send_custom_preview__html",innerHTML:r.data.templates.list[r.data.send.template]?.html},null,8,oe)):((0,a.uX)(),(0,a.CE)("div",ce,pe))])])):"templates"==r.page?((0,a.uX)(),(0,a.CE)("div",ge,[(0,a.Lk)("table",ue,[(0,a.Lk)("tr",he,[ve,r.data.view.active?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[ke,ye],64))]),r.data.templates.loading?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(S.placeholder(8),(e=>((0,a.uX)(),(0,a.CE)("tr",{class:"msg_page_list_item msg_page_list_item_loading msg__templates_list_item part_loading_animation",key:e},Qe)))),128)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.data.templates.list,((e,t,s)=>((0,a.uX)(),(0,a.CE)("tr",{class:(0,l.C4)(["msg_page_list_item msg__templates_list_item admin_in",{active:r.data.templates.active==t}]),key:t,style:(0,l.Tr)({animationDelay:.03*(s+2)+.2+"s"})},[(0,a.Lk)("td",fe,(0,l.v_)(t),1),(0,a.Lk)("td",we,(0,l.v_)(e.subject),1),(0,a.Lk)("td",be,(0,l.v_)(e.text),1),r.data.templates.active==t?((0,a.uX)(),(0,a.CE)("div",Le,[(0,a.Lk)("div",{class:"msg_templates_preview__html msg_page_list_item_content__html",innerHTML:e.html},null,8,Ce)])):(0,a.Q3)("",!0),r.data.templates.active==t?((0,a.uX)(),(0,a.CE)("div",Ee,[(0,a.Lk)("div",{class:"msg_templates_preview__text",innerHTML:e.text.replace(/\\n/g,"<br/>")},null,8,xe)])):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:(0,l.C4)(["msg__templates_list_item__toggle msg_list_item__toggle",{click_escape:r.data.templates.active==t}]),onClick:e=>r.data.templates.active=r.data.templates.active==t?null:t,title:"Close email contents preview"},[(0,a.Lk)("div",{class:"msg_list_item__toggle__icon themed_icon",title:`${r.data.templates.active==t?"Collapse":"Expand"} preview of ${t}`},null,8,$e)],10,Xe)],6)))),128)),Object.keys(r.data.templates.list).length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("tr",Te,je))],64))])])):(0,a.Q3)("",!0)])]))],8,d)}s(4114);var Me=s(6669),Se=s(9218),Fe=s(4186),Je={name:"MessagesAlerts",data(){return{page:"choose",choices:{view:{name:"View Sent",active:"Sent Messages"},send:{name:"Send New",active:"Create Message"},templates:{name:"Templates",active:"Message Templates"}},data:{view:{list:{},loading:!0,active:null,placeholder:this.placeholder(3)},send:{sending:!1,to:"",cc:"",bcc:"",template:"",data:"",content:"",text:"",subject:""},templates:{list:{},loading:!0,load_triggered:!1,active:null,placeholder:this.placeholder(8)}}}},methods:{async fetch_templates(){if(this.data.templates.list={},this.data.templates.loading=!0,this.data.templates.load_triggered)return;this.data.templates.load_triggered=!0;const e=(0,Se.Qg)(Me.Cn,"getTemplates"),t=Date.now(),{data:s,error:a}=await e(),l=Date.now()-t;if(a)return this.$status.error(`ðŸ“ƒ Failed to fetch templates after ${l}ms`,a),void new Fe.Qp("Something went wrong loading the templates",a,2500);{const e=Object.keys(s||{}).length;this.$status.log(`ðŸ“ƒ Fetched ${e} template${1==e?"":"s"} in ${l}ms`),this.data.templates.list=s||{},this.data.templates.loading=!1,this.data.templates.load_triggered=!1}},async fetch_messages(){this.data.view.list={},this.data.view.loading=!0;const e=(0,Se.Qg)(Me.Cn,"getSentMessages"),t=Date.now(),{data:s,error:a}=await e(),l=Date.now()-t;if(a)return this.$status.error(`ðŸ“ƒ Failed to fetch messages after ${l}ms`,a),void new Fe.Qp("Something went wrong loading sent messages",a,2500);{const e=Object.keys(s||{}).length;this.$status.log(`ðŸ“ƒ Fetched ${e} messages${1==e?"":"s"} in ${l}ms`),this.data.view.list=s||{},this.data.view.loading=!1}},placeholder(e){return Array.from({length:e},((e,t)=>t))},date_of(e){const t=1e3*(e?.delivery?.startTime?._seconds+e?.delivery?.startTime?._nanoseconds/1e9),s=new Date(t);return isNaN(s.getTime())?"Unknown":s.toLocaleDateString()},status_of(e){return e?.delivery?.state||"N/A"},format_template_data(){try{return this.data.send.data=JSON.stringify(JSON.parse(this.data.send.data),null,2),!0}catch(e){return new Fe.MY("Failed to parse JSON data, your message will not send correctly: "+e,3500),!1}},clear_send(e=!0){this.data.send={sending:!1,to:"",cc:"",bcc:"",template:"",data:"",content:"",text:"",subject:""},e&&new Fe.rQ("Message options cleared",2e3)},async send_message(){if(this.send_issues)new Fe.Qp("Cannot send message",this.send_issues,Math.max(2500,Math.min(1e3*this.send_issues.split(",").length,8e3)));else{this.data.send.sending=!0;const e=(0,Se.Qg)(Me.Cn,"sendEmail"),t=Date.now(),{data:s}=await e({to:this.data.send.to,cc:this.data.send.cc,from:{name:this.data.send.from||`The ${this.$env.VUE_APP_BRAND_NAME_LONG} Team`,address:this.$env.VUE_APP_BRAND_MAIL_ADDRESS},bcc:this.data.send.bcc,..."custom"==this.data.send.template?{message:{subject:this.data.send.subject,html:this.data.send.content,text:this.data.send.text}}:{template:{name:this.data.send.template,data:JSON.parse(this.data.send.data)}}}),a=Date.now()-t;s?(this.$status.log(`ðŸ“§ Queued message in ${a}ms as ${s.id}`,s),new Fe.rQ("Message queued successfully",2e3),this.clear_send(!1)):(this.$status.error(`ðŸ“§ Failed to send message after ${a}ms`,s),new Fe.Qp("Failed to send message",s,2500))}}},computed:{send_issues(){let e=[];if(this.data.send.sending)return"Message already being queued...";if(this.data.send.to||this.data.send.cc||this.data.send.bcc)for(let t of["to","cc","bcc"]){if(!this.data.send[t])continue;let s=this.data.send[t].trim().split(/[\s,]+/);for(let a of s)a.match(/^[^@]+@[^@]+\.[^@]+$/)||e.push(`Invalid email address in '${t}': "${a}"`)}else e.push("No recipient email address provided");return this.data.send.template?"custom"==this.data.send.template?(this.data.send.subject||e.push("No subject provided"),this.data.send.content||e.push("No content provided")):this.data.send.data?this.format_template_data()||e.push("Cannot parse JSON template data"):e.push("No data provided for template"):e.push("No template selected"),e.join(", ")}},mounted(){this.$route?.query?.action&&(this.page=this.$route.query.action)},watch:{page(){this.$router.push({query:{...this.$route.query,action:"choose"==this.page?void 0:this.page}}),"templates"==this.page&&this.data.templates.loading?this.fetch_templates():"view"==this.page&&this.data.view.loading&&this.fetch_messages(),this.data.templates.active=null,this.data.view.active=null}}},Oe=s(1241);const Ue=(0,Oe.A)(Je,[["render",De],["__scopeId","data-v-89881f48"]]);var Ve=Ue}}]);
//# sourceMappingURL=162.7dbadca1.js.map