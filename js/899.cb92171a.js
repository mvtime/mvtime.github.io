"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[899],{4027:function(e,t,s){s.d(t,{A:function(){return k}});var i=s(6768),a=s(4232);const n=e=>((0,i.Qi)("data-v-521703de"),e=e(),(0,i.jt)(),e),l=["disabled"],o=n((()=>(0,i.Lk)("span",{class:"loading_bg"},null,-1))),d=[o],r=n((()=>(0,i.Lk)("div",{class:"toggle_switch_knob"},null,-1)));function p(e,t,s,n,o,p){return(0,i.uX)(),(0,i.CE)("div",{class:(0,a.C4)(["toggle_switch",{toggle_switch__on:o.is_on,transition:!s.loads}]),disabled:s.disabled,onClick:t[0]||(t[0]=(...e)=>p.toggle&&p.toggle(...e))},[s.loads?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,a.C4)(["toggle_switch__loading",{is_loading:o.loading}])},d,2)):(0,i.Q3)("",!0),r],10,l)}var h={name:"ToggleBar",props:{value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loads:{type:Boolean,default:!1}},emits:["update"],data(){return{is_on:this.value,loading:!1}},watch:{value(){this.is_on=this.value,this.loading=!1}},methods:{toggle(){this.disabled||(this.loads?this.loading=!0:this.is_on=!this.is_on,this.$emit("update",!this.is_on))}}},c=s(1241);const _=(0,c.A)(h,[["render",p],["__scopeId","data-v-521703de"]]);var k=_},899:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var i=s(6768),a=s(4232),n=s(5130);const l=e=>((0,i.Qi)("data-v-5e7e5584"),e=e(),(0,i.jt)(),e),o={class:"create_task"},d={class:"modal_header"},r={class:"header_style modal_header_title"},p=["value"],h=["disabled"],c={class:"overlay_contents",ref:"contents"},_={class:"overlay_contents_text"},k={key:0},u={key:1},y={class:"inputs_row"},g=["placeholder","disabled"],w=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),v=["placeholder"],f=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),m={class:"styled_input styled_links_box"},b={class:"styled_links_display"},x={key:0,class:"placeholder"},L={key:1,class:"styled_line_links"},C=["onClick"],$=l((()=>(0,i.Lk)("hr",{class:"styled_links_separator"},null,-1))),E={class:"magic_wrapper styled_links_add__sized"},X=["disabled"],U=["disabled"],T=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),D={class:"repetition_toggle"},F={class:"overlay_contents_text"},A=l((()=>(0,i.Lk)("div",{class:"flex-break"},null,-1))),Q={class:"repetition_box_wrapper",ref:"repetition_box"},R={class:"repetition_config"},V={class:"config_section"},W={class:"config_label"},M={class:"days_selector"},q=["onClick"],J={class:"config_section"},B={class:"config_label"},K={class:"duration_selector"},I=l((()=>(0,i.Lk)("span",{class:"duration_text"},"For",-1))),P=l((()=>(0,i.Lk)("span",{class:"duration_text"},"weeks",-1))),j=l((()=>(0,i.Lk)("span",{class:"duration_text"},"Until",-1))),O={key:0,class:"repetition_summary"},S={class:"classes_checkboxes checkboxes"},Y=["href"],G=["id","value"],H=["for"],N=["for"],z={class:"bottom_actions"},Z=l((()=>(0,i.Lk)("div",{class:"flex_spacer"},null,-1))),ee=["disabled"];function te(e,t,s,l,te,se){const ie=(0,i.g2)("ToggleBar");return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.Lk)("header",d,[(0,i.Lk)("h2",r,[(0,i.Lk)("span",null,"Add a"+(0,a.v_)(se.is_vowel(se.type_full[0])?"n":"")+"âŸ",1),(0,i.Lk)("div",{class:(0,a.C4)(["header_magic_wrapper magic_wrapper contents_inherit",{magic_ready:se.type_ready}])},[(0,i.bo)((0,i.Lk)("select",{title:"Task type","onUpdate:modelValue":t[0]||(t[0]=e=>te.task.type=e),class:"type_dropdown styled_input styled_select",ref:"type"},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.$magic.types,(e=>((0,i.uX)(),(0,i.CE)("option",{class:"type_dropdown__option styled_select__option",value:e.key,key:e.key},(0,a.v_)(e.name),9,p)))),128))],512),[[n.u1,te.task.type]]),(0,i.Lk)("div",{class:(0,a.C4)(["magic magic_in styled_magic alt_bg click-action",{magic_out:!se.type_ready,loading_bg:te.loading_type}]),disabled:!se.type_ready||te.loading_type,onClick:t[1]||(t[1]=(...e)=>se.magic_type&&se.magic_type(...e)),title:"Use magically inferred type"},null,10,h)],2)])]),(0,i.Lk)("div",c,[(0,i.Lk)("div",_,[se.is_note?((0,i.uX)(),(0,i.CE)("span",k,"Add a new "+(0,a.v_)(te.task.type)+" to",1)):((0,i.uX)(),(0,i.CE)("span",u,"Schedule a new "+(0,a.v_)(te.task.type)+" for",1)),(0,i.eW)(" your class"+(0,a.v_)(se.classes&&1==se.classes.length?"":"es"),1)]),(0,i.Lk)("div",y,[se.is_note?(0,i.Q3)("",!0):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,"onUpdate:modelValue":t[2]||(t[2]=e=>te.task.name=e),class:"styled_input",type:"text",placeholder:se.type_full+" Name",disabled:se.is_note,enterkeyhint:"next",onKeydown:t[3]||(t[3]=(0,n.jR)((t=>e.$refs.date.focus()),["enter"]))},null,40,g)),[[n.Jo,te.task.name]]),(0,i.bo)((0,i.Lk)("input",{type:"date",ref:"date",class:"styled_input input_task__date","onUpdate:modelValue":t[4]||(t[4]=e=>te.task.date=e),style:(0,a.Tr)({maxWidth:se.is_note?"100%":null}),enterkeyhint:"next",onKeydown:t[5]||(t[5]=(0,n.jR)((t=>e.$refs.description.focus()),["enter"]))},null,36),[[n.Jo,te.task.date]]),w,(0,i.bo)((0,i.Lk)("textarea",{ref:"description","onUpdate:modelValue":t[6]||(t[6]=e=>te.task.description=e),class:"styled_input styled_textarea task_description",type:"text",placeholder:se.type_full+(se.is_note?" Contents":" Description (Optional)")},"\n        ",8,v),[[n.Jo,te.task.description]]),f,(0,i.Lk)("div",m,[(0,i.Lk)("div",b,[te.task.links&&te.task.links.length?((0,i.uX)(),(0,i.CE)("div",L,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(te.task.links,(e=>((0,i.uX)(),(0,i.CE)("a",{class:"styled_line_links__link styled_line_links__remove",target:"_blank",key:e.path,onClick:t=>se.remove_link(e)},(0,a.v_)(e.text),9,C)))),128))])):((0,i.uX)(),(0,i.CE)("span",x,(0,a.v_)(se.type_full)+" Links (Optional)",1))]),$,(0,i.Lk)("div",{class:"styled_links_add",onKeydown:t[12]||(t[12]=(0,n.jR)((e=>{e.preventDefault(),se.add_newlink()}),["enter"])),enterkeyhint:"done"},[(0,i.bo)((0,i.Lk)("input",{class:"styled_links_add__path",type:"url","onUpdate:modelValue":t[7]||(t[7]=e=>te.newlink.path=e),onBlur:t[8]||(t[8]=(...e)=>se.fix_newlink_path&&se.fix_newlink_path(...e)),placeholder:"Link URL (https://example.com)",enterkeyhint:"done"},null,544),[[n.Jo,te.newlink.path]]),(0,i.Lk)("div",E,[(0,i.bo)((0,i.Lk)("input",{class:"styled_links_add__text",type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>te.newlink.text=e),placeholder:"Link Text (what students see)",enterkeyhint:"done"},null,512),[[n.Jo,te.newlink.text]]),(0,i.Lk)("div",{class:(0,a.C4)(["magic magic_in styled_magic alt_bg click-action",{magic_out:!se.path_ready,loading_bg:te.loading_text}]),disabled:!se.path_ready||te.loading_text,onClick:t[10]||(t[10]=(...e)=>se.magic_text&&se.magic_text(...e)),title:"Auto-generate link text"},null,10,X)]),(0,i.Lk)("button",{class:"styled_links_add__action",onClick:t[11]||(t[11]=(...e)=>se.add_newlink&&se.add_newlink(...e)),disabled:se.newlink_not_ready},"Add",8,U)],32)]),T,(0,i.Lk)("div",D,[(0,i.bF)(ie,{value:te.repetition.enabled,onUpdate:t[13]||(t[13]=e=>te.repetition.enabled=!te.repetition.enabled),loads:!1},null,8,["value"]),(0,i.eW)(" Â  "),(0,i.Lk)("span",F,[(0,i.eW)("Repetition is "),(0,i.Lk)("b",null,(0,a.v_)(te.repetition.enabled?"enabled":"disabled"),1),(0,i.eW)(" for this "+(0,a.v_)(te.task.type),1)])]),A,(0,i.Lk)("div",Q,[(0,i.Lk)("div",{class:"repetition_box_inner",style:(0,a.Tr)({height:te.repetition.enabled?"auto":"0px"})},[(0,i.Lk)("div",R,[(0,i.Lk)("div",V,[(0,i.Lk)("div",W,"What days of the week should this "+(0,a.v_)(te.task.type)+" repeat",1),(0,i.Lk)("div",M,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["M","T","W","T","F","S","S"],((e,t)=>(0,i.Lk)("div",{key:t,class:(0,a.C4)(["day_square",{selected:te.repetition.days.includes((t+1)%7)}]),onClick:e=>se.toggle_day((t+1)%7)},(0,a.v_)(e),11,q))),64))])]),(0,i.Lk)("div",J,[(0,i.Lk)("div",B,"How long should this "+(0,a.v_)(te.task.type)+" continue",1),(0,i.Lk)("div",K,[(0,i.Lk)("div",{class:(0,a.C4)(["duration_option",{selected:"weeks"==te.repetition.end.type}]),onClick:t[17]||(t[17]=e=>te.repetition.end.type="weeks")},[I,(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=e=>te.repetition.end.value=e),min:"1",max:"52",class:"duration_input",onClick:t[15]||(t[15]=(0,n.D$)((()=>{}),["stop"])),onFocus:t[16]||(t[16]=e=>te.repetition.end.type="weeks"),placeholder:"##"},null,544),[[n.Jo,te.repetition.end.value]]),P],2),(0,i.Lk)("div",{class:(0,a.C4)(["duration_option",{selected:"date"==te.repetition.end.type}]),onClick:t[21]||(t[21]=e=>te.repetition.end.type="date")},[j,(0,i.bo)((0,i.Lk)("input",{type:"date","onUpdate:modelValue":t[18]||(t[18]=e=>te.repetition.end.date=e),class:"duration_input date_input",onClick:t[19]||(t[19]=(0,n.D$)((()=>{}),["stop"])),onFocus:t[20]||(t[20]=e=>te.repetition.end.type="date")},null,544),[[n.Jo,te.repetition.end.date]])],2)])]),te.repetition.days.length&&te.task_classes.length?((0,i.uX)(),(0,i.CE)("div",O,[(0,i.Lk)("span",null,[(0,i.eW)("This action will create "),(0,i.Lk)("b",null,(0,a.v_)(se.estimated_count),1),(0,i.eW)(" new "+(0,a.v_)(te.task.type)+"s.",1)])])):(0,i.Q3)("",!0)])],4)],512)]),(0,i.Lk)("div",{class:(0,a.C4)(["overlay_contents_text after_repetition_box",{after_repetition_box_hidden:!te.repetition.enabled}])},"Choose which classes this "+(0,a.v_)(te.task.type)+" will be added to",3),(0,i.Lk)("div",S,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(se.classes,(s=>((0,i.uX)(),(0,i.CE)("a",{class:"checkbox",key:s.id,href:"/view/"+e.$store.path_to_ref(s.ref)},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox",id:s.id,value:s.id,"onUpdate:modelValue":t[22]||(t[22]=e=>te.task_classes=e)},null,8,G),[[n.lH,te.task_classes]]),s.id?((0,i.uX)(),(0,i.CE)("label",{key:0,class:"button_pointer_text class_name",for:s.id,style:(0,a.Tr)({"--color-class":s.color,"--color-class-alt":s.color+"2d"})},(0,a.v_)(e.$store.class_text(s)),13,H)):((0,i.uX)(),(0,i.CE)("label",{key:1,for:s.id,onClick:t[23]||(t[23]=(...t)=>e.$event.stopPropagation&&e.$event.stopPropagation(...t))},(0,a.v_)(s.name),9,N))],8,Y)))),128))])],512),(0,i.Lk)("div",z,[(0,i.Lk)("button",{class:"close_action click_escape",onClick:t[24]||(t[24]=t=>e.$emit("close"))},"Close"),Z,(0,i.Lk)("button",{class:(0,a.C4)(["continue_action click_ctrlenter",{loading_bg:te.loading}]),onClick:t[25]||(t[25]=(...e)=>se.try_submit&&se.try_submit(...e)),disabled:!se.ready},"Add "+(0,a.v_)(te.task.type),11,ee)])])}s(4114),s(4603),s(7566),s(8721);var se=s(4186),ie=s(6471),ae=s.n(ie),ne=s(4027),le={name:"CreateTaskView",emits:["close"],components:{ToggleBar:ne.A},mixins:[ae()],mounted(){this.$smoothReflow({el:this.$refs.contents,childTransitions:!0}),this.$smoothReflow({el:this.$refs.repetition_box,hideOverflow:!0,childTransitions:!0}),this.$route?.params?.tasktype?this.$refs.date.focus():this.$refs.type.focus(),this.$router.replace({...this.$route,query:{...this.$route.query,class:void 0,date:void 0}})},data(){return{task:{name:"",date:this.$route.query?.date?this.$route.query.date:"",description:"",type:this.$route.params.tasktype?this.$route.params.tasktype:"task"},task_classes:this.$route.query?.class?[this.$route.query.class]:[],newlink:{text:"",path:""},repetition:{enabled:!1,days:[],end:{type:"weeks",value:1}},loading:!1,loading_type:!1,loading_text:!1,loaded_type:!1,loaded_text:!1,auto_selected_day:null}},computed:{repetition_valid(){if(!this.repetition.enabled)return!0;if(!this.repetition.days.length)return!1;if("weeks"===this.repetition.end.type)return this.repetition.end.value&&this.repetition.end.value>0;if("date"===this.repetition.end.type){if(!this.repetition.end.date)return!1;const e=new Date(this.repetition.end.date),t=new Date;return t.setHours(0,0,0,0),e>t}return!1},repetition_error(){if(!this.repetition.enabled)return null;if(!this.repetition.days.length)return"Please select at least one day for the repetition";if("weeks"===this.repetition.end.type&&(!this.repetition.end.value||this.repetition.end.value<=0))return"Please enter a valid number of weeks (greater than 0)";if("date"===this.repetition.end.type){if(!this.repetition.end.date)return"Please select an end date for the repetition";const e=new Date(this.repetition.end.date),t=new Date;if(t.setHours(0,0,0,0),e<=t)return"End date must be in the future"}return null},ready(){const e=(this.task.name||this.is_note)&&this.task.date&&this.task_classes.length&&(!this.is_note||this.task.description);return e&&this.repetition_valid},type_full(){return this.$magic.type_full(this.task.type)},newlink_not_ready(){if(!this.newlink.path||!this.newlink.text)return!0;try{return new URL(this.newlink.path),!1}catch(e){return!0}},class_name(){if(!this.classes)return null;let e=this.classes.find((e=>e.id===this.class_id));return e?e.name:null},classes(){return this.$store.classes},is_note(){return"note"===this.task.type},type_ready(){return!this.loaded_type&&this.task&&(this.task.description||this.task.name).length>5},path_ready(){return!this.loaded_text&&this.newlink.path&&this.newlink_not_ready&&this.newlink.path.startsWith("https://")},estimated_count(){if(!this.repetition.enabled||!this.repetition.days.length)return 0;let e=0;if("weeks"==this.repetition.end.type)e=this.repetition.end.value*this.repetition.days.length;else if(this.repetition.end.date&&this.task.date){const t=new Date(this.task.date),s=new Date(this.repetition.end.date);if(s<=t)return 0;const i=s-t,a=Math.ceil(i/864e5),n=a/7;e=Math.ceil(n*this.repetition.days.length)}return Math.max(0,e*this.task_classes.length)}},methods:{try_submit(){this.ready?this.create_task():this.repetition_error?new se.MY(this.repetition_error,2e3):new se.MY("Please fill out all required fields",1e3)},is_vowel(e){return["a","e","i","o","u"].includes(e.toLowerCase())},toggle_day(e){this.repetition.days.includes(e)?this.repetition.days=this.repetition.days.filter((t=>t!==e)):(this.repetition.days.push(e),this.repetition.days.sort())},add_newlink(){this.task.links||(this.task.links=[]),this.newlink.path=new URL(this.newlink.path).href,this.task.links.push(this.newlink),this.newlink={text:"",path:""}},create_task(){if(!this.newlink_not_ready)return void new se.MY("Don't forget to to click the 'Add' button to add your link!",2e3);this.loading=!0;const e=this.repetition.enabled&&this.repetition.days.length?this.$store.create_repeating_task(this.task,this.task_classes,this.repetition):this.$store.create_task(this.task,this.task_classes);e.then((()=>{
//! router to new task view?
this.$emit("close")})).catch((e=>{this.loading=!1,this.$status.error(`ðŸ“ƒ Couldn't create ${this.task.type||"task"}:`,e),new se.Qp("Couldn't create task",e,2e3)}))},remove_link(e){this.task.links=this.task.links.filter((t=>t.path!==e.path)),this.newlink=e},update_auto_day(e){if(null!==this.auto_selected_day){const e=this.repetition.days.indexOf(this.auto_selected_day);-1!==e&&this.repetition.days.splice(e,1)}if(e){const[t,s,i]=e.split("-").map(Number),a=new Date(t,s-1,i),n=a.getDay();this.repetition.days.includes(n)||(this.repetition.days.push(n),this.repetition.days.sort()),this.auto_selected_day=n}else this.auto_selected_day=null},fix_newlink_path(){if(this.newlink.path&&this.newlink.path.includes("."))try{this.newlink.path=new URL(this.newlink.path).href}catch(e){this.newlink.path="https://"+this.newlink.path,this.fix_newlink_path()}},async magic_type(){if(!this.type_ready)return;this.loading_type=!0;const e={name:this.task.name,description:this.task.description,date:this.task.date,classes:this.task_classes.map((e=>this.classes.find((t=>t.id==e))?.name))};this.$magic.type(JSON.stringify(e)).then((e=>{e?(new se.rQ(`Generated task type '${e}'`,1500),this.$status.log("ðŸ”— Generated task type:",e),this.task.type=e):(new se.MY("Couldn't reasonably infer a task type",2e3),this.$status.warn("ðŸ“ƒ Couldn't generate task type")),this.loaded_type=!0,this.loading_type=!1})).catch((e=>{new se.Qp("Something went wrong generating the task type",e,3e3),this.$status.error("âš  Failed task type generation:",e),this.loaded_type=!1,this.loading_type=!1}))},async magic_text(){this.path_ready&&!this.newlink.text&&(this.loading_text=!0,this.$magic.text(this.newlink.path).then((e=>{e?(new se.rQ(`Generated link text '${e}'`,1500),this.$status.log("ðŸ”— Generated link text:",e),this.newlink.text=e):(new se.MY("Couldn't reasonably infer link text",2e3),this.$status.warn("ðŸ“ƒ Couldn't generate link text")),this.loaded_text=!0,this.loading_text=!1})).catch((e=>{new se.Qp("Couldn't generate link text",e,3e3),this.$status.error("âš  Failed link text generation:",e),this.loaded_text=!1,this.loading_text=!1})))}},watch:{"$route.params.tasktype"(e){this.task.type=e},"task.type"(e,t){this.$router.replace({...this.$route,params:{...this.$route.params,tasktype:e}}),"note"==e?(this.task.description=this.task.description||this.task.name,this.task.name=""):"note"==t&&this.task.description?.length<=35&&(this.task.name=this.task.description,this.task.description="")},"newlink.path"(e,t){e!=t&&(this.loaded_text=!1)},"newlink.text"(e,t){e!=t&&(this.loaded_text=!1)},"task.name"(e,t){e!==t&&(this.loaded_type=!1)},"task.description"(e,t){e!==t&&(this.loaded_type=!1)},"task.date":{handler(e,t){e!==t&&(this.loaded_type=!1),this.update_auto_day(e)},immediate:!0},task_classes:{deep:!0,handler(e,t){e!=t&&(this.loaded_type=!1)}}}},oe=s(1241);const de=(0,oe.A)(le,[["render",te],["__scopeId","data-v-5e7e5584"]]);var re=de}}]);