"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[250],{65:function(s,e,t){t.r(e),t.d(e,{default:function(){return re}});var a=t(6768),n=t(4232);const o=s=>((0,a.Qi)("data-v-431b0086"),s=s(),(0,a.jt)(),s),r={class:"canvas_import"},i={class:"modal_header"},c={class:"header_style modal_header_title"},l={key:0,class:"modal_progress"},u={class:"progress_text"},d={class:"progress_dots"},p={class:"overlay_contents",ref:"contents"},v={class:"bottom_actions"},h=o((()=>(0,a.Lk)("div",{class:"flex_spacer"},null,-1))),m=["disabled"];function g(s,e,t,o,g,_){return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("header",i,[(0,a.Lk)("h2",c,(0,n.v_)(_.currentPage.title),1),_.isImporting?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("span",u,(0,n.v_)(g.pageIndex+1)+" / "+(0,n.v_)(g.pages.length),1),(0,a.Lk)("div",d,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(g.pages,((s,e)=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:(0,n.C4)(["progress_dot",{active:e===g.pageIndex,completed:e<g.pageIndex}])},null,2)))),128))])]))]),(0,a.Lk)("div",p,[((0,a.uX)(),(0,a.Wv)((0,a.$y)(_.currentPage.component),{load:g.accumulatedData,onUpdate:_.handleUpdate,onStatus:_.handleStatus},null,40,["load","onUpdate","onStatus"]))],512),(0,a.Lk)("div",v,[_.canGoBack?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"back_action",onClick:e[0]||(e[0]=(...s)=>_.previousPage&&_.previousPage(...s))},"Back")):((0,a.uX)(),(0,a.CE)("button",{key:1,class:"close_action click_escape",onClick:e[1]||(e[1]=e=>s.$emit("close"))},"Cancel")),h,(0,a.Lk)("button",{class:(0,n.C4)(["continue_action click_ctrlenter",{loading_bg:_.isImporting}]),disabled:!g.canContinue,onClick:e[2]||(e[2]=(...s)=>_.nextPage&&_.nextPage(...s))},(0,n.v_)(_.currentPage.submitText),11,m)])])}var _=t(144),k=t(6471),C=t.n(k),y=t.p+"img/link.b7adc4fe.svg";const f={class:"canvas_intro survey_part"},x=(0,a.Fv)('<div class="canvas_intro__icon" data-v-55e957f4><img src="'+y+'" alt="Link icon" class="intro_icon_img" data-v-55e957f4></div><div class="overlay_contents_text" data-v-55e957f4><p data-v-55e957f4>Import your classes and assignments directly from <strong data-v-55e957f4>Canvas LMS</strong>.</p></div><div class="overlay_contents_text" data-v-55e957f4><p data-v-55e957f4>You&#39;ll need your Canvas <strong data-v-55e957f4>personal access token</strong> to connect.</p></div><div class="canvas_intro__note overlay_contents_text" data-v-55e957f4><p class="small_text" data-v-55e957f4>Your token will be securely stored so you won&#39;t need to enter it again.</p></div>',4),L=[x];function b(s,e,t,n,o,r){return(0,a.uX)(),(0,a.CE)("div",f,L)}var I={name:"CanvasIntro",emits:["update","status"],mounted(){this.$emit("status",!0),this.$emit("update",{})}},E=t(1241);const U=(0,E.A)(I,[["render",b],["__scopeId","data-v-55e957f4"]]);var w=U,T=t(5130);const $=s=>((0,a.Qi)("data-v-78562a86"),s=s(),(0,a.jt)(),s),X={class:"canvas_connect survey_part"},P={key:0,class:"existing_connection"},S=$((()=>(0,a.Lk)("div",{class:"overlay_contents_text"},[(0,a.Lk)("p",null,"You're already connected to Canvas as:")],-1))),A={class:"connection_info"},B={class:"canvas_user_name"},Q={class:"canvas_url"},D={class:"connection_actions"},F={key:1,class:"connection_form"},G=$((()=>(0,a.Lk)("div",{class:"overlay_contents_text"},[(0,a.Lk)("p",null,"Enter your Canvas instance URL and personal access token.")],-1))),j={class:"inputs_row"},V={class:"inputs_row"},R=$((()=>(0,a.Lk)("div",{class:"overlay_contents_text help_text"},[(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"How to get your token:")]),(0,a.Lk)("p",{class:"help_steps"},[(0,a.eW)(" Canvas → Account → Settings → Approved Integrations → "),(0,a.Lk)("span",{class:"highlight"},"+ New Access Token")])],-1))),J={key:0,class:"error_text"},W={key:1,class:"loading_indicator"},O=$((()=>(0,a.Lk)("img",{alt:"Loading",class:"loading_icon small_loading"},null,-1))),Y=$((()=>(0,a.Lk)("span",null,"Checking connection...",-1))),K=[O,Y];function H(s,e,t,o,r,i){return(0,a.uX)(),(0,a.CE)("div",X,[r.existingConnection&&!r.showForm?((0,a.uX)(),(0,a.CE)("div",P,[S,(0,a.Lk)("div",A,[(0,a.Lk)("div",B,(0,n.v_)(r.existingConnection.canvasUserName),1),(0,a.Lk)("div",Q,(0,n.v_)(r.existingConnection.canvasBaseUrl),1)]),(0,a.Lk)("div",D,[(0,a.Lk)("button",{class:"styled_button alt_action",onClick:e[0]||(e[0]=s=>r.showForm=!0)},"Update Connection"),(0,a.Lk)("button",{class:"styled_button primary_action",onClick:e[1]||(e[1]=(...s)=>i.useExisting&&i.useExisting(...s))},"Use Existing")])])):((0,a.uX)(),(0,a.CE)("div",F,[G,(0,a.Lk)("div",j,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.canvasUrl=s),ref:"urlInput",class:"styled_input",type:"url",placeholder:"Canvas URL (e.g., https://canvas.school.edu)",onInput:e[3]||(e[3]=(...s)=>i.validateUrl&&i.validateUrl(...s)),enterkeyhint:"next",onKeydown:e[4]||(e[4]=(0,T.jR)((e=>s.$refs.tokenInput?.focus()),["enter"]))},null,544),[[T.Jo,r.canvasUrl]])]),(0,a.Lk)("div",V,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>r.accessToken=s),ref:"tokenInput",class:"styled_input",type:"password",placeholder:"Personal Access Token",onInput:e[6]||(e[6]=(...s)=>i.validate&&i.validate(...s)),enterkeyhint:"done"},null,544),[[T.Jo,r.accessToken]])]),R,r.error?((0,a.uX)(),(0,a.CE)("div",J,(0,n.v_)(r.error),1)):(0,a.Q3)("",!0),r.loading?((0,a.uX)(),(0,a.CE)("div",W,K)):(0,a.Q3)("",!0)]))])}t(4603),t(7566),t(8721);var N=t(6669),q=t(9218),M={name:"CanvasConnect",emits:["update","status"],props:{load:{type:Object,default:()=>({})}},data(){return{canvasUrl:this.load?.canvasUrl||"",accessToken:this.load?.accessToken||"",existingConnection:null,showForm:!1,loading:!1,error:null,checkedExisting:!1}},async mounted(){await this.checkExistingConnection(),this.load?.canvasUrl&&(this.canvasUrl=this.load.canvasUrl),this.load?.accessToken&&(this.accessToken=this.load.accessToken),!this.existingConnection&&this.$refs.urlInput&&this.$refs.urlInput.focus(),this.validate()},computed:{isValid(){return this.canvasUrl&&this.accessToken&&this.isValidUrl},isValidUrl(){if(!this.canvasUrl)return!1;try{const s=new URL(this.canvasUrl);return"https:"===s.protocol||"http:"===s.protocol}catch{return!1}},getData(){return{canvasUrl:this.canvasUrl,accessToken:this.accessToken,useExisting:!this.showForm&&this.existingConnection&&!this.accessToken}}},methods:{async checkExistingConnection(){if(!this.checkedExisting){this.checkedExisting=!0;try{const s=(0,q.Qg)(N.Cn,"canvasCheckConnection"),e=await s({});e.data.success&&e.data.connected&&(this.existingConnection=e.data,this.canvasUrl=e.data.canvasBaseUrl,this.$emit("status",!0),this.$emit("update",{...this.getData,useExisting:!0}))}catch(s){console.warn("Could not check existing connection:",s)}}},validate(){const s=this.isValid||!this.showForm&&this.existingConnection;this.$emit("status",s),this.$emit("update",this.getData)},validateUrl(){this.error=null,this.canvasUrl&&!this.isValidUrl&&(this.error="Please enter a valid URL (e.g., https://canvas.school.edu)"),this.validate()},useExisting(){this.$emit("status",!0),this.$emit("update",{canvasUrl:this.existingConnection.canvasBaseUrl,useExisting:!0})}},watch:{accessToken(){this.validate()}}};const z=(0,E.A)(M,[["render",H],["__scopeId","data-v-78562a86"]]);var Z=z;const ss=s=>((0,a.Qi)("data-v-dc52673a"),s=s(),(0,a.jt)(),s),es={class:"canvas_select survey_part"},ts={key:0,class:"loading_container"},as=ss((()=>(0,a.Lk)("img",{alt:"Loading",class:"loading_icon"},null,-1))),ns=ss((()=>(0,a.Lk)("p",{class:"overlay_contents_text"},"Fetching your courses...",-1))),os=[as,ns],rs={key:1,class:"error_container"},is={class:"error_text"},cs={key:2,class:"empty_container"},ls=ss((()=>(0,a.Lk)("p",{class:"overlay_contents_text"},"No courses found in your Canvas account.",-1))),us=[ls],ds={key:3,class:"courses_list"},ps={class:"select_actions"},vs={class:"courses_checkboxes checkboxes"},hs=["value"],ms={class:"course_info"},gs={class:"course_name"},_s={class:"course_meta"},ks={class:"selection_summary overlay_contents_text"},Cs={key:0};function ys(s,e,t,o,r,i){return(0,a.uX)(),(0,a.CE)("div",es,[r.loading?((0,a.uX)(),(0,a.CE)("div",ts,os)):r.error?((0,a.uX)(),(0,a.CE)("div",rs,[(0,a.Lk)("p",is,(0,n.v_)(r.error),1),(0,a.Lk)("button",{class:"styled_button",onClick:e[0]||(e[0]=(...s)=>i.fetchCourses&&i.fetchCourses(...s))},"Retry")])):0===r.courses.length?((0,a.uX)(),(0,a.CE)("div",cs,us)):((0,a.uX)(),(0,a.CE)("div",ds,[(0,a.Lk)("div",ps,[(0,a.Lk)("button",{class:"small_button",onClick:e[1]||(e[1]=(...s)=>i.selectAll&&i.selectAll(...s))},"Select All"),(0,a.Lk)("button",{class:"small_button",onClick:e[2]||(e[2]=(...s)=>i.deselectAll&&i.deselectAll(...s))},"Deselect All")]),(0,a.Lk)("div",vs,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.courses,(s=>((0,a.uX)(),(0,a.CE)("label",{key:s.id,class:"checkbox course_item"},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[3]||(e[3]=s=>r.selectedCourses=s)},null,8,hs),[[T.lH,r.selectedCourses]]),(0,a.Lk)("span",ms,[(0,a.Lk)("span",gs,(0,n.v_)(s.name),1),(0,a.Lk)("span",_s,(0,n.v_)(s.assignmentCount)+" assignment"+(0,n.v_)(1!==s.assignmentCount?"s":"")+", "+(0,n.v_)(s.announcementCount)+" announcement"+(0,n.v_)(1!==s.announcementCount?"s":""),1)])])))),128))]),(0,a.Lk)("div",ks,[(0,a.Lk)("strong",null,(0,n.v_)(r.selectedCourses.length),1),(0,a.eW)(" course"+(0,n.v_)(1!==r.selectedCourses.length?"s":"")+" selected ",1),r.selectedCourses.length>0?((0,a.uX)(),(0,a.CE)("span",Cs,"("+(0,n.v_)(i.totalItems)+" items to import)",1)):(0,a.Q3)("",!0)])]))])}var fs={name:"CanvasSelectCourses",emits:["update","status"],props:{load:{type:Object,default:()=>({})}},data(){return{courses:[],selectedCourses:this.load?.selectedCourses||[],loading:!0,error:null}},async mounted(){await this.fetchCourses()},computed:{totalItems(){return this.courses.filter((s=>this.selectedCourses.includes(s.id))).reduce(((s,e)=>s+e.assignmentCount+e.announcementCount),0)},getData(){return{courses:this.courses,selectedCourses:this.selectedCourses,canvasUrl:this.load?.canvasUrl,accessToken:this.load?.accessToken,useExisting:this.load?.useExisting}}},methods:{async fetchCourses(){this.loading=!0,this.error=null;try{const s=(0,q.Qg)(N.Cn,"canvasGetCourses"),e=this.load?.useExisting?{accessToken:this.load?.accessToken||"USE_STORED",canvasBaseUrl:this.load?.canvasUrl,saveToken:!0}:{accessToken:this.load?.accessToken,canvasBaseUrl:this.load?.canvasUrl,saveToken:!0},t=await s(e);t.data.success?(this.courses=t.data.courses||[],this.selectedCourses=this.courses.map((s=>s.id))):this.error=t.data.error||"Failed to fetch courses"}catch(s){console.error("Failed to fetch courses:",s),this.error=s.message||"Failed to connect to Canvas"}finally{this.loading=!1,this.validate()}},selectAll(){this.selectedCourses=this.courses.map((s=>s.id))},deselectAll(){this.selectedCourses=[]},validate(){this.$emit("status",this.selectedCourses.length>0&&!this.loading),this.$emit("update",this.getData)}},watch:{selectedCourses:{handler(){this.validate()},deep:!0}}};const xs=(0,E.A)(fs,[["render",ys],["__scopeId","data-v-dc52673a"]]);var Ls=xs;const bs=s=>((0,a.Qi)("data-v-37c9678a"),s=s(),(0,a.jt)(),s),Is={class:"canvas_progress survey_part"},Es={class:"progress_visual"},Us={class:"progress_bar"},ws={class:"progress_text"},Ts={class:"progress_details overlay_contents_text"},$s={key:0,class:"current_course"},Xs={key:1,class:"step_text"},Ps={key:0,class:"error_container"},Ss={class:"error_text"},As={key:1,class:"warning_text"},Bs=bs((()=>(0,a.Lk)("p",null,"⚠️ Please don't close this window",-1))),Qs=[Bs];function Ds(s,e,t,o,r,i){return(0,a.uX)(),(0,a.CE)("div",Is,[(0,a.Lk)("div",Es,[(0,a.Lk)("div",Us,[(0,a.Lk)("div",{class:"progress_fill",style:(0,n.Tr)({width:i.progressPercent+"%"})},null,4)]),(0,a.Lk)("div",ws,(0,n.v_)(r.progress.completedCourses)+"/"+(0,n.v_)(r.progress.totalCourses)+" courses",1)]),(0,a.Lk)("div",Ts,[r.progress.currentCourse?((0,a.uX)(),(0,a.CE)("p",$s,[(0,a.eW)(" Importing: "),(0,a.Lk)("strong",null,(0,n.v_)(r.progress.currentCourse),1)])):(0,a.Q3)("",!0),r.progress.currentStep?((0,a.uX)(),(0,a.CE)("p",Xs,(0,n.v_)(r.progress.currentStep),1)):(0,a.Q3)("",!0)]),"failed"===r.progress.status?((0,a.uX)(),(0,a.CE)("div",Ps,[(0,a.Lk)("p",Ss,(0,n.v_)(r.progress.error||"Import failed"),1)])):((0,a.uX)(),(0,a.CE)("div",As,Qs))])}var Fs=t(9675),Gs=t(3933),js={name:"CanvasProgress",emits:["update","status"],props:{load:{type:Object,default:()=>({})}},data(){return{store:(0,Gs.s)(),progress:{status:"pending",totalCourses:this.load?.selectedCourses?.length||0,completedCourses:0,currentCourse:null,currentStep:"Starting import..."},importedClasses:[],unsubscribe:null,importStarted:!1}},computed:{progressPercent(){return this.progress.totalCourses?Math.round(this.progress.completedCourses/this.progress.totalCourses*100):0}},async mounted(){this.subscribeToProgress(),await this.startImport()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()},methods:{subscribeToProgress(){const s=this.store.user?.uid;if(!s)return;const e=(0,Fs.H9)(N.db,"canvas_imports",s);this.unsubscribe=(0,Fs.aQ)(e,(s=>{if(s.exists()){const e=s.data();this.progress={...this.progress,...e},"completed"===e.status?(this.$emit("status",!0),this.$emit("update",{importedClasses:this.importedClasses,progress:this.progress})):"failed"===e.status&&this.$emit("status",!0)}}),(s=>{console.warn("Progress subscription error:",s)}))},async startImport(){if(!this.importStarted){this.importStarted=!0;try{const s=(0,q.Qg)(N.Cn,"canvasImportCourses"),e={accessToken:this.load?.accessToken,canvasBaseUrl:this.load?.canvasUrl,courseIds:this.load?.selectedCourses||[],userId:this.store.user?.uid,useStoredToken:this.load?.useExisting||!1},t=await s(e);t.data.success?(this.importedClasses=t.data.classes||[],this.progress.status="completed",this.$emit("update",{importedClasses:this.importedClasses,progress:this.progress}),this.$emit("status",!0),await this.store.fetch_classes()):(this.progress.status="failed",this.progress.error=t.data.error,this.$emit("status",!0))}catch(s){console.error("Import failed:",s),this.progress.status="failed",this.progress.error=s.message||"Import failed",this.$emit("status",!0)}}}}};const Vs=(0,E.A)(js,[["render",Ds],["__scopeId","data-v-37c9678a"]]);var Rs=Vs;const Js=s=>((0,a.Qi)("data-v-1b82f170"),s=s(),(0,a.jt)(),s),Ws={class:"canvas_success survey_part"},Os=Js((()=>(0,a.Lk)("div",{class:"success_icon"},"✓",-1))),Ys={class:"overlay_contents_text success_message"},Ks={key:0,class:"imported_classes_list"},Hs=Js((()=>(0,a.Lk)("span",{class:"class_color_dot"},null,-1))),Ns={class:"class_details"},qs={class:"class_name"},Ms={class:"class_count"},zs=["onClick"],Zs=Js((()=>(0,a.Lk)("div",{class:"overlay_contents_text next_steps"},[(0,a.Lk)("p",null,"Your classes are now available in the sidebar!")],-1)));function se(s,e,t,o,r,i){return(0,a.uX)(),(0,a.CE)("div",Ws,[Os,(0,a.Lk)("div",Ys,[(0,a.Lk)("p",null,[(0,a.eW)(" Successfully imported "),(0,a.Lk)("strong",null,(0,n.v_)(i.importedClasses.length),1),(0,a.eW)(" class"+(0,n.v_)(1!==i.importedClasses.length?"es":"")+"! ",1)])]),i.importedClasses.length>0?((0,a.uX)(),(0,a.CE)("div",Ks,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.importedClasses,(s=>((0,a.uX)(),(0,a.CE)("div",{key:s.id,class:"imported_class_item",style:(0,n.Tr)({"--color-class":s.color})},[Hs,(0,a.Lk)("span",Ns,[(0,a.Lk)("span",qs,(0,n.v_)(s.name),1),(0,a.Lk)("span",Ms,(0,n.v_)(s.assignmentCount)+" items",1)]),(0,a.Lk)("a",{class:"view_link",onClick:(0,T.D$)((e=>i.viewClass(s)),["prevent"])}," View → ",8,zs)],4)))),128))])):(0,a.Q3)("",!0),Zs])}t(4114);var ee={name:"CanvasSuccess",emits:["update","status"],props:{load:{type:Object,default:()=>({})}},computed:{importedClasses(){return this.load?.importedClasses||[]}},mounted(){this.$emit("status",!0),this.$emit("update",{importedClasses:this.importedClasses})},methods:{viewClass(s){const e=s.id.split("/"),t=e[0].split("@")[0],a=e[1],n=`${t}~${a}`;this.$router.push({name:"viewclass",params:{ref:n},query:this.$route.query})}}};const te=(0,E.A)(ee,[["render",se],["__scopeId","data-v-1b82f170"]]);var ae=te,ne={name:"CanvasImportView",emits:["close"],mixins:[C()],components:{CanvasIntro:w,CanvasConnect:Z,CanvasSelectCourses:Ls,CanvasProgress:Rs,CanvasSuccess:ae},data(){return{pageIndex:0,canContinue:!1,currentData:{},accumulatedData:{},pages:[{title:"Import from Canvas",component:(0,_.IJ)(w),submitText:"Get Started",canGoBack:!1},{title:"Connect to Canvas",component:(0,_.IJ)(Z),submitText:"Connect",canGoBack:!0},{title:"Select Courses",component:(0,_.IJ)(Ls),submitText:"Import Selected",canGoBack:!0},{title:"Importing...",component:(0,_.IJ)(Rs),submitText:"Continue",canGoBack:!1,isProgress:!0},{title:"Import Complete!",component:(0,_.IJ)(ae),submitText:"Done",canGoBack:!1,isFinal:!0}]}},computed:{currentPage(){return this.pages[this.pageIndex]},canGoBack(){return this.currentPage.canGoBack&&this.pageIndex>0},isImporting(){return this.currentPage.isProgress}},mounted(){this.$smoothReflow({el:this.$refs.contents,childTransitions:!0})},methods:{handleUpdate(s){this.currentData=s,this.accumulatedData={...this.accumulatedData,...s}},handleStatus(s){this.canContinue=s},nextPage(){if(this.canContinue){if(this.currentPage.isFinal)return window.onbeforeunload=null,void this.$emit("close");0===this.pageIndex&&(window.onbeforeunload=()=>"You have an import in progress. Are you sure you want to leave?"),this.pageIndex++,this.canContinue=!1}},previousPage(){this.canGoBack&&this.pageIndex--}}};const oe=(0,E.A)(ne,[["render",g],["__scopeId","data-v-431b0086"]]);var re=oe}}]);