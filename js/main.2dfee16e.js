(function(){var e={6301:function(e,t,o){"use strict";var i,r;o.d(t,{Cw:function(){return h},Fi:function(){return _},kX:function(){return m},nv:function(){return p}}),function(e){e["Log"]="log",e["Info"]="info",e["Debug"]="debug",e["Warn"]="warn",e["Error"]="error"}(r||(r={}));let s=r.Info,n=[],a=new Date;function l(e,t="log.txt"){let o=window.document.createElement("a");o.href=window.URL.createObjectURL(new Blob([e],{type:"text/plain"})),o.download=t,o.click()}function c(e){return e.length?e.map((e=>`${e.time} [${e.type}]: ${JSON.stringify(e.message)}`)).join("\n\n"):`No log entries found; last cleared ${a.toISOString()}`}function d(e){try{const t=e.match(/^([\P{L}\p{Extended_Pictographic}]|(?:[\uD800-\uDBFF][\uDC00-\uDFFF]))/u);return t?t[0]:null}catch(t){return null}}function u(...e){if(n.push({time:Date.now(),message:arguments[0],type:this||r.Log}),0==arguments.length)return;let t=["%cMVTT","background:#272727;color:#C9B092;padding:7px 12px;font-family:Lato,sans-serif;font-weight:bold;font-size:1.3em"];null!=d(e[0])&&(t[0]+=" %c"+d(e[0]),t[2]="background:#C9B092aa;background:#ffffffaa;color:#272727;padding:3px 5px;margin-left:5px;border-radius:5px;font-family:monospace !important;font-weight:bold;font-size:1.25em",e[0]=e[0].substring(2).trimStart());try{console[this](...t,...e)}catch(o){console.log("⚠ Couldn't override console.log",o),console.log(...t,...e)}}const h={print:u.bind(s),log:u.bind(r.Log),info:u.bind(r.Info),debug:u.bind(r.Debug),warn:u.bind(r.Warn),error:u.bind(r.Error),clearStream:()=>{n=[],console.clear(),a=new Date},getStream:(e=[])=>e&&e.length>0?n.filter((t=>e.includes(t.type))):n,textStream(e=[]){return c(h.getStream(e))},saveStream:(e="manual")=>{let t=new Date,o=h.getStream();t.setSeconds(0,0),_(o,t,e)},_getTone:()=>s,_setTone:e=>{s=e},_resetTone:()=>{s=r.Info}};function _(e,t,o="manual"){try{l(c(e),`MVTT-log ${o} ${t.toISOString().split(":00.0")[0].replace("T"," ").replace(":","h")}m.log`),h.log("📜 Saved log stream to disk; run `_status.clearStream()` to purge if local")}catch(i){h.error("📜 Couldn't save log stream",i)}}u.bind(r.Info);try{const e=(null===(i=document.getElementById("version"))||void 0===i?void 0:i.textContent)||"< not found >";h.debug(`🚀 Loaded into production build @ version [${e}]`),h.log("📜 Initialized logger"),window._status=h}catch(f){h.log("⚠ Couldn't set window._status",f)}function m(e){return"string"!=typeof e?e:new Date(e.replace(/-/g,"/"))}function p(e){const t=Math.floor(e/1e3%60),o=Math.floor(e/6e4%60),i=Math.floor(e/36e5%24);return(i>0?i+":"+(o<10?"0":""):"")+`${o}:${t<10?"0":""}${t}`}},6669:function(e,t,o){"use strict";o.d(t,{Cn:function(){return p},Qg:function(){return a.Qg},RJ:function(){return C},db:function(){return m},j2:function(){return _},l4:function(){return y}});var i=o(6400),r=o(7845),s=o(7617),n=o(5942),a=o(9218),l=o(3933),c=o(6301),d=o(6765);const u={apiKey:"AIzaSyDGqqhApln4pxm4EynPCSkfwyK8aopjfCk",authDomain:"auth.mvtt.app",projectId:"mvtrack",storageBucket:"mvtrack.appspot.com",messagingSenderId:"1070634963357",appId:"1:1070634963357:web:2a4abc725fff24a5199f74",measurementId:"G-6LNX1KCR8E"},h=(0,i.Wp)(u),_=(0,r.xI)(h),m=(0,s.aU)(h),p=((0,n.P5)(h),(0,a.Uz)(h,{VUE_APP_MUSTACHE_CLASS_TEXT:"{{#period}}P{{period}} - {{/period}}{{name}}",VUE_APP_BRAND_DOMAIN__VIEWCLASS:"view.mvtt.app",VUE_APP_THEME_ACCENT_COLOR_ALT:"4c4c4c",VUE_APP_BRAND_DOMAIN__ADDCLASS:"add.mvtt.app",VUE_APP_BRAND_DOMAIN__VIEWTASK:"view.mvtt.app",VUE_APP_ORG_NAME:"MVLA",VUE_APP_BRAND_NAME_SHORT:"MVTT",VUE_APP_ORG_LINKS:'[["Docs", "https://mvtt.app/docs"], ["Cal", "https://mvhs.mvla.net/Calendar/"]]',VUE_APP_THEME_COLOR:"f5c14b",VUE_APP_BRAND_MAIL_ADDRESS:"mail@mvtt.app",VUE_APP_BRAND_DOMAIN:"mvtt.app",VUE_APP_BRAND_HOMEPAGE:"http://mvtt.app",VUE_APP_ORG_GRADES:'[[9, "Freshman"], [10, "Sophomore"], [11, "Junior"], [12, "Senior"]]',VUE_APP_THEME_CONSOLE_COLOR_TEXT:"C9B092",VUE_APP_SIDEBAR_DOWNLOAD_URL:"/download/mvtt-sidebar.zip",VUE_APP_BRAND_URL:"https://mvtt.app",VUE_APP_BRAND_DOMAIN__API:"api.mvtt.app",VUE_APP_THEME_CONSOLE_COLOR_BG:"272727",VUE_APP_ORG_TEACHER_GRADE:"Teacher / Educator",VUE_APP_BRAND_NAME_LONG:"MV Task Tracker",VUE_APP_ORG_DOMAIN:"mvla.net",VUE_APP_BRAND_ALLOWED_HOSTS:"mvla.net,*.mvla.net",VUE_APP_THEME_ACCENT_COLOR:"000000",NODE_ENV:"production",BASE_URL:"/"}.FIREBASE_region));_.onAuthStateChanged((e=>{y(e)}));let f,v,g=!1;function y(e){const t=(0,l.s)();if(e){if(t.set_user(e),k(),!t.user)return;w(e.uid),v=A()}else t.clear()}function w(e){if(c.Cw.log("⬥ Setting up snapshot"),!e)return void c.Cw.warn("⚠ No uid provided to setupSnapshot");const t=(0,l.s)();t.hide_timeout(),f=(0,s.aQ)((0,s.H9)(m,"users",e),{includeMetadataChanges:!0},(e=>{var o;if(e.metadata.hasPendingWrites)return void c.Cw.log("⬥ Snapshot from local changes");if(c.Cw.log("⏷ Snapshot from remote"),!e.exists())return void t.create_doc();let i=e.data();(null===(o=null===t||void 0===t?void 0:t.user)||void 0===o?void 0:o.uid)==e.id?t.account_doc=i:t.linked_account_doc=i}),(e=>{"permission-denied"==e.code?c.Cw.warn("⚠ Permission denied for snapshot, likely from logging out"):c.Cw.error("⚠ Couldn't get snapshot from remote",e)})),g=!0}function k(e=!1){clearTimeout(v);let t=(0,l.s)();e&&t.show_timeout(),f&&(f(),c.Cw.log("⬥ Unsubscribed from remote changes")),g=!1}function b(e){const t=Math.floor(e/1e3/60),o=Math.floor(e/1e3%60);return(t||!o?`${t} minute${1!=t?"s":""}`:"")+(o?`${o} second${1!=o?"s":""}`:"")}function A(e=3e5){return window.setTimeout((()=>{c.Cw.log(`⬥ Page unused for ${b(e)}, removing onSnapshot listener`),k(!0)}),e)}function C(e){var t;const o=(0,l.s)();o.hide_timeout(),g||(w(o.personal_account?null===(t=o.account_doc)||void 0===t?void 0:t.linked_to:o.user.uid),d.A.currentRoute.value&&d.A.currentRoute.value.path.startsWith("/portal")&&(c.Cw.log("⬥ Refreshing class data"),o.fetch_classes()),c.Cw.log("⬥ Resubscribed to remote changes")),clearTimeout(v),v=A(e)}},8283:function(e,t,o){"use strict";var i=o(5130),r=o(6768),s=o(5234),n=o(4232);const a=e=>((0,r.Qi)("data-v-72179f70"),e=e(),(0,r.jt)(),e),l=["_theme"],c={class:"pause_modal router_center_view",ref:"pause_modal"},d=a((()=>(0,r.Lk)("header",{class:"modal_header"},[(0,r.Lk)("h2",{class:"header_style modal_header_title"},"Session paused")],-1))),u={ref:"pause_contents",class:"overlay_contents"},h=a((()=>(0,r.Lk)("div",{class:"overlay_contents_text"}," Your session was inactive for an extended period of time and has been paused to conserve resources. ",-1))),_=a((()=>(0,r.Lk)("br",null,null,-1))),m=a((()=>(0,r.Lk)("div",{class:"overlay_contents_text"}," You can hide this message using the toggle in your account preferences. ",-1))),p=a((()=>(0,r.Lk)("br",null,null,-1))),f={class:"overlay_contents_text"};function v(e,t,o,i,s,a){const v=(0,r.g2)("OverlayWrapper"),g=(0,r.g2)("LogoutModal"),y=(0,r.g2)("ShortcutsModal"),w=(0,r.g2)("TutorialBlurb"),k=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("main",{id:"themed_body",class:(0,n.C4)(["parent",{simplified:e.$store.simplified}]),ref:"app",_theme:a.theme,onClick:t[5]||(t[5]=(...e)=>a.refreshTimeout&&a.refreshTimeout(...e)),onKeydown:t[6]||(t[6]=(...e)=>a.refreshTimeout&&a.refreshTimeout(...e)),onFocus:t[7]||(t[7]=(...e)=>a.refreshTimeout&&a.refreshTimeout(...e))},[a.do_timeout&&(e.$store.paused||s.animating)?((0,r.uX)(),(0,r.Wv)(v,{key:0,ref:"overlay",class:"pause_modal_overlay",style:{"z-index":"104"}},{default:(0,r.k6)((()=>[(0,r.Lk)("main",c,[d,(0,r.Lk)("div",u,[h,_,m,p,(0,r.Lk)("div",f," Please click anywhere to resume using "+(0,n.v_)(e.$env.VUE_APP_BRAND_NAME_SHORT)+". ",1)],512)],512)])),_:1},512)):(0,r.Q3)("",!0),e.$store.logout_prompt?((0,r.uX)(),(0,r.Wv)(v,{key:1,ref:"logout_modal",onClose:t[0]||(t[0]=t=>e.$store.logout_prompt=!1),style:{"z-index":"103"}},{default:(0,r.k6)((e=>[(0,r.bF)(g,{class:"router_center_view",onClose:e.close},null,8,["onClose"])])),_:1},512)):(0,r.Q3)("",!0),s.show_shortcuts||s.animating_shortcuts?((0,r.uX)(),(0,r.Wv)(v,{key:2,ref:"shortcuts_overlay",onClose:t[1]||(t[1]=e=>s.show_shortcuts=!1),style:{"z-index":"102"}},{default:(0,r.k6)((e=>[(0,r.bF)(y,{class:"router_center_view",ref:"shortcuts_modal",onClose:e.close},null,8,["onClose"])])),_:1},512)):(0,r.Q3)("",!0),a.show_tutorial&&e.$route.fullPath.startsWith("/portal")?((0,r.uX)(),(0,r.Wv)(w,{title:a.tutorial.title,key:"tutorial",options:a.tutorial.options,html:a.tutorial.html||"<i style=text-align:center;width:100%;display:block>Not much to see here!</i>",button_text:a.tutorial.next_text,skip_text:a.tutorial.prev_text,trackel:a.tutorial.el,onNext:t[2]||(t[2]=e=>a.tutorial_nav(1)),onSkip:t[3]||(t[3]=e=>a.tutorial_nav(-1)),onVnodeUnmounted:t[4]||(t[4]=e=>s.tutorial_page=0),style:{"z-index":"101"}},null,8,["title","options","html","button_text","skip_text","trackel"])):(0,r.Q3)("",!0),(0,r.bF)(k)],42,l)}o(4603),o(7566),o(8721);var g=o(4411);function y(e,t,o,i,s,n){const a=(0,r.g2)("Modal");return(0,r.uX)(),(0,r.Wv)(a,{class:"logout_modal",can_continue:!0,title:"Log Out",html:s.html,continue_action:n.logout,skippable:!0,onSkip:t[0]||(t[0]=t=>e.$emit("close")),skip_text:"Cancel",submit_text:"Confirm"},null,8,["html","continue_action"])}var w=o(4618),k={name:"LogoutModal",emits:["close"],components:{Modal:w.A},data(){return{html:'<div class="overlay_contents_text">Are you sure you want to log out?<br><br>You may lose access to what you were working on, and unsaved changes may be discarded.</div>'}},methods:{logout(){this.$store.logout(),this.$emit("close")}},mounted(){setTimeout((()=>{this.$emit("close")}),1e4)}},b=o(1241);const A=(0,b.A)(k,[["render",y]]);var C=A;const P={class:"overlay_contents shortcuts_contents"},E={key:0},T={key:1,class:"shortcuts_sections"},O={class:"shortcuts_section__title"},x={class:"shortcuts_table"},S={class:"shortcut__key"},N={class:"shortcut__description"},L={key:0,class:"shortcuts_section__filler"};function R(e,t,o,i,s,a){return(0,r.uX)(),(0,r.CE)("div",{class:(0,n.C4)(["shortcuts_modal",{empty:!a.sections.length}]),ref:"shortcuts_modal"},[(0,r.Lk)("div",P,[a.sections&&a.sections.length?((0,r.uX)(),(0,r.CE)("div",T,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.sections,(e=>((0,r.uX)(),(0,r.CE)("div",{class:"shortcuts_section",key:e.tag},[(0,r.Lk)("p",O,(0,n.v_)(e.tag||"Other"),1),(0,r.Lk)("table",x,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.list,(e=>((0,r.uX)(),(0,r.CE)("tr",{class:"shortcuts_table_shortcut",key:e.name,tabindex:"1"},[(0,r.Lk)("td",S,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.keys,(e=>((0,r.uX)(),(0,r.CE)("span",{class:"button_pointer_text",key:e},(0,n.v_)(e),1)))),128))]),(0,r.Lk)("td",N,(0,n.v_)(e.description),1)])))),128))])])))),128)),a.sections.length&&a.sections.length%2?((0,r.uX)(),(0,r.CE)("div",L)):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",E,"No Registered Shortcuts"))]),(0,r.Lk)("div",{class:"click_escape nopad",onClick:t[0]||(t[0]=t=>e.$emit("close"))})],2)}var $={name:"ShortcutsModal",computed:{sections(){return this.$shortcuts.sections}},mounted(){this.$refs.shortcuts_modal.focus()},beforeUnmount(){}};const M=(0,b.A)($,[["render",R],["__scopeId","data-v-1ab3b320"]]);var D=M,j=o(6587),V=o.n(j),I=o(4186),U=JSON.parse('[{"el":".portal_info","title":"Let\'s get started!","html":"At the top of the portal, you\'ll find some common info, like the date, who you\'re signed in as, and what type of account you have. <br><br> You can click \'Next,\' or use space / enter / the arrow keys to continue.","options":{"reclick":".calendar, .study .action_icon.cal-icon, #portal_mobile__block","pagename":"portal"}},{"el":".calendar","title":"The Calendar","html":"The calendar shows you all of your upcoming tasks, which you can click to expand. <br><br> If you\'re a teacher, your calendar will include extra features, and will allow you to drag and drop classes to create new tasks.","options":{"radius":"25px","pagename":"portal"}},{"el":".calendar_header","title":"Calendar Controls","html":"The bar at the top of the calendar allows you to change the view, and navigate to different dates. <br><br> Let\'s take a look what it can do!","options":{"radius":"15px","pagename":"portal"}},{"el":".calendar .portal_main_block_actions","title":"Calendar Pages","html":"These buttons allow you to navigate between pages of the calendar. You\'ll be able to click the center one to return to today\'s date.","options":{"radius":"15px","pagename":"portal"}},{"el":".calendar .portal_main_block_action_alt","title":"Portal Pages","html":"This button lets you switch between the calendar and the task list. <br><br> You might see a yellow-hued dot here, indicating that you have unfinished tasks coming up soon!","options":{"radius":"15px","click_on_complete":true}},{"disable_prev":true,"el":".study","title":"Study Page","html":"On the study page, you can see a list of your upcoming tasks, mark them as complete, and add new tasks. <br><br> If you\'re a teacher, this page won\'t be as useful to you.","options":{"radius":"25px"}},{"el":".study_header","title":"Study Controls","html":"The bar at the top of the study page allows you to customize your study session. <br><br> Let\'s take a look what it can do!","options":{"radius":"15px","pagename":"study"}},{"el":".study .portal_main_block_actions","title":"Study Timeframes","html":"These buttons allow you to change the timeframe of the study page. By default, it\'ll be set to the \'Week\' view, but you can also select \'Day,\' \'Month,\' or \'All.\' <br><br> Hint: hover over the buttons to see their keyboard shortcuts!","options":{"radius":"15px","click_on_complete":".portal_main_block_actions_wrapper > nav > button:last-child","pagename":"study"}},{"el":".study .portal_main_block_action_alt","title":"Portal Pages","html":"This button lets you switch between the calendar and the task list. <br><br> You might see a yellow-hued dot here, indicating that you have unfinished tasks coming up soon!","options":{"radius":"15px","click_on_complete":".study .portal_main_block_action_alt, .right-bar","pagename":"study"}},{"disable_prev":true,"el":".right-bar","title":"Right Sidebar","html":"The right sidebar shows you some quick info about your upcoming tasks, as well as access to more materials and account switching. <br><br> On smaller screens, you can open the sidebar by hovering at the side of the display and clicking the protruding section, or on mobile tapping the arrows in the bottom nav bar.","options":{"radius":"25px 0 0 25px","padding":0,"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .auth-action.can-logout","title":"Logout Button","html":"Click here to logout of your account. <br><br> If you\'re having issues with your portal, logging in and out can sometimes help.","options":{"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .upcoming_tasks","title":"Upcoming Tasks","html":"This section shows you your upcoming tasks, which you can click to expand. <br><br> It\'ll only show up to 6 tasks, sorted by soonest due date.","options":{"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .settings_button","title":"Account Preferences","html":"You can click here to change your account preferences, like toggling teacher mode, adding linked accounts, disabling the session timeout, switching themes, and viewing your survey statistics! <br><br> Next, let\'s take a look at the other sidebar","options":{"reclick":".right-bar, #portal_mobile__right","click_on_complete":".left-bar, #portal_mobile__left","radius":"17px","padding":5,"pagename":"portal"}},{"disable_prev":true,"el":".left-bar","title":"Left Sidebar","html":"The left sidebar gives you access to your tasks, classes, and other materials. <br><br> If you\'re a teacher, you\'ll find your controls to create classes and tasks here.","options":{"radius":"0 25px 25px 0","padding":0,"pagename":"portal","reclick":".left-bar, #portal_mobile__left"}},{"el":".left-bar .branding-title","title":"Well, we *are* MVTT","html":"Clicking the MVTT logo will take you back to the portal home page","options":{"reclick":".left-bar, #portal_mobile__left","pagename":"portal"}},{"el":".left-bar .class_list","title":"Class List","html":"Once you\'ve joined some classes, you\'ll see them listed here. <br><br> Clicking on a class will filter your calendar and study pages to only show tasks from filtered (clicked) classes.","options":{"reclick":".left-bar, #portal_mobile__left","pagename":"portal"}},{"el":".left-bar .class_list .classes_container_class__add_class","title":"Adding Classes","html":"Click here to add a class to your account. <br><br> You can join with a class code provided by your teacher, or by entering their email and selecting from a dropdown of all their classes.","options":{"reclick":".left-bar, #portal_mobile__left","padding":5,"radius":"10px","pagename":"portal"}},{"el":".left-bar .theme_button","title":"Theme Toggle","html":"It doesn\'t all have to be work! <br><br> Click here to switch between the light and dark modes. This\'ll sync across your devices!","options":{"reclick":".left-bar, #portal_mobile__left","radius":"17px","padding":5,"pagename":"portal","click_on_complete":"#portal_mobile__block"}},{"el":null,"title":"That\'s all for now!","html":"Thanks for taking the tour! <br><br> If you have any questions, feel free to reach out to us by visiting the contact page (try using the title in the left sidebar to get to it from the homepage)! <br><br> In the meantime though, let\'s get you some more resources, then add your first class!","options":{"next_text":"Finish","reclick":"null-filler","click_on_complete":".left-bar .class_list .classes_container_class__add_class"}},{"el":null,"title":"That\'s all for now!","html":"Thanks for taking the tour! <br><br> If you have any questions, feel free to reach out to us by visiting the contact page (try using the title in the left sidebar to get to it from the homepage)! <br><br> In the meantime though, let\'s get you some more resources, then add your first class!","options":{"next_text":"Finish","end":true,"pagename":"tutorial","reclick":"null-filler"}}]');const q={class:"tutorialblurb modaltype",ref:"blurb"},B={key:0,class:"modal_header",ref:"title"},H={class:"header_style modal_header_title"},G={key:1,ref:"contents",class:"overlay_contents"},Q=["innerHTML"],X={class:"bottom_actions"},W=(0,r.Lk)("div",{class:"flex_spacer"},null,-1);function F(e,t,o,i,s,a){return!o.trackel||s.track?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["tutorialblurb_group",{tutorial_end:a.is_end}])},[(0,r.Lk)("div",{class:"tutorialblurb__overlay",style:(0,n.Tr)({top:s.track.top+"px",left:s.track.left+"px",height:s.track.height+"px",width:s.track.width+"px",borderRadius:o.options&&o.options.radius||"5px"})},null,4),(0,r.Lk)("div",{class:"tutorialblurb_wrapper",ref:"dialog",style:(0,n.Tr)({top:s.track.fake_y+"px",left:s.track.fake_x+"px"})},[s.track.blurb?((0,r.uX)(),(0,r.CE)("span",{key:0,class:"tutorialblurb__blurb nopad",style:(0,n.Tr)({left:s.track.blurb_x+"px"})},null,4)):(0,r.Q3)("",!0),(0,r.Lk)("div",q,[o.title?((0,r.uX)(),(0,r.CE)("header",B,[(0,r.Lk)("h2",H,(0,n.v_)(o.title),1)],512)):(0,r.Q3)("",!0),o.content||o.html?((0,r.uX)(),(0,r.CE)("div",G,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(o.content),{ref:"container",onSkip:t[0]||(t[0]=t=>e.$emit("skip"))},null,544)),o.html?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"overlay_contents__html",innerHTML:o.html},null,8,Q)):(0,r.Q3)("",!0)],512)):(0,r.Q3)("",!0),(0,r.Lk)("div",X,[o.skippable?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"close_action click_escape",onClick:t[1]||(t[1]=t=>e.$emit("skip"))},(0,n.v_)(o.skip_text),1)):(0,r.Q3)("",!0),W,(0,r.Lk)("button",{class:"continue_action click_ctrlenter",onClick:t[2]||(t[2]=t=>e.$emit("next"))},(0,n.v_)(o.button_text),1)])],512)],4)],2)):(0,r.Q3)("",!0)}o(4114);var Y=o(6471),K=o.n(Y),z={name:"TutorialBlurb",emits:["next","skip"],props:{title:{type:String,required:!0},content:{type:Object},html:{type:String},button_text:{type:String,required:!1,default:"Next"},trackel:{required:!0},skippable:{type:Boolean,required:!1,default:!0},skip_text:{type:String,required:!1,default:"Skip"},options:{type:Object,required:!1}},data(){return{track:null,done_welcome:!1,shortcuts:[{key:"Enter, Space, ArrowRight",description:"Next Page"},{key:"ArrowLeft",description:"Back"}]}},mixins:[K()],mounted(){this.$smoothReflow({el:this.$refs.contents,hideOverflow:!0,childTransitions:!0}),this.$smoothReflow({el:this.$refs.title,hideOverflow:!0,childTransitions:!0}),window.addEventListener("keydown",this.next_key),this.$shortcuts.register_all(this.shortcuts,"Tutorial"),window.addEventListener("resize",this.track_flush),window.addEventListener("scroll",this.track_flush),window.setInterval(this.track_flush,100),this.track_flush()},beforeUnmount(){window.removeEventListener("keydown",this.next_key),this.$shortcuts.remove_tag("Tutorial"),window.removeEventListener("resize",this.track_flush),window.removeEventListener("scroll",this.track_flush),window.clearInterval(this.track_flush)},computed:{is_end(){return this.options?.end}},methods:{track_fn(){const e=void 0===this.options?.padding?10:this.options.padding;if(this.trackel){const t=V()(this.trackel);if(t.length){const o={w:window.innerWidth,h:window.innerHeight,pad:10},i={w:350,h:(this.$refs?.dialog?.offsetHeight||200)+7,offset:o.w<=600?172:20,rail_pad:20},r=t.offset(),s=t.outerWidth(),n=t.outerHeight();let a={blurb:!0,top:r.top-e,left:r.left-e,width:s+2*e,height:n+2*e,x:r.left+s/2-i.offset,y:r.top+n+e+7,exists:!0};return a.fake_x=Math.max(o.pad,Math.min(o.w-i.w-o.pad,a.x)),a.fake_y=Math.max(o.pad,Math.min(o.h-i.h-o.pad,a.y)),a.fake_x+i.w>a.left&&a.fake_x<a.left+a.width&&a.fake_y+i.h>a.top&&a.fake_y<a.top+a.height?(a.blurb=!1,a.blurb_x=i.offset,a.fake_y=window.innerHeight/2-(this.$refs?.dialog?.offsetHeight||200)/2,a.fake_x=window.innerWidth/2-175):(a.blurb_x=a.x-a.fake_x+i.offset,a.blurb_x=Math.max(i.rail_pad,Math.min(i.w-i.rail_pad,a.blurb_x))),this.done_welcome||(new I.rQ(`Welcome to ${this.$env.VUE_APP_BRAND_NAME_SHORT}, let's get you comfortable!`,3500),this.done_welcome=!0),a}}else if(null==this.trackel)return{exists:!1,blurb:!1,fake_y:window.innerHeight/2-(this.$refs?.dialog?.offsetHeight||200)/2,fake_x:window.innerWidth/2-175,top:window.innerHeight/2,left:window.innerWidth/2,width:0,height:0};return this.track},next_key(e){e.preventDefault(),this.track&&("Enter"===e.key||" "===e.key||"ArrowRight"===e.key?this.$emit("next"):"ArrowLeft"===e.key&&this.$emit("skip")),e.stopPropagation()},track_flush(){this.$store.done_tutorial||(this.track=this.track_fn(),this.options?.reclick&&V()(this.options.reclick).click(),this.options?.pagename&&this.$route.name!=this.options.pagename&&this.$route.path.startsWith("/portal")&&this.$router.push({name:this.options.pagename}))}},watch:{trackel(){this.track_flush()},$route(){this.track_flush()},options(){this.options?.end&&setTimeout((()=>{this.$emit("next")}),250)}}};const J=(0,b.A)(z,[["render",F]]);var Z=J,ee={name:"App",components:{OverlayWrapper:g.A,LogoutModal:C,TutorialBlurb:Z,ShortcutsModal:D},data(){return{platform:"",isElectron:!1,animating:!1,animating_shortcuts:!1,tutorial_page:0,show_shortcuts:!1,shortcuts:[{key:"Ctrl + Enter",description:"Submit current form",top:!0},{key:"Escape",description:"Close current modal",top:!0},{key:"Ctrl + \\",description:"Switch light/dark theme",top:!0},{key:"Ctrl + !, Ctrl + 1",description:"Report logs (check console)"},{key:"Ctrl + '",description:"Toggle simplified view",top:!0},{key:"Ctrl + / or Ctrl + ?",description:"Toggle shortcuts menu",top:!0}]}},computed:{do_timeout(){return!this.$store?.account_doc?.prefs?.hide_timeout},pageTitle(){return document.title},theme(){return this.$store.get_theme},show_tutorial(){return!this.$store.done_tutorial&&U&&this.$store},tutorial(){const e=U[this.tutorial_page];return{...e,prev_text:this.tutorial_page&&!e.disable_prev?"Back":"",next_text:e.options?.next_text||(this.tutorial_page==U.length-1?"Finish":"Next")}}},mounted(){this.isElectron=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1,this.isElectron&&(this.platform=this.$route.query.platform,!this.platform&&window.location.search&&(this.platform=window.location.search.split("=")[1]),this.$status.log("Electron Platform: "+this.platform)),this.set_theme(),this.$store.paused=!1,this.$store.logout_prompt=!1,window.addEventListener("focus",this.refreshTimeout),window.addEventListener("keydown",this.global_keydown),this.$shortcuts.register_all(this.shortcuts,"General"),this.$refs.app.addEventListener("click",(e=>{if(e.target.href){e.target.href.includes("://")&&!e.target.href.startsWith("/")||(e.target.href=new URL(e.target.href,window.location.href).href);let t=new URL(e.target.href);if(t?.hostname==this.$env.VUE_APP_BRAND_DOMAIN||t?.hostname==window?.location?.hostname)return;e.preventDefault(),this.$status.log(`🔗 Opening outlink in a new tab | "${t.href}"`),window.open("/to/"+encodeURIComponent(t.href),"_blank")}}))},beforeUnmount(){window.removeEventListener("focus",this.refreshTimeout),window.removeEventListener("keydown",this.global_keydown),this.$shortcuts.remove_tag("General")},created(){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",t=window.localStorage.getItem("theme");this.isDarkMode="dark"===t||null===t&&"dark"===e},methods:{global_keydown(e){let t,o=!1;if(this.show_shortcuts&&(o=!0),e.shiftKey||"Escape"!=e.key||e.ctrlKey||e.metaKey?e.shiftKey||"Enter"!=e.key||!e.ctrlKey&&!e.metaKey?e.shiftKey||"\\"!=e.key||!e.ctrlKey&&!e.metaKey?e.shiftKey||"'"!=e.key||!e.ctrlKey&&!e.metaKey?"/"==e.key&&(e.ctrlKey||e.metaKey)||"?"==e.key&&(e.ctrlKey||e.metaKey)?(this.show_shortcuts=!this.show_shortcuts,o=!0):"!"!=e.key&&"1"!=e.key||!e.ctrlKey&&!e.metaKey||(this.$store.report_logs(),o=!0):(this.$store.toggle_simplified(),o=!0):(this.$store.toggle_theme(),o=!0):t=V()(".click_ctrlenter"):t=V()(".click_escape"),t){if(t=t.not("[disabled]").not(".disabled").filter(":visible"),!t||!t.length)return;V()(t).first().click()}(t||o)&&(e.preventDefault(),e.stopPropagation())},tutorial_nav(e){const t=this.tutorial?.options?.click_on_complete;e>0&&t&&V()(1==t?this.tutorial.el:t).click(),this.tutorial_page==U.length-1?this.$store.finish_tutorial(!0).then((()=>{new I.rQ("Interface tutorial completed; here's some more resources!",3500)})).catch((e=>{new I.Qp("Couldn't complete tutorial",e,3e3)})):this.tutorial_page+e>=0&&(!this.tutorial.disable_prev||e>0)&&(this.tutorial_page+=e)},refreshTimeout(){this.$store&&this.$store.refresh_timeout()},set_theme(){"light"==this.theme?(V()("meta.theme-color").attr("media",""),V()("meta.theme-color-dark").attr("media","false")):(V()("meta.theme-color-dark").attr("media",""),V()("meta.theme-color").attr("media","false"))}},watch:{"$store.paused":function(e,t){this.do_timeout&&(e?this.$nextTick((()=>{this.$refs.pause_modal.focus()})):t&&this.$refs.overlay&&(this.animating=!0,this.$refs.overlay.close(),setTimeout((()=>{this.animating=!1}),250)))},show_shortcuts:function(e,t){t&&this.$refs.shortcuts_overlay&&(this.animating_shortcuts=!0,this.$refs.shortcuts_overlay.close(),setTimeout((()=>{this.animating_shortcuts=!1}),250))},theme(){this.set_theme()}}};const te=(0,b.A)(ee,[["render",v],["__scopeId","data-v-72179f70"]]);var oe=te,ie=o(6765),re=o(1758),se=o(6301),ne=o(4458);(0,ne.k)("/service-worker.js",{ready(){se.Cw.log("🛠 App is being served from cache by a service worker. For more details, visit https://goo.gl/AFskqB")},registered(){se.Cw.log("🛠 Service worker has been registered.")},cached(){se.Cw.log("🛠 Content has been cached for offline use.")},updatefound(){se.Cw.log("🛠 New content is downloading.")},updated(){se.Cw.log("🛠 New content is available; please refresh."),window.localStorage.clear(),window.location.reload(!0)},offline(){se.Cw.log("🛠 No internet connection found. App is running in offline mode.")},error(e){se.Cw.error("🛑 Error during service worker registration:",e)}});var ae=o(5847),le=o(3933);function ce(e){if(e)return e=e.replace(" or ",", "),e.split(", ").map((e=>(e=e.replace("Control","Ctrl"),-1!=(null===navigator||void 0===navigator?void 0:navigator.userAgent.indexOf("Mac OS X"))&&(e=e.replace("Ctrl","⌘"),e=e.replace("Meta","⌘"),e=e.replace("Shift","⇧"),e=e.replace("Alt","⌥"),e=e.replace("Escape","esc"),e=e.replace("Home","fn + ←"),e=e.replace("End","fn + →")),e=e.replace("ArrowUp","↑"),e=e.replace("ArrowDown","↓"),e=e.replace("ArrowLeft","←"),e=e.replace("ArrowRight","→"),e=e.replace("Enter","⏎"),e=e.replace("Escape","Esc"),e=e.replace("Backspace","⌫"),e=e.replace("Delete","⌦"),e=e.replace("Tab","⇥"),e)))}const de=(0,s.nY)({id:"shortcuts",state:()=>({shortcuts:[],keys:[],active:{}}),getters:{list(){return this.shortcuts.map((e=>Object.assign(Object.assign({},e),{keys:ce(e.key)})))},sections(){let e=[],t=this.shortcuts.map((e=>e.tag));t=[...new Set(t)];for(let o=0;o<t.length;o++)e.push({tag:t[o],list:this.list.filter((e=>e.tag===t[o]))});return e}},actions:{get(e){return this.shortcuts.find((t=>t===e))},get_key(e){return this.keys.includes(e)&&this.shortcuts.find((t=>t.key===e))||null},register(e,t=!1){(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e?void 0:e.description)?(this.keys.includes(e.key)&&se.Cw.warn(`⌨️ Shortcut key "${e.key}" already registered`),this.keys.push(e.key),this.shortcuts.push(e),t||this.sort()):se.Cw.error("⌨️ Shortcut must have key and description text")},register_all(e,t){for(let o=0;o<e.length;o++)this.register(Object.assign(Object.assign({},e[o]),{tag:t}),!0);this.sort()},remove(e){this.shortcuts.includes(e)?this.shortcuts.splice(this.shortcuts.indexOf(e),1):se.Cw.error("⌨️ Shortcut not registered, cannot remove",e)},remove_all(e,t){for(let o=0;o<e.length;o++)this.remove(Object.assign(Object.assign({},e[o]),{tag:t}))},remove_tag(e){this.shortcuts=this.shortcuts.filter((t=>t.tag!==e)),this.keys=this.shortcuts.map((e=>e.key))},remove_key(e){this.keys.includes(e)?(this.keys.splice(this.keys.indexOf(e),1),this.shortcuts.splice(this.shortcuts.indexOf(this.get_key(e)),1)):se.Cw.error(`⌨️ Key "${e}" not registered, cannot remove shortcut`)},remove_keys(e){for(let t=0;t<e.length;t++)this.remove_key(e[t])},sort(){this.shortcuts.sort(((e,t)=>e.tag!==t.tag?"General"!==e.tag&&t.tag?"General"!==t.tag&&e.tag?e.tag.localeCompare(t.tag):1:-1:e.top&&!t.top?-1:!e.top&&t.top?1:e.key!==t.key?e.key.localeCompare(t.key):e.description.localeCompare(t.description)))},clear(){this.shortcuts=[],this.keys=[],se.Cw.log("⌨️ Cleared shortcuts")},set_activity(e,t){this.active[t]=e},is_active(e){return this.active[e]}}});var ue=o(9354);const he=(0,s.nY)({id:"notifications",state:()=>({}),getters:{enabled(){return"Notification"in window&&"granted"===Notification.permission}},actions:{register(e){"Notification"in window?this.enabled?se.Cw.log("🔔 Notifications already enabled"):e||"denied"!==Notification.permission?Notification.requestPermission().then((e=>{"granted"===e?this.add({title:"Notifications Enabled",message:"You can now receive notifications from MVTT"}):(se.Cw.error("🔔 Notifications permission denied"),new I.Qp("Cannot enable notifications","permission denied",2500))})):se.Cw.warn("🔔 Notifications permission previously denied"):(se.Cw.error("🔔 This browser does not support desktop notification"),new I.Qp("Cannot enable notifications","browser lacks support",2500))},add(e,t=()=>{}){if(!this.enabled)return se.Cw.error("🔔 Notifications are not enabled"),new I.MY("Cannot send notification: notifications are not enabled",2500),null;new Notification(e.title,Object.assign(Object.assign({},e),{icon:"/img/icons/app.png",badge:"/img/icons/apple-touch-icon-60x60.png",renotify:!!e.tag,timestamp:Date.now()}))},play(e){try{new Audio(e).play()}catch(t){se.Cw.error(`🔔 Cannot play sound file "${e}"`,t)}}}});var _e,me;window.toast=I.jT,window.$=V();const pe=(0,s.Ey)(),fe=(0,i.Ef)(oe)||(0,i.Ef)((()=>oe));fe.use(ie.A),fe.use(pe);const ve=(0,le.s)(),ge=de(),ye=(0,ue.F)(),we=he();fe.mixin({computed:{$env(){return{VUE_APP_MUSTACHE_CLASS_TEXT:"{{#period}}P{{period}} - {{/period}}{{name}}",VUE_APP_BRAND_DOMAIN__VIEWCLASS:"view.mvtt.app",VUE_APP_THEME_ACCENT_COLOR_ALT:"4c4c4c",VUE_APP_BRAND_DOMAIN__ADDCLASS:"add.mvtt.app",VUE_APP_BRAND_DOMAIN__VIEWTASK:"view.mvtt.app",VUE_APP_ORG_NAME:"MVLA",VUE_APP_BRAND_NAME_SHORT:"MVTT",VUE_APP_ORG_LINKS:'[["Docs", "https://mvtt.app/docs"], ["Cal", "https://mvhs.mvla.net/Calendar/"]]',VUE_APP_THEME_COLOR:"f5c14b",VUE_APP_BRAND_MAIL_ADDRESS:"mail@mvtt.app",VUE_APP_BRAND_DOMAIN:"mvtt.app",VUE_APP_BRAND_HOMEPAGE:"http://mvtt.app",VUE_APP_ORG_GRADES:'[[9, "Freshman"], [10, "Sophomore"], [11, "Junior"], [12, "Senior"]]',VUE_APP_THEME_CONSOLE_COLOR_TEXT:"C9B092",VUE_APP_SIDEBAR_DOWNLOAD_URL:"/download/mvtt-sidebar.zip",VUE_APP_BRAND_URL:"https://mvtt.app",VUE_APP_BRAND_DOMAIN__API:"api.mvtt.app",VUE_APP_THEME_CONSOLE_COLOR_BG:"272727",VUE_APP_ORG_TEACHER_GRADE:"Teacher / Educator",VUE_APP_BRAND_NAME_LONG:"MV Task Tracker",VUE_APP_ORG_DOMAIN:"mvla.net",VUE_APP_BRAND_ALLOWED_HOSTS:"mvla.net,*.mvla.net",VUE_APP_THEME_ACCENT_COLOR:"000000",NODE_ENV:"production",BASE_URL:"/"}},$status(){return se.Cw},$store(){return ve},$shortcuts(){return ge},$magic(){return ye},$notify(){return we}}}),fe.use(re.A),fe.use(ae.A,{preLoad:2,attempt:1}),fe.mount("#root"),(0,r.wB)(pe.state,(e=>{window.localStorage.setItem("MVTT_app_state",JSON.stringify(e.main))}),{deep:!0}),window.addEventListener("storage",(e=>{"MVTT_teacher_mode"===e.key&&(se.Cw.log("🏫 Detected teacher mode change, reloading"),window.location.reload())})),se.Cw.log("🛜 Started "+((null===(_e=null===window||void 0===window?void 0:window.navigator)||void 0===_e?void 0:_e.onLine)?"online":"offline")),(null===(me=null===window||void 0===window?void 0:window.navigator)||void 0===me?void 0:me.onLine)||new I.y8("Features may not work as intended offline","default",1e4,o(3662)),window.addEventListener("offline",(()=>{new I.y8("Connection lost","default",3500,o(7620)),se.Cw.warn("🛜 Connection lost")})),window.addEventListener("online",(()=>{new I.y8("You're back online!","default",3500,o(1087)),se.Cw.log("🛜 Connection restored")})),V()(document.body).on("click",".auth-action",(function(){const e=(0,le.s)();!e.user&&V()(this).hasClass("can-login")?e.login():V()(this).hasClass("can-logout")&&(V()(this).hasClass("doprompt")?e.logout_prompt=!0:e.logout())})),V()(document.body).on("click",".gohome",(function(){ie.A.push("/")})),ie.A.afterEach((e=>{var t,o,i,r,s,n,a,l;e.meta&&e.meta.page_title?document.title="MV Task Tracker | "+e.meta.page_title:document.title="MV Task Tracker";let c=(null===(o=null===(t=e.meta)||void 0===t?void 0:t.theme_color)||void 0===o?void 0:o.light)||"#f5c14b",d=(null===(r=null===(i=e.meta)||void 0===i?void 0:i.theme_color)||void 0===r?void 0:r.dark)||"#f5c14b";V()("meta.theme-color").attr("content",c),V()("meta.theme-color-dark").attr("content",d),(0,I.bn)();const u=document.documentElement.style;u.setProperty("--theme-color",c),u.setProperty("--theme-color-dark",d);let h=(null===(n=null===(s=e.meta)||void 0===s?void 0:s.theme_color)||void 0===n?void 0:n.text_light)||"#000000",_=(null===(l=null===(a=e.meta)||void 0===a?void 0:a.theme_color)||void 0===l?void 0:l.text_dark)||"#ffffff";u.setProperty("--theme-color-text",h),u.setProperty("--theme-color-text-dark",_),u.setProperty("--theme-color-hover",h+"33"),u.setProperty("--theme-color-hover-dark",_+"33")})),ie.A.beforeEach((e=>{const t=(0,le.s)();return e.meta&&e.meta.requiresAuth&&t&&!t.user?(new I.y8("Please log in or join to access this page","default",1500,o(5476)),{path:"/",query:{redirect:e.fullPath}}):e.meta&&e.meta.requiresTeacher&&t.user&&!t.is_teacher?(new I.y8("You must be a teacher to access this page","default",1500,o(5476)),{name:"portal"}):e.meta&&e.meta.requiresAdmin&&t.user&&!t.is_admin?(new I.y8("Only administrators can access this page","default",1500,o(5476)),{name:"portal"}):void 0}))},6765:function(e,t,o){"use strict";var i=o(1387);const r=(0,i.aE)({history:(0,i.LA)("/"),routes:[{path:"/",name:"homemain",component:()=>o.e(253).then(o.bind(o,7253)),meta:{page_title:"Home",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1},children:[{path:"",name:"home",component:()=>o.e(546).then(o.bind(o,6546)),meta:{page_title:"Home",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1},children:[{path:"/view/:ref([^~]+~[^~]+~[^~]+)",name:"publicviewtask",component:()=>Promise.all([o.e(255),o.e(257)]).then(o.bind(o,7257)),meta:{page_title:"View Task",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"/view/:ref([^~]+~[^~]+)",name:"publicviewclass",component:()=>Promise.all([o.e(255),o.e(932)]).then(o.bind(o,9932)),meta:{page_title:"View Class",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"/to/:path?",name:"redirect",component:()=>o.e(908).then(o.bind(o,908)),meta:{page_title:"Confirm Redirect",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"/join",name:"join",component:()=>o.e(770).then(o.bind(o,770)),meta:{page_title:"Join the MVTT Beta",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1,close_path:"/",blockStandardRedirect:!0}},{path:"/link/:code?",name:"link",component:()=>o.e(578).then(o.bind(o,3578)),props:!0,meta:{page_title:"Link Personal Account",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},close_path:"/",blockStandardRedirect:!0}}]},{path:"/about",name:"about",component:()=>o.e(462).then(o.bind(o,9462)),meta:{page_title:"About",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/legal/privacy",name:"privacy",component:()=>o.e(739).then(o.bind(o,739)),meta:{page_title:"Legal - Privacy Policy",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/legal/tos",name:"tos",component:()=>o.e(393).then(o.bind(o,4393)),meta:{page_title:"Legal - Terms of Service",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/download",name:"download",component:()=>o.e(203).then(o.bind(o,5203)),meta:{page_title:"Download [BETA]",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/roadmap",name:"roadmap",component:()=>o.e(855).then(o.bind(o,5855)),meta:{page_title:"Development Roadmap",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/contact",name:"contact",component:()=>o.e(284).then(o.bind(o,6284)),meta:{page_title:"Contact",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/:pathMatch(.*)*",name:"404",component:()=>o.e(619).then(o.bind(o,9619)),meta:{page_title:"404",theme_color:{light:"#ffffff",dark:"#16130e"}}}]},{path:"/portal/admin",name:"admin",component:()=>o.e(758).then(o.bind(o,9758)),redirect:"/portal/admin/logs",meta:{page_title:"Administrator Panel",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0},children:[{path:"/portal/admin/logs",name:"admin_logs",component:()=>o.e(107).then(o.bind(o,9107)),meta:{page_title:"Admin Panel | Logs",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0}},{path:"/portal/admin/opts",name:"admin_opts",component:()=>o.e(803).then(o.bind(o,4803)),meta:{page_title:"Admin Panel | District Options",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0}},{path:"/portal/admin/usrs",name:"admin_usrs",component:()=>o.e(892).then(o.bind(o,4892)),meta:{page_title:"Admin Panel | Users and Teachers",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0}},{path:"/portal/admin/msgs",name:"admin_msgs",component:()=>o.e(239).then(o.bind(o,1620)),meta:{page_title:"Admin Panel | Messages and Alerts",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0}},{path:"/portal/admin/usge",name:"admin_usge",component:()=>o.e(520).then(o.bind(o,5520)),meta:{page_title:"Admin Panel | Usage Analytics",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,requiresAdmin:!0}}]},{path:"/portal",name:"portal",component:()=>o.e(383).then(o.bind(o,2202)),meta:{page_title:"Portal",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0},children:[{path:"/portal/tutorial/add",name:"onboarding",component:()=>o.e(272).then(o.bind(o,7272)),meta:{page_title:"Onboarding",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,block_close:!0,noSurvey:!0}},{path:"/portal/tutorial/:tab?",name:"tutorial",component:()=>o.e(104).then(o.bind(o,8104)),meta:{page_title:"Tutorial Videos",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/portal/study",name:"study",component:()=>o.e(383).then(o.bind(o,2202)),meta:{page_title:"Study Portal",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/portal/study/session/:page?",name:"studysession",component:()=>o.e(186).then(o.bind(o,1186)),meta:{page_title:"Study Session",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0,block_close:!0},children:[{path:"/portal/study/session/:page?/view/:ref?",name:"sessionview",component:()=>Promise.all([o.e(255),o.e(257)]).then(o.bind(o,7257)),meta:{page_title:"Session Session | View Task",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/portal/study/session/:page?/notes/:ref?",name:"sessionnotes",component:()=>o.e(312).then(o.bind(o,8312)),meta:{page_title:"Session Session | Task Notes",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}}]},{path:"/portal/statistics",name:"stats",component:()=>o.e(589).then(o.bind(o,589)),meta:{page_title:"View Statistics",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/survey/daily",name:"daily",component:()=>o.e(563).then(o.bind(o,2563)),meta:{page_title:"Daily Check-In",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,block_close:!0,blockStandardRedirect:!0,noSurvey:!0}},{path:"/portal/settings",name:"settings",component:()=>o.e(162).then(o.bind(o,7162)),meta:{page_title:"Settings",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,noSurvey:!0}},{path:"/portal/add",name:"addclass",component:()=>o.e(179).then(o.bind(o,5179)),meta:{page_title:"Join a Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/ref/:ref?",name:"refclass",component:()=>o.e(179).then(o.bind(o,5179)),meta:{page_title:"Join from Reference",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/code/:code",name:"codeclass",component:()=>o.e(179).then(o.bind(o,5179)),meta:{page_title:"Join from Code",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/code",name:"codeenterclass",component:()=>o.e(809).then(o.bind(o,4809)),meta:{page_title:"Enter Class Code",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/create",name:"createclass",component:()=>o.e(442).then(o.bind(o,2442)),meta:{page_title:"Teacher | Create Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/new/:tasktype?",name:"newtask",component:()=>o.e(923).then(o.bind(o,3923)),meta:{page_title:"Teacher | Add Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/notes/:ref?",name:"notes",component:()=>o.e(312).then(o.bind(o,8312)),meta:{page_title:"Your Task Notes",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/view/:ref?",name:"viewtask",component:()=>Promise.all([o.e(255),o.e(257)]).then(o.bind(o,7257)),meta:{page_title:"View Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/view/:ref([^~]+~[^~]+)",name:"viewclass",component:()=>Promise.all([o.e(255),o.e(932)]).then(o.bind(o,9932)),meta:{page_title:"View Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/edit/t/:ref?",name:"edit",component:()=>o.e(145).then(o.bind(o,7145)),meta:{page_title:"Edit Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/edit/c/:ref?",name:"editclass",component:()=>o.e(661).then(o.bind(o,8661)),meta:{page_title:"Edit Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/archive/:type?/:ref?",name:"archive",component:()=>o.e(512).then(o.bind(o,9512)),meta:{page_title:"Confirm Task Archive",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/leave/:ref?",name:"leave",component:()=>o.e(877).then(o.bind(o,9877)),meta:{page_title:"Confirm Class Leave",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}}]},{path:"/portal/calendar",name:"calendar",redirect:"/portal?calendar=true",meta:{page_title:"Calendar",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/app",redirect:"/portal",meta:{requiresAuth:!0}},{path:"/study",redirect:"/portal/study",meta:{requiresAuth:!0}},{path:"/settings",redirect:"/portal/settings",meta:{requiresAuth:!0}},{path:"/survey/daily",redirect:"/portal/survey/daily",meta:{requiresAuth:!0}}],parseQuery:e=>o(9122).parse(e)});t.A=r},3933:function(e,t,o){"use strict";o.d(t,{s:function(){return E}});var i,r,s,n=o(5234),a=o(6301),l=o(4186),c=o(7617),d=o(3169),u=o.n(d),h=o(6669),_=o(7845),m=o(8144),p=o.n(m),f=o(6765),v=o(9354),g=function(e,t,o,i){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function n(e){try{l(i.next(e))}catch(t){s(t)}}function a(e){try{l(i["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):r(e.value).then(n,a)}l((i=i.apply(e,t||[])).next())}))};(function(e){e["Light"]="light",e["Dark"]="dark"})(s||(s={}));const y=new _.HF,w=(null===(r=null===(i=null===navigator||void 0===navigator?void 0:navigator.userAgent)||void 0===i?void 0:i.toLowerCase())||void 0===r?void 0:r.indexOf(" electron/"))>-1;let k="@mvla.net";y.addScope("email"),y.addScope("profile"),h.j2.useDeviceLanguage(),y.setCustomParameters({login_hint:"username"+k});const b=p().compile("{{#period}}P{{period}} - {{/period}}{{name}}");function A(e){return(null===e||void 0===e?void 0:e.split("@")[1])==k.substring(1)}function C(){try{return window.self!==window.top}catch(e){return!0}}const P=new Date((new Date).getTime()-60*(new Date).getTimezoneOffset()*1e3).toISOString().split("T")[0],E=(0,n.nY)({id:"main",state:()=>{let e={user:null,account_doc:null,linked_account_doc:null,classes:[],tasks:[],loaded_email:null,loaded_classes:null,teacher:{doc_ref:null,collection_ref:null},theme:null,personal_account:!1,paused:!1,logout_prompt:!1},t=window.localStorage.getItem("MVTT_app_state");if(t&&"undefined"!=t&&"null"!=t)try{return a.Cw.log("↻ State from local storage"),e=JSON.parse(t),e.paused=!1,e.logout_prompt=!1,e}catch(o){a.Cw.warn("⟳ Error parsing local storage state",o)}return a.Cw.log("🔨 Setting up store from scratch"),e},getters:{ORG_DOMAIN(){return k},simplified(){var e,t;return(null===(t=null===(e=this.account_doc)||void 0===e?void 0:e.prefs)||void 0===t?void 0:t.simplified)||!1},linked_accounts(){return this.user&&this.active_doc&&this.active_doc.linked||[]},upcoming(){if(!this.tasks)return[];const e=Date.now(),t=288e5;let o=this.tasks.filter((o=>{var i;return"note"!=o.type&&((null===(i=null===o||void 0===o?void 0:o.date)||void 0===i?void 0:i.getTime)?o.date.getTime():0)>=e-t}));return o.sort(((e,t)=>e.date||t.date?e.date?t.date?e.date<t.date?-1:e.date>t.date?1:0:1:-1:0)),o},upcoming_todo(){return this.upcoming?this.upcoming.filter((e=>{var t;return!(null===(t=this.finished_tasks)||void 0===t?void 0:t.includes(e.ref))})):[]},non_recent_signin(){var e;if(!this.user)return!1;let t=null===(e=this.user.metadata)||void 0===e?void 0:e.lastSignInTime;if(!t)return!1;let o=(new Date).getTime()-new Date(t).getTime();return o>864e5},recently_joined(){var e;if(!this.user)return!1;let t=null===(e=this.user.metadata)||void 0===e?void 0:e.creationTime;if(!t)return!1;let o=(new Date).getTime()-new Date(t).getTime();return o<432e5},is_admin(){return this.is_teacher},is_teacher(){var e,t,o,i;if(!this.user)return!1;if(1==(null===(e=this.active_doc)||void 0===e?void 0:e.teacher_mode)||"true"==(null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t["MVTT_teacher_mode"])){if(1==(null===(o=this.active_doc)||void 0===o?void 0:o.teacher_mode)||null==(null===(i=this.active_doc)||void 0===i?void 0:i.teacher_mode))return window.localStorage.setItem("MVTT_teacher_mode","true"),this.personal_account?(a.Cw.log("🏫 No teacher mode for personal account"),!1):(a.Cw.log("🏫 Local teacher mode"),!0);window.localStorage.setItem("MVTT_teacher_mode","false"),a.Cw.log("🏫 Teacher mode disabled locally to reflect remote changes")}let r=this.user.email,[s,n]=r.split("@");return"@"+n==this.ORG_DOMAIN&&!/\d/.test(s)&&"@mvla.net"==this.ORG_DOMAIN&&(a.Cw.log("🏫 Teacher mode enabled for non-student district account"),!0)},done_daily_survey(){var e,t,o,i,r,s;return!this.done_tutorial||!!this.active_doc&&((null===(t=null===(e=this.active_doc)||void 0===e?void 0:e.prefs)||void 0===t?void 0:t.skip_survey)||{VUE_APP_MUSTACHE_CLASS_TEXT:"{{#period}}P{{period}} - {{/period}}{{name}}",VUE_APP_BRAND_DOMAIN__VIEWCLASS:"view.mvtt.app",VUE_APP_THEME_ACCENT_COLOR_ALT:"4c4c4c",VUE_APP_BRAND_DOMAIN__ADDCLASS:"add.mvtt.app",VUE_APP_BRAND_DOMAIN__VIEWTASK:"view.mvtt.app",VUE_APP_ORG_NAME:"MVLA",VUE_APP_BRAND_NAME_SHORT:"MVTT",VUE_APP_ORG_LINKS:'[["Docs", "https://mvtt.app/docs"], ["Cal", "https://mvhs.mvla.net/Calendar/"]]',VUE_APP_THEME_COLOR:"f5c14b",VUE_APP_BRAND_MAIL_ADDRESS:"mail@mvtt.app",VUE_APP_BRAND_DOMAIN:"mvtt.app",VUE_APP_BRAND_HOMEPAGE:"http://mvtt.app",VUE_APP_ORG_GRADES:'[[9, "Freshman"], [10, "Sophomore"], [11, "Junior"], [12, "Senior"]]',VUE_APP_THEME_CONSOLE_COLOR_TEXT:"C9B092",VUE_APP_SIDEBAR_DOWNLOAD_URL:"/download/mvtt-sidebar.zip",VUE_APP_BRAND_URL:"https://mvtt.app",VUE_APP_BRAND_DOMAIN__API:"api.mvtt.app",VUE_APP_THEME_CONSOLE_COLOR_BG:"272727",VUE_APP_ORG_TEACHER_GRADE:"Teacher / Educator",VUE_APP_BRAND_NAME_LONG:"MV Task Tracker",VUE_APP_ORG_DOMAIN:"mvla.net",VUE_APP_BRAND_ALLOWED_HOSTS:"mvla.net,*.mvla.net",VUE_APP_THEME_ACCENT_COLOR:"000000",NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_NOSURVEY?(a.Cw.log(`📃 Skipping survey from {${(null===(i=null===(o=this.active_doc)||void 0===o?void 0:o.prefs)||void 0===i?void 0:i.skip_survey)?"user prefs":".env"}} override`),"skipped"):(null===(r=this.active_doc)||void 0===r?void 0:r.done_surveys)&&(null===(s=this.active_doc.done_surveys)||void 0===s?void 0:s.includes(P)))},done_tutorial(){var e;return!!this.account_doc&&(null===(e=this.account_doc)||void 0===e?void 0:e.done_tutorial)},done_join_form(){var e;return!!this.user&&!!(null===(e=this.active_doc)||void 0===e?void 0:e.join_form)},account_ref(){return this.user?(0,c.H9)(h.db,"users",this.user.uid):null},linked_account_ref(){var e;return this.user&&(null===(e=this.account_doc)||void 0===e?void 0:e.linked_to)?(0,c.H9)(h.db,"users",this.account_doc.linked_to):null},active_ref(){return this.personal_account?this.linked_account_ref:this.account_ref},active_doc(){return this.personal_account?this.linked_account_doc:this.account_doc},get_theme(){var e,t;let o=this.theme||window.localStorage.getItem("theme"),i=null===(t=null===(e=this.account_doc)||void 0===e?void 0:e.prefs)||void 0===t?void 0:t.theme,r=window.matchMedia("(prefers-color-scheme: dark)").matches?s.Dark:s.Light;return i?(o!=i&&window.localStorage.setItem("theme",i),i||s.Light):(o?r=o:window.localStorage.setItem("theme",r),this.account_doc&&(this.account_doc.prefs=Object.assign(Object.assign({},this.account_doc.prefs),{theme:r}),this.update_wrapper_acc_doc()),o||s.Light)},get_loaded_classes(){if(!this.loaded_classes||!this.loaded_classes.length)return[];let e=this.loaded_classes;return e.map((e=>{var t,o;return e.is_joined=null===(o=null===(t=this.active_doc)||void 0===t?void 0:t.classes)||void 0===o?void 0:o.includes([this.loaded_email,null===e||void 0===e?void 0:e.id].join("/")),e}))},finished_tasks(){try{if(!this.active_doc)throw"No active doc";return this.active_doc.finished||[]}catch(e){return a.Cw.warn("🔗 Couldn't get finished tasks",e),[]}},notes(){try{if(!this.active_doc)throw"No active doc";return this.active_doc.notes||{}}catch(e){return a.Cw.warn("🔗 Couldn't get notes",e),{}}}},actions:{report_logs(){try{const e=a.Cw.getStream(),t=a.Cw.textStream(),o=(0,c.H9)((0,c.rJ)(h.db,"logs"));return(0,c.BN)(o,{date:new Date,date_inversed:-1*(new Date).getTime(),user:this.user?this.user.uid:"no user",email:this.user?this.user.email:"no user",stream:{json:e,text:t}}),new l.rQ("Logs reported and saved locally, check console for details",3500),a.Cw.log(`📊 Reported logs to server as '${o.id}'`),a.Cw.saveStream(o.id),Promise.resolve(o.id)}catch(e){return Promise.reject("Failed to report logs:"+e)}},class_text(e){if(e)return b(e)},set_account_pref(e,t){return g(this,void 0,void 0,(function*(){var o;try{if(!this.account_ref)throw"No account doc";if(!e)throw"No pref provided";return yield this.update_wrapper_with_merge({prefs:Object.assign(Object.assign({},null===(o=this.active_doc)||void 0===o?void 0:o.prefs),{[e]:t})}),Promise.resolve()}catch(i){return Promise.reject(i)}}))},get_surveys(e){return g(this,void 0,void 0,(function*(){if(!this.user)return Promise.reject("Missing user");try{let t=e.map((e=>{var t,o;return(0,c.H9)(h.db,"survey","daily",e,this.personal_account?null===(t=this.account_doc)||void 0===t?void 0:t.linked_to:null===(o=this.user)||void 0===o?void 0:o.uid)})),o=t.map((e=>(0,c.x7)(e)));const i=(yield Promise.all(o)).map(((t,o)=>t.exists()?{date:e[o],data:t.data()}:{date:e[o],error:"No survey data for this date"}));return Promise.resolve(i)}catch(t){return Promise.reject(t)}}))},get_cached_surveys(e){return g(this,arguments,void 0,(function*(e,t=!1){var o,i,r;if(!this.user)return Promise.reject("Missing user");try{const s=(0,c.H9)(h.db,"processed_surveys",this.personal_account?null===(o=this.account_doc)||void 0===o?void 0:o.linked_to:null===this||void 0===this?void 0:this.user.uid),n=yield(0,c.x7)(s),l=n.exists()&&(null===(i=n.data())||void 0===i?void 0:i.list)||[],d=null===l||void 0===l?void 0:l.map((e=>e.date)),u=(null===(r=null===l||void 0===l?void 0:l.filter((e=>e.error)))||void 0===r?void 0:r.map((e=>e.date)))||[],_=e.every((e=>d.includes(e)));if(_&&!t)return a.Cw.log("📊 Using cached surveys"),Promise.resolve(l);{t&&a.Cw.log("📊 Forcing refresh of surveys");const o=t?e:e.filter((e=>!d.includes(e)||u.includes(e))),i=yield this.get_surveys(o);let r=[];for(const t of e)o.includes(t)?r.push(i[o.indexOf(t)]):r.push(l[d.indexOf(t)]);return yield(0,c.BN)(s,{list:r,updated:Date.now()},{merge:!0}),a.Cw.log("📊 Got surveys from server"),Promise.resolve(r)}}catch(s){return Promise.reject(s)}}))},note_for(e){const t=this.ref_to_path(e);return this.notes&&t&&this.notes[t]||null},set_note(e,t){return g(this,void 0,void 0,(function*(){try{if(!this.active_doc)throw"No active doc";if(!t)throw"No ref provided";const o=this.ref_to_path(t);if(!o)throw"Invalid ref";let i=this.active_doc;return i.notes||(i.notes={}),i.notes[o]=e||null,this.set_active(i),yield this.update_remote(),Promise.resolve()}catch(o){return Promise.reject(o)}}))},set_finished(e,t){return g(this,void 0,void 0,(function*(){try{if(!this.active_doc)throw"No active doc";if(!t)throw"No reference(s) provided";const o=Array.isArray(t)?t:[t];let i=this.active_doc;if(i.finished||(i.finished=[]),e)for(let e of o)i.finished.includes(e)||i.finished.push(e);else i.finished=i.finished.filter((e=>!o.includes(e)));return this.set_active(i),yield this.update_remote(),new l.rQ((o.length>1?"Tasks":(0,v.F)().done_prefix(this.tasks.find((e=>e.ref==o[0]))))+(e?" marked as finished":" marked as unfinished"),2e3),Promise.resolve()}catch(o){return new l.Qp("Task(s) could not be "+(e?"marked as finished":"marked as unfinished"),o,2e3),Promise.reject(o)}}))},path_to_ref(...e){const t=[...e].join("/");if(!t.length)return null;let[o,i,r]=t.split("/");return o&&i?(o=o.split("@")[0],r?`${o}~${i}~${r}`:`${o}~${i}`):null},ref_to_path(...e){const t=[...e].join("~");if(!t.length)return null;let[o,i,r]=t.split("~");return o&&i?(o+=this.ORG_DOMAIN,r?`${o}/${i}/${r}`:`${o}/${i}`):null},hash(e){const t=u().SHA256(e).toString();return t.substring(0,5)},code_from_ref(e){return g(this,void 0,void 0,(function*(){try{if(!e)return Promise.reject("No ref provided");e=e.split("~").join("/");let[t,o]=e.split("/");if(!t||!o)return Promise.reject("Invalid ref");t=t.split("@")[0]+this.ORG_DOMAIN,e=t+"/"+o;const i=this.hash(e),r=this.classes.find((t=>t.id==e));if(!r)return Promise.reject("No matching class found");if((null===r||void 0===r?void 0:r.code)!==i){const r=(0,c.H9)(h.db,"codes",i);yield(0,c.BN)(r,{ref:e});const s=(0,c.H9)(h.db,"classes",t,"classes",o);yield(0,c.mZ)(s,{code:i})}return Promise.resolve(i)}catch(t){return Promise.reject(t)}}))},ref_from_code(e){return g(this,void 0,void 0,(function*(){var t;try{if(!e)throw"No code provided";const o=(0,c.H9)(h.db,"codes",e),i=yield(0,c.x7)(o);if(a.Cw.log("🔗 Got code doc",i.data()),!i.exists())throw"Code doesn't exist";let r=this.path_to_ref(null===(t=i.data())||void 0===t?void 0:t.ref);if(!r)throw"Code doesn't have ref";return Promise.resolve(r)}catch(o){return Promise.reject(o)}}))},toggle_teacher(){return g(this,void 0,void 0,(function*(){var e;if(!this.user)return;let t=(null===(e=this.active_doc)||void 0===e?void 0:e.teacher_mode)||"true"==window.localStorage.getItem("MVTT_teacher_mode");window.localStorage.setItem("MVTT_teacher_mode",!t);let o=t?"off":"on";this.active_doc&&(this.active_doc.teacher_mode=!t,yield this.update_remote(),a.Cw.log(`🏫 Remote teacher mode toggled ${o}`)),a.Cw.log(`🏫 Local teacher mode toggled ${o}`),new l.rQ(`Teacher mode toggled ${o}`,2e3)}))},get_tasks(){return g(this,void 0,void 0,(function*(){var e,t,o,i,r;try{if(!(null===(e=this.classes)||void 0===e?void 0:e.length))return Promise.resolve([]);let s=[],n=this.classes;for(let e=0;e<n.length;e++){let l=n[e].tasks;l=l||[];for(let c=0;c<((null===l||void 0===l?void 0:l.length)||0);c++){let d;if(n[e].name=n[e].name?n[e].name:"Unnamed Class","string"==typeof l[c].date){l[c].date=null===(o=null===(t=l[c])||void 0===t?void 0:t.date)||void 0===o?void 0:o.split("T")[0];let[e,s,n]=null===(r=null===(i=l[c])||void 0===i?void 0:i.date)||void 0===r?void 0:r.split("-");4==e.length&&(l[c].date=`${s}-${n}-${e}`),d=(0,a.kX)(l[c].date),d=isNaN(+d)?null:d}else d=l[c].date;l[c].color=n[e].color,s.push(Object.assign(Object.assign({},l[c]),{date:d,class_name:this.class_text(n[e])}))}}return s.sort(((e,t)=>(e.name=e.name?e.name:"",t.name=t.name?t.name:"",e.date&&t.date?e.date.getTime()==t.date.getTime()?e.period==t.period?e.name.localeCompare(t.name):e.period-t.period:e.date.getTime()-t.date.getTime():e.name.localeCompare(t.name)))),this.tasks=s,Promise.resolve(s)}catch(s){return Promise.reject(s)}}))},clear(){var e,t,o;this.user=null,this.account_doc=null,this.linked_account_doc=null,this.classes=[],this.tasks=[],this.loaded_email=null,this.loaded_classes=null,this.personal_account=!1,this.teacher={doc_ref:null,collection_ref:null},window.localStorage.removeItem("MVTT_app_state"),(null===(o=null===(t=null===(e=f.A.currentRoute)||void 0===e?void 0:e.value)||void 0===t?void 0:t.meta)||void 0===o?void 0:o.requiresAuth)&&f.A.push("/")},set_active(e){try{if(!e)throw"No data provided";return this.personal_account?this.linked_account_doc=e:this.account_doc=e,Promise.resolve()}catch(t){return Promise.reject(t)}},doc_from_uid(e){return g(this,void 0,void 0,(function*(){try{if(!e)throw"No account uid provided";const t=yield(0,c.x7)((0,c.H9)(h.db,"users",e));if(a.Cw.log("🔗 Got linking account's document"),!t.exists())throw"Account doesn't exist or you haven't been added yet";return Promise.resolve(t.data())}catch(t){return a.Cw.warn("🔗 Couldn't get linking account's document",t),Promise.reject(t)}}))},link_account_uid(e){return g(this,void 0,void 0,(function*(){if(e&&this.account_doc){if(this.personal_account){this.account_doc||(yield this.create_doc(),a.Cw.log("📄 Dreated doc",this.account_doc));try{const t=yield this.doc_from_uid(e);if(!t)throw"Account doesn't exist or you haven't been invited";this.account_doc.linked_to=e,yield this.update_wrapper_acc_doc(),new l.rQ(`Successfully linked to ${t.name}'s account!`,4e3)}catch(t){return new l.Qp("Couldn't link account",t,2e3),Promise.reject(t)}return Promise.resolve()}new l.MY("This account is a primary account and cannot be linked",3e3)}}))},invite_linked(e){return g(this,void 0,void 0,(function*(){var t,o,i,r,s,n,d,u;if(!this.user||!this.active_doc||!this.account_doc)return;if(this.personal_account&&new l.MY("This account is already linked!",2e3),!e||A(e)||!e.includes("@"))return void new l.MY("Please enter a valid non-MVLA email",2e3);if(this.linked_accounts.includes(e))return void new l.MY("That account is already linked",2e3);this.active_doc.linked||(this.personal_account&&this.linked_account_doc?this.linked_account_doc.linked=[]:this.account_doc.linked=[]);const _=(0,c.rJ)(h.db,"mail");try{const h=yield(0,c.gS)(_,{to:e,cc:this.user.email,from:`${this.active_doc.name} via MV Task Tracker <mail@mvtt.app>`,fromname:this.active_doc.name+" via MV Task Tracker",template:{name:"link_invite",data:{sender_name:this.active_doc.name.split(" ")[0],sender_uid:this.user.uid}}}),m=(0,c.H9)(_,h.id);let p=yield(0,c.x7)(m),f=1;while(!p.exists()||0==!!(null===(o=null===(t=p.data())||void 0===t?void 0:t.delivery)||void 0===o?void 0:o.attempts)&&f<=3)yield new Promise((e=>setTimeout(e,2e3*(2^f)))),p=yield(0,c.x7)(m),a.Cw.log("📧 Checked email doc"),f++;if(!(null===(n=null===(s=null===(r=null===(i=p.data())||void 0===i?void 0:i.delivery)||void 0===r?void 0:r.info)||void 0===s?void 0:s.accepted)||void 0===n?void 0:n.includes(e))||0==(null===(u=null===(d=p.data())||void 0===d?void 0:d.delivery)||void 0===u?void 0:u.attempts))throw a.Cw.log("📧 Email failed to send",p.data()),"Email failed to send";return this.personal_account&&this.linked_account_doc?this.linked_account_doc.linked.push(e):this.account_doc.linked.push(e),yield this.update_remote(),new l.rQ(`We notified ${e}, you'll receive a copy of the email too!`,4e3),Promise.resolve()}catch(m){return new l.Qp(`Couldn't invite "${e}"`,m,2e3),Promise.reject(m)}}))},uninvite_linked(e){return g(this,void 0,void 0,(function*(){var t,o;try{if(!this.user)return;if(null===(t=this.active_doc)||void 0===t?void 0:t.linked.includes(e)){let t=(null===(o=this.active_doc.linked)||void 0===o?void 0:o.filter((t=>t!=e)))||[];this.personal_account&&this.linked_account_doc?this.linked_account_doc.linked=t:this.account_doc&&(this.account_doc.linked=t),yield this.update_remote(),new l.rQ(`Removed ${e} from your linked accounts`,2e3)}else new l.MY(`${e} is not linked to this account`,2e3);Promise.resolve()}catch(i){return new l.Qp(`Couldn't unlink "${e}"`,i,2e3),Promise.reject(i)}}))},refresh_timeout(e){this.paused=!1,this.user&&(0,h.RJ)(e)},login_promise(){return g(this,void 0,void 0,(function*(){return new Promise((e=>{const t=setInterval((()=>{this.user&&(clearInterval(t),e(this.user))}),100)}))}))},save_join_form(e){return g(this,void 0,void 0,(function*(){try{if(!this.user||!this.active_doc)throw"No doc to save join form to";return this.personal_account?(this.linked_account_doc=this.linked_account_doc||{},this.linked_account_doc.join_form=e):(this.account_doc=this.account_doc||{},this.account_doc.join_form=e),yield this.update_remote(),Promise.resolve()}catch(t){return Promise.reject(t)}}))},finish_tutorial(){return g(this,arguments,void 0,(function*(e=!0){try{if(!this.user||!this.account_doc)throw"No doc to save tutorial status to";return this.account_doc.done_tutorial=e,yield this.update_wrapper_with_merge({done_tutorial:e}),Promise.resolve()}catch(t){return Promise.reject(t)}}))},save_daily_survey(e){return g(this,void 0,void 0,(function*(){var t,o,i;try{this.user||(yield this.login_promise());const r=(0,c.H9)(h.db,"survey","daily",P,this.personal_account?null===(t=this.account_doc)||void 0===t?void 0:t.linked_to:null===(o=this.user)||void 0===o?void 0:o.uid);yield(0,c.BN)(r,{time:(new Date).getTime(),responses:e});let s=(null===(i=this.active_doc)||void 0===i?void 0:i.done_surveys)?this.active_doc.done_surveys:[];return s.push(P),this.personal_account&&this.linked_account_doc?this.linked_account_doc.done_surveys=s:this.account_doc&&(this.account_doc.done_surveys=s),yield this.update_remote(),new l.rQ("Saved daily survey",2e3),Promise.resolve()}catch(r){return new l.Qp("Couldn't save daily survey",r,2e3),Promise.reject(r)}}))},toggle_theme(){return g(this,void 0,void 0,(function*(){return this.theme=this.get_theme==s.Light?s.Dark:s.Light,window.localStorage.setItem("theme",this.theme),this.account_doc&&(this.account_doc.prefs=Object.assign(Object.assign({},this.account_doc.prefs),{theme:this.theme}),delete this.account_doc.theme,yield this.update_wrapper_acc_doc()),new l.rQ(`Switched to ${this.theme} theme`,2e3),this.theme=this.get_theme,Promise.resolve()}))},toggle_simplified(){return g(this,void 0,void 0,(function*(){var e;if(!this.account_doc)return;const t=!(null===(e=this.account_doc.prefs)||void 0===e?void 0:e.simplified);return this.account_doc.prefs=Object.assign(Object.assign({},this.account_doc.prefs),{simplified:t}),yield this.update_wrapper_acc_doc(),new l.rQ(`Switched to ${t?"simplified":"detailed (classic)"} view`,2e3),Promise.resolve()}))},remove_class_id_helper(e){return g(this,void 0,void 0,(function*(){var t;const o=null===(t=this.active_doc)||void 0===t?void 0:t.classes.filter((t=>t!=e));return this.personal_account&&this.linked_account_doc?this.linked_account_doc.classes=o:this.account_doc&&(this.account_doc.classes=o),this.classes=this.classes.filter((t=>t.id!=e)),this.get_tasks(),yield this.update_remote(),Promise.resolve()}))},remove_invalid(e){return g(this,void 0,void 0,(function*(){return yield this.remove_class_id_helper(e),new l.MY(`Removed non-existent class "${e}"`,2e3),Promise.resolve()}))},remove_class(e){return g(this,void 0,void 0,(function*(){try{return yield this.remove_class_id_helper(e),a.Cw.log("🗑️ Removed class from user's doc: "+e),new l.rQ("Left class",2e3),Promise.resolve()}catch(t){return a.Cw.log("🔥 Error removing class from user's doc: "+t),new l.Qp("Couldn't leave class",t,2e3),Promise.reject(t)}}))},set_user(e){a.Cw.log("🔑 Setting user"),(0,c.x7)((0,c.H9)(h.db,"users",e.uid)).then((t=>{var o,i,r,s,n,d,u,_,m,p,v,g,y,w,k;if(t.exists()?(this.account_doc=t.data(),this.personal_account=null===(o=this.account_doc)||void 0===o?void 0:o.personal_account):(this.account_doc=null,this.linked_account_doc=null),!e.email||!A(e.email)&&(!this.personal_account||!("link"==(null===(r=null===(i=null===f.A||void 0===f.A?void 0:f.A.currentRoute)||void 0===i?void 0:i.value)||void 0===r?void 0:r.name)||(null===(s=this.account_doc)||void 0===s?void 0:s.personal_account)&&(null===(n=this.account_doc)||void 0===n?void 0:n.linked_to))))return h.j2.signOut(),new l.MY("Please use your MVLA (@mvla.net) email to log in, or use an account that has been linked",4e3),void this.clear();this.user=e,this.personal_account&&this.get_remote(),this.is_teacher&&(a.Cw.log("🏫 In teacher mode"),this.teacher.doc_ref=(0,c.H9)(h.db,"classes",null===(d=this.user)||void 0===d?void 0:d.email),this.teacher.collection_ref=(0,c.rJ)(this.teacher.doc_ref,"classes")),(null===(m=null===(_=null===(u=f.A.currentRoute)||void 0===u?void 0:u.value)||void 0===_?void 0:_.query)||void 0===m?void 0:m.redirect)&&!(null===(g=null===(v=null===(p=f.A.currentRoute)||void 0===p?void 0:p.value)||void 0===v?void 0:v.meta)||void 0===g?void 0:g.blockStandardRedirect)&&f.A.replace(null===(k=null===(w=null===(y=f.A.currentRoute)||void 0===y?void 0:y.value)||void 0===w?void 0:w.query)||void 0===k?void 0:k.redirect)})).catch((e=>{h.j2.signOut(),"unavailable"==e.code?(new l.Qp("No connection available, you were signed out"),a.Cw.log("🛜 Connection unavailable")):(new l.MY("Something went wrong loading your data; signed out",2e3),a.Cw.log("🔥 Error loading user data;",e))}))},login(){return g(this,void 0,void 0,(function*(){const e=["Instagram"];if(e.some((e=>navigator.userAgent.includes(e))))return new l.Qp("This browser is not supported, please use your device's main browser",2e3),Promise.reject("This browser isn't supported; please use a different browser");new l.y8("Opening login popup...","default",1e3,o(5476)),yield(w||C()?(0,_.$2)(h.j2,y):(0,_.df)(h.j2,y)).then((()=>{var e,t,i,r,s,n;if(this.user&&this.user.email&&A(this.user.email))return new l.y8("Logged in as "+this.user.displayName+"!","default",2e3,o(608)),a.Cw.log("🔑 Logged in as "+this.user.displayName),(0,h.l4)(this.user),(null===(i=null===(t=null===(e=f.A.currentRoute)||void 0===e?void 0:e.value)||void 0===t?void 0:t.query)||void 0===i?void 0:i.redirect)||(null===(n=null===(s=null===(r=f.A.currentRoute)||void 0===r?void 0:r.value)||void 0===s?void 0:s.meta)||void 0===n?void 0:n.blockStandardRedirect)||f.A.push("/portal"),Promise.resolve()})).catch((e=>{const t=(0,l.Cs)(e);return"auth/cancelled-popup-request"==e.code||"auth/popup-closed-by-user"==e.code||"auth/user-cancelled"==e.code?new l.MY(t,2e3):new l.Qp("Couldn't log in",t,2e3),Promise.reject(t)}))}))},login_personal(){return g(this,void 0,void 0,(function*(){new l.y8("Opening login popup...","default",1e3,o(5476));const e=new _.HF;e.addScope("email"),e.addScope("profile"),yield(w||C()?(0,_.$2)(h.j2,e):(0,_.df)(h.j2,e)).then((e=>(e.user&&e.user.email&&!A(e.user.email)||this.logout(),new l.y8("Logged in as "+e.user.displayName+"!","default",2e3,o(608)),a.Cw.log("🔑 Logged in as "+e.user.displayName),(0,h.l4)(e.user),Promise.resolve()))).catch((e=>(new l.Qp("Couldn't log in",e,2e3),Promise.reject(e))))}))},logout(){return g(this,void 0,void 0,(function*(){var e,t,i;return(null===(i=null===(t=null===(e=f.A.currentRoute)||void 0===e?void 0:e.value)||void 0===t?void 0:t.meta)||void 0===i?void 0:i.requiresAuth)&&(yield f.A.push({path:"/"})),h.j2.signOut(),this.clear(),new l.y8("Logged Out","default",1500,o(5476)),Promise.resolve()}))},get_remote(){return g(this,void 0,void 0,(function*(){if(!this.user||!this.active_ref)return;const e=yield(0,c.x7)(this.active_ref);return a.Cw.log("📄 Got user doc remote"),e.exists()?this.set_active(e.data()):this.personal_account?(a.Cw.log("🔗 Linked account doesn't exist, removing it and going home"),new l.MY("Linked account doesn't exist, removing it and going home",2e3),this.account_doc&&(this.account_doc.linked_to=null),yield this.update_wrapper_acc_doc(),this.linked_account_doc=null,f.A.push("/")):(yield this.create_doc(),yield this.get_remote()),Promise.resolve()}))},update_remote(){return g(this,void 0,void 0,(function*(){this.active_ref&&(yield(0,c.BN)(this.active_ref,this.active_doc,{merge:!0}),a.Cw.log("⏶ Pushed changes to remote"))}))},update_wrapper_acc_doc(){return g(this,void 0,void 0,(function*(){this.account_ref&&(yield(0,c.BN)(this.account_ref,this.account_doc,{merge:!0}))}))},update_wrapper_with_merge(e){return g(this,void 0,void 0,(function*(){if(!this.account_ref)return Promise.reject("No account ref");try{return yield(0,c.BN)(this.account_ref,e,{merge:!0}),Promise.resolve()}catch(t){return Promise.reject(t)}}))},create_doc(){return g(this,void 0,void 0,(function*(){var e;if((null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.onLine)||(a.Cw.warn("🔥 No internet connection, won't create doc to prevent overwrite"),new l.Qp("Prevented destructuive offline userdoc create",2e3)),!this.user)return a.Cw.warn("🔥 No user to create doc for");a.Cw.log("📄 User document doesn't exist, creating new one..."),new l.MY("User document doesn't exist, creating new one...",2e3),this.account_doc={name:this.user.displayName,email:this.user.email,classes:[],prefs:{theme:this.get_theme}},this.personal_account&&(this.account_doc=Object.assign(Object.assign({},this.account_doc),{linked_to:null,personal_account:!0})),yield this.update_wrapper_acc_doc(),new l.rQ("Created user document; Let's get started",2e3),this.personal_account||f.A.push({name:"portal"}),this.is_teacher&&(yield this.create_teacher_doc(),new l.rQ("Created user & teacher documents; Let's get started",2e3))}))},create_teacher_doc(){return g(this,void 0,void 0,(function*(){var e,t,o,i,r,s;const n=(null===(e=this.active_doc)||void 0===e?void 0:e.email)||(null===(t=this.user)||void 0===t?void 0:t.email);if(!n)return;let a=(0,c.H9)(h.db,"classes",n);yield(0,c.BN)(a,{name:(null===(o=this.active_doc)||void 0===o?void 0:o.name)||(null===(i=this.user)||void 0===i?void 0:i.displayName),email:(null===(r=this.active_doc)||void 0===r?void 0:r.email)||(null===(s=this.user)||void 0===s?void 0:s.email)}),this.teacher={doc_ref:a,collection_ref:(0,c.rJ)(a,"classes")},f.A.push("/portal/create")}))},fetch_classes(){return g(this,void 0,void 0,(function*(){var e,t,o;let i=Math.random().toString(36).substring(7);if(a.Cw.log(`📚 Started fetch   | <${i}>`),!(null===(e=this.active_doc)||void 0===e?void 0:e.classes)){let e=0;const i=1e4,r=1500,s=100;while(!(null===(t=this.active_doc)||void 0===t?void 0:t.classes)&&e<i/s)yield new Promise((e=>setTimeout(e,s))),e++;if(!(null===(o=this.active_doc)||void 0===o?void 0:o.classes))return Promise.reject("Classes not found in user doc within load cycle");e*s>=r&&(a.Cw.warn(`📚 Initial class fetch took ${e*s}ms, warning set at ${r}ms`),new l.MY(`Initial class fetch took ${e*s}ms. Your network connection may negativly affect site preformance.`,3500))}let r=[...new Set(this.active_doc.classes)];r.length!=this.active_doc.classes.length&&(this.personal_account&&this.linked_account_doc?this.linked_account_doc.classes=r:this.account_doc&&(this.account_doc.classes=r),yield this.update_remote(),new l.MY("Removed duplicate classes",2e3),a.Cw.log("📚 Removed duplicate classes"));let s=[];for(let n of this.active_doc.classes){let[e,t]=n.split("/");if(!e||!t){yield this.remove_invalid(n);continue}const o=(0,c.rJ)(h.db,"classes",e,"classes");if(!o){yield this.remove_invalid(n);continue}const i=(0,c.H9)(o,t);let r=yield(0,c.x7)(i);if(!r.exists()){yield this.remove_invalid(n);continue}let a=r.data();a.id=n,a.ref=[e,t].join("/"),s.push(a)}a.Cw.log(`📚 Got class docs  | <${i}>`),s=s.map((e=>{let[t,o]=e.ref.split("/");return e.tasks=e.tasks||[],e.tasks=e.tasks.map((e=>(e.ref=[t,o,e.id].join("/"),delete e.id,e))),e})),a.Cw.log(`📚 Processed tasks | <${i}>`),s.sort(((e,t)=>e.period==t.period?e.name.localeCompare(t.name):e.period||0===e.period?t.period||0===t.period?e.period-t.period:-1:1)),this.classes=s,this.get_tasks(),Promise.resolve()}))},fetch_classes_by_email(e){return g(this,void 0,void 0,(function*(){if(this.loaded_email=null,!e||!A(e))return this.loaded_classes=null,void(this.loaded_email=e);a.Cw.log("📄 Getting classes from email");let t=[];const o=(0,c.rJ)((0,c.H9)(h.db,"classes",e),"classes");let i=yield(0,c.GG)(o);a.Cw.log("📄 Got classes subcollection from email"),i.forEach((o=>{var i;let r=o.data();r.id=o.id,r.is_joined=null===(i=this.active_doc)||void 0===i?void 0:i.classes.includes([e,o.id].join("/")),t.push(r)})),t.sort(((e,t)=>e.period==t.period?e.name.localeCompare(t.name):e.period-t.period)),this.loaded_classes=t,this.loaded_email=e}))},add_class(e,t,o,i){return g(this,void 0,void 0,(function*(){var r;if(!(null===(r=this.active_doc)||void 0===r?void 0:r.classes))return;if(!t)return;const s=[e,t].join("/");return this.active_doc.classes.includes(s)?void 0:(this.personal_account&&this.linked_account_doc?this.linked_account_doc.classes.push(s):this.account_doc&&this.account_doc.classes.push(s),yield this.update_remote(),yield this.fetch_classes(),new l.rQ(`Added "${this.class_text({name:o,period:i,ref:s,tasks:[]})}" to your classes`,2e3),Promise.resolve())}))},create_class(e){return g(this,void 0,void 0,(function*(){var t,o;if(a.Cw.log("🔨 Creating class",e),this.is_teacher){if(e.name)try{if(!this.teacher.doc_ref||!this.teacher.collection_ref)return yield this.create_teacher_doc(),void(yield this.create_class(e));const i=yield(0,c.gS)(this.teacher.collection_ref,e);return new l.rQ(`Created class "${this.class_text(e)}"`,2e3),a.Cw.log("🏫 Created class w/ ref",i),yield this.add_class((null===(t=this.active_doc)||void 0===t?void 0:t.email)||(null===(o=this.user)||void 0===o?void 0:o.email),i.id,e.name,e.period),Promise.resolve()}catch(i){return new l.Qp("Couldn't create class",(0,l.Cs)(i),2e3),Promise.reject(i)}}else new l.MY("You need to be a teacher to create a class",2e3)}))},create_task(e,t){return g(this,void 0,void 0,(function*(){try{if(!e.name&&"note"!=(null===e||void 0===e?void 0:e.type))return Promise.reject("No task name specified");if(!t||0==t.length)return Promise.reject("No classes selected");let o=(0,c.wP)(h.db),i=Array.from(this.classes);t.forEach((t=>{const r=t,[s,n]=t.split("/"),a=(0,c.rJ)(h.db,"classes",s,"classes",n,"tasks");e.class_id=r;const l=(0,c.H9)(a);o.set(l,e),i.forEach((t=>{var o;t.id==r&&(null===(o=t.tasks)||void 0===o||o.push(Object.assign(Object.assign({},e),{ref:[s,n,l.id].join("/"),class_id:r,_proxy:!0})))}))})),yield o.commit(),this.classes=i,this.get_tasks();const r="note"==e.type?"":`"${e.name}"`;return new l.rQ(`Added ${e.type||"task"} ${r} to ${t.length} class${1==t.length?"":"es"}`,2e3),a.Cw.log(`📝 Created task ${r} for ${t.length} classes`),Promise.resolve()}catch(o){return Promise.reject(o)}}))},update_class(e,t){return g(this,void 0,void 0,(function*(){try{let[o,i]=e.split("/");o+=this.ORG_DOMAIN,yield(0,c.mZ)((0,c.H9)(h.db,"classes",o,"classes",i),t),a.Cw.log("📝 Updated remote class");let r=this.classes;const s=r.findIndex((e=>e.id===[o,i].join("/")));return-1!==s&&(r[s]=Object.assign(Object.assign(Object.assign({},r[s]),t),{_proxy:!0}),a.Cw.log("📝 Updated local class")),this.classes=[...r],this.get_tasks(),Promise.resolve()}catch(o){return Promise.reject(o)}}))},update_task(e,t){return g(this,void 0,void 0,(function*(){var o;try{delete t.class_id,delete t.ref,delete t._class;let[i,r,s]=e.split("/");i.includes(this.ORG_DOMAIN)||(i+=this.ORG_DOMAIN),yield(0,c.mZ)((0,c.H9)(h.db,"classes",i,"classes",r,"tasks",s),t),a.Cw.log("📝 Updated remote task");let n=this.classes,l=[i,r].join("/");const d=n.findIndex((e=>e.id===l)),u=[i,r,s].join("/");if(-1!==d){const e=null===(o=n[d].tasks)||void 0===o?void 0:o.findIndex((e=>e.ref===u));-1!==e&&(n[d].tasks[e]=Object.assign(Object.assign({},t),{ref:u,class_id:l,_proxy:!0}),a.Cw.log("📝 Updated local task"))}return this.classes=[...n],this.get_tasks(),Promise.resolve()}catch(i){return Promise.reject(i)}}))},archive_task(e){return g(this,void 0,void 0,(function*(){let[t,o,i]=e.split("/");t+=this.ORG_DOMAIN;try{yield(0,c.kd)((0,c.H9)(h.db,"classes",t,"classes",o,"tasks",i)),a.Cw.log("📄 Archived task");try{let e=this.classes;e.forEach((e=>{var r;e.id==[t,o].join("/")&&(e.tasks=null===(r=e.tasks)||void 0===r?void 0:r.filter((e=>e.ref!=[t,o,i].join("/"))))})),this.classes=e,this.get_tasks()}catch(r){throw a.Cw.error("🔥 Error removing task from local",r),r}}catch(r){return Promise.reject(r)}return Promise.resolve()}))},task_from_ref(e){return g(this,void 0,void 0,(function*(){try{let[t,o,i]=e.split("/");t+=this.ORG_DOMAIN,a.Cw.log("📄 Getting task from ref:",[t,o,i].join(" - "));const r=yield(0,c.x7)((0,c.H9)(h.db,"classes",t,"classes",o));if(!r.exists())return Promise.resolve(null);let s=r.data();delete s.tasks,a.Cw.log("📚 Got class from ref");const n=yield(0,c.x7)((0,c.H9)(h.db,"classes",t,"classes",o,"tasks",i));return n.exists()?(a.Cw.log("📄 Got task from ref"),Promise.resolve(Object.assign(Object.assign({},n.data()),{ref:e,class_id:[t,o].join("/"),class_name:this.class_text(s),_class:Object.assign(Object.assign({},s),{ref:[t.split(this.ORG_DOMAIN)[0],o].join("~")})}))):Promise.resolve(null)}catch(t){return Promise.reject(t)}}))},class_from_ref(e){return g(this,arguments,void 0,(function*(e,t=!1){try{let[o,i]=e.split("/");o+=this.ORG_DOMAIN;const r=yield(0,c.x7)((0,c.H9)(h.db,"classes",o,"classes",i));if(a.Cw.log("📄 Got class doc"),!r.exists())return Promise.reject("Class doesn't exist");let s=r.data();return t||delete s.tasks,a.Cw.log("📚 Got class data"),Promise.resolve(s)}catch(o){return Promise.reject(o)}}))},upcoming_from_ref(e,t){return g(this,void 0,void 0,(function*(){var o;try{if(!e)throw"No class ref provided";t||(t=yield this.class_from_ref(e));let[i,r]=e.split("/");i+=this.ORG_DOMAIN;let s=yield(0,c.x7)((0,c.H9)(h.db,"classes",i,"classes",r));if(!s.exists())throw"Class doesn't exist";let n=(null===(o=s.data())||void 0===o?void 0:o.tasks)||[];n=n.filter((e=>"note"!=e.type&&(0,a.kX)(e.date).getTime()>=(new Date).getTime())),n.sort(((e,t)=>{var o,i;return(null===(o=(0,a.kX)(e.date))||void 0===o?void 0:o.getTime())-(null===(i=(0,a.kX)(t.date))||void 0===i?void 0:i.getTime())})),n=n.slice(0,6);let l=[];return n.forEach((o=>{const s=o.id;delete o.id,l.push(Object.assign(Object.assign({},o),{ref:[...e.split("/"),s].join("~"),date:(0,a.kX)(o.date),color:null===t||void 0===t?void 0:t.color,class_id:[i,r].join("/"),class_name:this.class_text(t)}))})),a.Cw.log("📚 Got upcoming tasks"),Promise.resolve(l)}catch(i){return Promise.reject(i)}}))},show_timeout(){var e,t;a.Cw.log("🕒 Showing timeout"+((null===(t=null===(e=this.account_doc)||void 0===e?void 0:e.prefs)||void 0===t?void 0:t.hide_timeout)?" | Hidden locally due to prefs":"")),this.paused=!0},hide_timeout(){var e,t;this.paused&&((null===(t=null===(e=this.account_doc)||void 0===e?void 0:e.prefs)||void 0===t?void 0:t.hide_timeout)||a.Cw.log("🕒 Hiding timeout"),this.paused=!1)}}})},9354:function(e,t,o){"use strict";o.d(t,{F:function(){return a}});var i=o(6301),r=o(5234),s=function(e,t,o,i){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function n(e){try{l(i.next(e))}catch(t){s(t)}}function a(e){try{l(i["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):r(e.value).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const n="https://api.mvtt.app/",a=(0,r.nY)({id:"magic",state:()=>({last:{},types:[{key:"note",name:"Note",list_as:"Add a Note",shortcuts:["n"]},{key:"task",name:"Assignment",list_as:"Schedule an Assignment",shortcuts:["a"]},{key:"test",name:"Test",list_as:"Schedule a Test",shortcuts:["t"]},{key:"project",name:"Project",list_as:"Schedule a Project",shortcuts:["p"]},{key:"quiz",name:"Quiz",list_as:"Schedule a Quiz",shortcuts:["q"]},{key:"exam",name:"Exam",list_as:"Schedule an Exam",shortcuts:["e"]}],prefixes:{note:"",task:"Complete ",test:"Study for ",project:"Prepare ",quiz:"Study for ",exam:"Study for "},done_prefixes:{note:"",task:"",test:"Studying for ",project:"Preparation for ",quiz:"Studying for ",exam:"Studying for "}}),getters:{},actions:{prefix(e){return this.prefixes[e.type]},done_prefix(e){return(null===e||void 0===e?void 0:e.type)&&e.name?`${this.done_prefixes[e.type]?this.done_prefixes[e.type]+e.type:this.type_full(e.type)} "${e.name}"`:"Task"},type_full(e){var t;return(null===(t=this.types.find((t=>t.key===e)))||void 0===t?void 0:t.name)||e},text(e){return s(this,void 0,void 0,(function*(){if(e)return yield this.rated_api_get("get/magic/link-text",{path:e})}))},type(e){return s(this,void 0,void 0,(function*(){if(e)return yield this.rated_api_get("get/magic/task-type",{task:e})}))},api_get(e,t){return s(this,void 0,void 0,(function*(){if(t=t||{},!e)return;const o=new URL(n+e);Object.keys(t).forEach((e=>o.searchParams.append(e,t[e])));const r=Math.random().toString(36).substring(7);i.Cw.log(`🛜 Running API fetch | <${r}>`),this.last[e]={time:Date.now(),hash:r};try{const e=yield fetch(o.href,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw"Non-valid response";const t=yield e.json();return i.Cw.log(`🛜 API fetch success | <${r}>`),t.data}catch(s){return i.Cw.error(`🛜 API fetch failed  | <${r}>`,s),null}}))},rated_api_get(e,t){return s(this,void 0,void 0,(function*(){var o,r,s,n;i.Cw.log("🛜 API fetch requested");Math.random().toString(36).substring(7);const a=null===(o=this.last[e])||void 0===o?void 0:o.time,l=null===(r=this.last[e])||void 0===r?void 0:r.hash;if(Date.now()-a<2e3){if(i.Cw.warn("🛜 API fetch rate limited"),yield new Promise((e=>setTimeout(e,15e3))),(null===(s=this.last[e])||void 0===s?void 0:s.time)!==a||(null===(n=this.last[e])||void 0===n?void 0:n.hash)!==l)return void i.Cw.warn("🛜 Outdated API fetch skipped");i.Cw.log("🛜 API fetch rate limit lifted")}return yield this.api_get(e,t)}))}}})},4618:function(e,t,o){"use strict";o.d(t,{A:function(){return b}});var i=o(6768),r=o(4232);const s=e=>((0,i.Qi)("data-v-793cb3ff"),e=e(),(0,i.jt)(),e),n={class:"modal",ref:"modal"},a={key:0,class:"modal_header",ref:"title"},l={class:"header_style modal_header_title"},c={key:1,ref:"contents",class:"overlay_contents"},d=["innerHTML"],u={class:"bottom_actions"},h={key:1,class:"progress_display"},_=["onClick"],m=s((()=>(0,i.Lk)("div",{class:"flex_spacer"},null,-1))),p=["disabled"];function f(e,t,o,s,f,v){return(0,i.uX)(),(0,i.CE)("main",n,[o.title?((0,i.uX)(),(0,i.CE)("header",a,[(0,i.Lk)("h2",l,(0,r.v_)(o.title),1)],512)):(0,i.Q3)("",!0),o.content||o.html?((0,i.uX)(),(0,i.CE)("div",c,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(o.content),{ref:"container",onUpdate:t[0]||(t[0]=t=>e.$emit("update",t)),onStatus:t[1]||(t[1]=t=>e.$emit("status",t)),onSkip:t[2]||(t[2]=t=>e.$emit("skip")),load:o.load},null,40,["load"])),o.html?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"overlay_contents__html",innerHTML:o.html},null,8,d)):(0,i.Q3)("",!0)],512)):(0,i.Q3)("",!0),(0,i.Lk)("div",u,[o.skippable?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"close_action click_escape",onClick:t[3]||(t[3]=t=>e.$emit("skip"))},(0,r.v_)(o.skip_text||(o.progress&&o.progress.current>1?"Abandon":"Close")),1)):(0,i.Q3)("",!0),o.progress&&o.progress.total>1?((0,i.uX)(),(0,i.CE)("div",h,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.progress.total,(t=>((0,i.uX)(),(0,i.CE)("span",{class:"progress_display__dot_container",key:t,onClick:o=>e.$emit("open",t-1)},[(0,i.Lk)("span",{class:(0,r.C4)(["progress_display__dot",{dot_active:t==o.progress.current,dot_finished:t<o.progress.current}])},null,2)],8,_)))),128))])):(0,i.Q3)("",!0),m,(0,i.Lk)("button",{class:"continue_action click_ctrlenter",onClick:t[4]||(t[4]=(...e)=>o.continue_action&&o.continue_action(...e)),disabled:!o.can_continue},(0,r.v_)(v.button_text),9,p)])],512)}o(4114);var v=o(6471),g=o.n(v),y={name:"ModalVue",mixins:[g()],mounted(){this.$smoothReflow({el:this.$refs.contents,hideOverflow:!0,childTransitions:!0}),this.$smoothReflow({el:this.$refs.title,hideOverflow:!0})},emits:["open","update","status","skip"],data(){return{}},props:{load:{type:Object,default:()=>({})},skippable:{type:Boolean,default:!1,required:!1},title:{type:String,default:"",required:!1},content:{type:Object,default:null,required:!1},html:{type:String,default:null,required:!1},can_continue:{type:Boolean,required:!0},continue_action:{type:Function,default:()=>{(void 0).$status.log("⏵ ModalVue: continue_action not provided"),window.onbeforeunload=null,(void 0).$router.push((void 0).$route.query.redirect||{name:"portal",query:(void 0).$route.query})},required:!1},progress:{type:Object,default:null,required:!1},is_notification:{type:Boolean,default:!1,required:!1},submit_text:{type:String,required:!1},skip_text:{type:String,required:!1}},computed:{button_text(){return this.submit_text?this.submit_text:this.is_notification?"Ok":this.progress&&this.progress.current==this.progress.total?"Finish":"Continue"}}},w=o(1241);const k=(0,w.A)(y,[["render",f],["__scopeId","data-v-793cb3ff"]]);var b=k},4411:function(e,t,o){"use strict";o.d(t,{A:function(){return d}});var i=o(6768),r=o(4232);const s=["closable"];function n(e,t,o,n,a,l){return(0,i.uX)(),(0,i.CE)("div",{class:(0,r.C4)(["overlay overlay_center_view overlay_slot__wrapper",{animate_out:a.animating_out}])},[(0,i.Lk)("div",{class:"overlay_close",onClick:t[0]||(t[0]=e=>l.closable?l.close():null),closable:l.closable},null,8,s),o.component?((0,i.uX)(),(0,i.Wv)((0,i.$y)(o.component),{key:0,class:"overlay_slot",onClose:l.close},null,40,["onClose"])):(0,i.RG)(e.$slots,"default",{key:1,class:"overlay_slot",close:l.close})],2)}var a={name:"OverlayWrapper",emits:["close"],props:{component:{type:Object,default:null}},data(){return{animating_out:!1}},computed:{closable(){return!0!==this.$route?.meta?.block_close}},methods:{close(){this.animating_out=!0,setTimeout((()=>{window.onbeforeunload=null,this.$emit("close"),this.animating_out=!1}),250)}}},l=o(1241);const c=(0,l.A)(a,[["render",n]]);var d=c},7620:function(e,t,o){"use strict";e.exports=o.p+"img/connection-error.a3350cd0.svg"},1087:function(e,t,o){"use strict";e.exports=o.p+"img/connection-success.c29d81cf.svg"},3662:function(e,t,o){"use strict";e.exports=o.p+"img/connection-warn.99f5cb05.svg"},477:function(){},2634:function(){}},t={};function o(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,o),s.exports}o.m=e,function(){var e=[];o.O=function(t,i,r,s){if(!i){var n=1/0;for(d=0;d<e.length;d++){i=e[d][0],r=e[d][1],s=e[d][2];for(var a=!0,l=0;l<i.length;l++)(!1&s||n>=s)&&Object.keys(o.O).every((function(e){return o.O[e](i[l])}))?i.splice(l--,1):(a=!1,s<n&&(n=s));if(a){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[i,r,s]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,i){return o.f[i](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/"+e+"."+{104:"3d427dee",107:"3be2d1e6",145:"97c0409c",162:"2a2c831e",179:"6b05580e",186:"8e25672f",203:"7545b8ae",239:"a8814a0a",253:"adaad3d5",255:"111f0569",257:"65abbdc6",272:"6305c7de",284:"881dcb02",312:"6c4cc9d6",383:"f72461fc",393:"0af05759",442:"59413101",462:"9c08dd9a",512:"b6e303d9",520:"7e3780c9",546:"ecc1e77b",563:"ad17b0b7",578:"183c6198",589:"f93b19f3",619:"2da7468f",661:"0ee73fa8",739:"4a341e3a",758:"a99a098f",770:"502a8b13",803:"2242d57b",809:"803726d7",855:"7e9ffeae",877:"47c8ffb1",892:"53dcfac9",908:"5018e2b1",923:"14a4cf51",932:"9fbd7134"}[e]+".js"}}(),function(){o.miniCssF=function(e){return"css/"+e+"."+{104:"2b0d65a8",107:"be39b3eb",145:"3d7b288d",162:"73525aed",179:"ca8b15ce",186:"1aaa5a2d",203:"393d89d9",239:"11d9071a",253:"ab5a12f0",257:"383763c1",284:"d9c24380",312:"5cdab7df",383:"cfa0386b",393:"75a97a72",442:"d576e19c",462:"76b29f15",512:"e7cd22dc",546:"2575b215",563:"0e59c6ca",578:"9e20b7b5",589:"61dcd1ec",619:"60f3120e",661:"317ccfc2",739:"2402cdda",758:"c0ca3786",770:"e873138f",803:"06177424",809:"df586b4e",855:"834c139e",877:"fb57c3bd",892:"e515783b",923:"742e3057",932:"e6f32d95"}[e]+".css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="mvtime:";o.l=function(i,r,s,n){if(e[i])e[i].push(r);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+s){a=u;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",t+s),a.src=i),e[i]=[r];var h=function(t,o){a.onerror=a.onload=null,clearTimeout(_);var r=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((function(e){return e(o)})),t)return t(o)},_=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,i,r,s){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",o.nc&&(n.nonce=o.nc);var a=function(o){if(n.onerror=n.onload=null,"load"===o.type)r();else{var i=o&&o.type,a=o&&o.target&&o.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+i+": "+a+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=i,l.request=a,n.parentNode&&n.parentNode.removeChild(n),s(l)}};return n.onerror=n.onload=a,n.href=t,i?i.parentNode.insertBefore(n,i.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var r=o[i],s=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(s===e||s===t))return r}var n=document.getElementsByTagName("style");for(i=0;i<n.length;i++){r=n[i],s=r.getAttribute("data-href");if(s===e||s===t)return r}},i=function(i){return new Promise((function(r,s){var n=o.miniCssF(i),a=o.p+n;if(t(n,a))return r();e(i,a,null,r,s)}))},r={792:0};o.f.miniCss=function(e,t){var o={104:1,107:1,145:1,162:1,179:1,186:1,203:1,239:1,253:1,257:1,284:1,312:1,383:1,393:1,442:1,462:1,512:1,546:1,563:1,578:1,589:1,619:1,661:1,739:1,758:1,770:1,803:1,809:1,855:1,877:1,892:1,923:1,932:1};r[e]?t.push(r[e]):0!==r[e]&&o[e]&&t.push(r[e]=i(e).then((function(){r[e]=0}),(function(t){throw delete r[e],t})))}}}(),function(){var e={792:0};o.f.j=function(t,i){var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise((function(o,i){r=e[t]=[o,i]}));i.push(r[2]=s);var n=o.p+o.u(t),a=new Error,l=function(i){if(o.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+n+")",a.name="ChunkLoadError",a.type=s,a.request=n,r[1](a)}};o.l(n,l,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,s,n=i[0],a=i[1],l=i[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(l)var d=l(o)}for(t&&t(i);c<n.length;c++)s=n[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(d)},i=self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=o.O(void 0,[504],(function(){return o(8283)}));i=o.O(i)})();
//# sourceMappingURL=main.2dfee16e.js.map