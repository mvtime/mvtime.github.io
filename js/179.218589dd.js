"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[179],{5179:function(e,s,a){a.r(s),a.d(s,{default:function(){return O}});a(4114);var t=a(6768),i=a(4232),l=a(5130);const o={class:"addclass"},d={class:"modal_header"},c={class:"header_style modal_header_title"},r={class:"overlay_contents",ref:"contents"},n={class:"overlay_contents_text"},_={key:0},h={key:1},u={key:0,class:"inputs_row"},m=["disabled"],f=["value","disabled"],p={key:0},y={key:0,value:"",disabled:"",hidden:"",selected:""},$={key:1,value:"",disabled:"",hidden:"",selected:""},v={key:1,class:"inputs_row"},b={key:2,class:"overlay_contents_text"},j=["href"],k={key:3,class:"overlay_contents_text"},g=(0,t.Lk)("br",null,null,-1),C=[g],w={class:"overlay_contents_text"},L={key:0},E=(0,t.Lk)("span",{class:"button_pointer_text"},"Share",-1),x={key:1},X={class:"bottom_actions"},q=(0,t.Lk)("div",{class:"flex_spacer"},null,-1),A=["disabled"];function I(e,s,a,g,I,P){return(0,t.uX)(),(0,t.CE)("main",o,[(0,t.Lk)("header",d,[(0,t.Lk)("h2",c,(0,i.v_)(P.is_join?"Join":"Add a")+" Class",1)]),(0,t.Lk)("div",r,[(0,t.Lk)("div",n,[P.is_join?((0,t.uX)(),(0,t.CE)("span",_,(0,i.v_)(e.$store.loaded_email==I.teacher_email?"Loaded":"Loading")+" from your teacher's class "+(0,i.v_)(P.code?"code":"ref"),1)):((0,t.uX)(),(0,t.CE)("span",h,[(0,t.eW)("Join a class with your teacher's details or "),(0,t.Lk)("span",{class:"click-action button_pointer_text",onClick:s[0]||(s[0]=s=>e.$router.push({name:"codeenterclass",query:e.$route.query}))},"enter a class code")]))]),P.is_join?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("div",{id:"code_ref",class:(0,i.C4)(["styled_input",{code:P.code,ref:e.$route.params.ref}]),type:"text",placeholder:"Join Code / Reference",enterkeyhint:"send",onKeydown:s[4]||(s[4]=(0,l.jR)(((...e)=>P.add_class&&P.add_class(...e)),["enter"]))},(0,i.v_)(P.code||e.$route.params.ref||""),35)])):((0,t.uX)(),(0,t.CE)("div",u,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>I.teacher_email=e),ref:"teacher_email",class:"styled_input",type:"text",placeholder:"Teacher's Email",enterkeyhint:"next",onKeydown:s[2]||(s[2]=(0,l.jR)((s=>e.$refs.class_id.focus()),["enter"]))},null,544),[[l.Jo,I.teacher_email]]),(0,t.bo)((0,t.Lk)("select",{ref:"class_id","onUpdate:modelValue":s[3]||(s[3]=e=>I.class_id=e),class:(0,i.C4)(["styled_input",{loading_bg:P.loading&&I.teacher_email}]),disabled:!P.classes||!P.classes.length},[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(P.classes,(s=>((0,t.uX)(),(0,t.CE)("option",{value:s.id,key:s.id,disabled:s.is_joined&&!I.adding},[s.is_joined&&!I.adding?((0,t.uX)(),(0,t.CE)("span",p,"[JOINED]")):(0,t.Q3)("",!0),(0,t.eW)(" "+(0,i.v_)(e.$store.class_text(s)),1)],8,f)))),128)),I.teacher_email&&!P.classes?((0,t.uX)(),(0,t.CE)("option",y,(0,i.v_)(P.loading?"Loading...":"No classes found"),1)):((0,t.uX)(),(0,t.CE)("option",$,(0,i.v_)(I.teacher_email&&P.classes&&P.classes.length&&I.teacher_email.endsWith(e.$env.VUE_APP_ORG_DOMAIN)?"Select a Class":""),1))],10,m),[[l.u1,I.class_id]])])),P.class_obj?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.eW)((0,i.v_)(P.class_obj&&P.class_obj.is_joined&&!I.adding?"You've already joined":"You'll be joining")+" ",1),(0,t.Lk)("a",{class:"class_name button_pointer_text",href:`/view/${P.cleaned_ref}`,onClick:s[5]||(s[5]=s=>{s.preventDefault(),e.$router.push({name:"viewclass",params:{ref:P.cleaned_ref},query:e.$route.query})}),style:(0,i.Tr)({"--color-class":P.class_obj.color,"--color-class-alt":P.class_obj.color+"2d"})},(0,i.v_)(e.$store.class_text(P.class_obj)),13,j)])):(0,t.Q3)("",!0),P.class_obj?((0,t.uX)(),(0,t.CE)("div",k,C)):(0,t.Q3)("",!0),(0,t.Lk)("div",w,[P.is_join?((0,t.uX)(),(0,t.CE)("span",L,[(0,t.eW)("If you're having trouble, ask your teacher to share their class code again using the "),E,(0,t.eW)(" button on the class edit page ")])):((0,t.uX)(),(0,t.CE)("span",x,"Enter your teacher's email above to see their classes"))])],512),(0,t.Lk)("div",X,[(0,t.Lk)("button",{class:"close_action click_escape",onClick:s[6]||(s[6]=s=>e.$emit("close"))},"Close"),q,(0,t.Lk)("button",{class:(0,i.C4)(["continue_action",{loading_bg:I.adding||P.is_join&&P.loading,alt_bg:!I.teacher_email||!I.class_id||P.class_obj&&P.class_obj.is_joined&&!I.adding}]),onClick:s[7]||(s[7]=(...e)=>P.add_class&&P.add_class(...e)),disabled:!I.teacher_email||!I.class_id||P.class_obj&&P.class_obj.is_joined&&!I.adding}," Add Class ",10,A)])])}var P=a(4186),R=a(6471),W=a.n(R),Y={name:"AddClassView",emits:["close"],mixins:[W()],data(){return{teacher_email:"",class_id:"",adding:!1}},mounted(){this.$smoothReflow({el:this.$refs.contents,childTransitions:!0}),this.$refs.teacher_email&&this.$refs.teacher_email.focus(),this.use_ref(),!this.is_join&&this.$store.loaded_email&&this.$store.get_loaded_classes.some((e=>!e.is_joined))&&(this.teacher_email=this.$store.loaded_email)},computed:{class_obj(){return this.classes&&this.classes.find((e=>e.id===this.class_id))||!1},cleaned_ref(){return this.$store.path_to_ref(this.teacher_email,this.class_id)},loading(){return this.$store.loaded_email!==this.teacher_email},classes(){return this.teacher_email?this.teacher_email===this.$store.loaded_email?this.$store.get_loaded_classes:(this.$store.fetch_classes_by_email(this.teacher_email),null):null},is_join(){return"refclass"==this.$route?.name||"codeclass"==this.$route?.name},code(){return this.$route?.params?.code&&this.$route.params?.code.toLowerCase()}},methods:{async add_class(){this.adding=!0,this.$store.add_class(this.teacher_email,this.class_id,this.class_obj.name,this.class_obj.period).then((()=>(this.$emit("close"),Promise.resolve()))).catch((()=>(this.adding=!1,Promise.reject())))},async use_ref(){let e=this.$route.params?.ref;if(!e&&this.code)try{e=await this.$store.ref_from_code(this.code)}catch(s){return new P.Qp("Invalid join code",s,4e3),this.$status.log("ðŸ”¥ "+s),void(this.$route?.query?.manual?this.$router.push({name:"codeenterclass",query:this.$route.query}):this.to_normal_add())}if(e&&this.is_join){this.$status.log("ðŸ” Attempting to use class join ref",e);let[s,a]=e.split("~");s+=this.$store.ORG_DOMAIN,this.teacher_email=s,this.$store.fetch_classes_by_email(s);while(this.$store.loaded_email!==this.teacher_email)await new Promise((e=>setTimeout(e,100)));let t=this.$store?.get_loaded_classes?.find((e=>e.id===a));t?(this.class_id=a,t.is_joined&&(new P.MY("You've already joined this class",3e3),this.$status.log("ðŸ”¥ Already joined class",e))):(new P.MY("Couldn't find that class",3e3),this.$status.log("ðŸ”¥ Unfound class for join ref",e),this.to_normal_add())}else this.is_join&&(new P.MY("Please provide a join code",3e3),this.to_normal_add())},to_normal_add(){this.$router.push({name:"addclass",query:this.$route.query})}}},J=a(1241);const M=(0,J.A)(Y,[["render",I]]);var O=M}}]);